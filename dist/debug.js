(()=>{var k=Object.defineProperty;var h=(E,y)=>k(E,"name",{value:y,configurable:!0});const w=class w extends CustomModule{constructor(){super({name:"Debug Plugin \u{1F41B}",description:"Debug utilities, full IPC logging, global scope search, and console commands",authors:[{name:"Bluscream",description:"VRCX Plugin System Maintainer",userId:"usr_08082729-592d-4098-9a21-83c8dd37a844"}],required_dependencies:[],tags:["Debug","Utility","Development"]});this.ipcMessageLog=[];this.maxLogSize=100;this.actionButtons=[{title:"Dump System State",color:"primary",icon:"ri-file-info-line",description:"Log all system information to console",callback:async()=>{this.dumpSystemState()}},{title:"Show IPC Log",color:"info",icon:"ri-chat-1-line",description:"Display all captured IPC messages",callback:async()=>{this.showIpcLog()}},{title:"Clear IPC Log",color:"warning",icon:"ri-delete-bin-line",description:"Clear IPC message log",callback:async()=>{this.ipcMessageLog=[],this.logger.showSuccess("Cleared IPC log")}},{title:"Test Error",color:"danger",icon:"ri-error-warning-line",description:"Trigger a test error",callback:async()=>{throw new Error("Test error from Debug Plugin")}}]}async load(){const e=window.customjs.types.SettingType;this.categories=this.defineSettingsCategories({general:{name:"\u{1F527} General",description:"General debug settings"},ipc:{name:"\u{1F4E1} IPC Logging",description:"Inter-process communication logging"}}),this.settings=this.defineSettings({consoleTimestamps:{type:e.BOOLEAN,description:"Show timestamps in console logs",category:"general",default:!0},logIncomingIpc:{type:e.BOOLEAN,description:"Log incoming IPC messages to console",category:"ipc",default:!1},logOutgoingIpc:{type:e.BOOLEAN,description:"Log outgoing IPC messages to console",category:"ipc",default:!1},ipcTypeFilter:{type:e.STRING,description:"Filter IPC types (comma-separated, e.g. 'OSC_,VrcxMessage' or leave empty for all)",category:"ipc",default:""},captureIpc:{type:e.BOOLEAN,description:"Capture IPC messages to log (view with 'Show IPC Log' button)",category:"ipc",default:!0},maxIpcLogSize:{type:e.NUMBER,description:"Maximum IPC messages to keep in log",category:"ipc",default:100,min:10,max:1e3}}),window.customjs.debug={printDebugInfo:()=>this.dumpSystemState(),listPlugins:()=>this.listPlugins(),getPlugin:o=>window.customjs.getModule(o),listEvents:()=>this.listEvents(),listHooks:()=>this.listHooks(),testEvent:(o,t)=>this.testEvent(o,t),getCurrentUser:()=>window.$pinia?.user?.currentUser,getCurrentLocation:()=>window.$app?.lastLocation,getFriends:()=>window.$pinia?.user?.currentUser?.friends,getCustomTags:()=>window.$pinia?.user?.customUserTags,getStores:()=>window.$pinia,getModules:()=>window.customjs.modules,getRepos:()=>window.customjs.repos,inspectPlugin:o=>this.inspectPlugin(o),searchVariable:(o,t)=>this.searchVariable(o,t),showIpcLog:()=>this.showIpcLog(),clearIpcLog:()=>{this.ipcMessageLog=[]},getIpcLog:()=>this.ipcMessageLog},this.logger.log("Debug utilities ready (access via window.customjs.debug)"),this.loaded=!0}async start(){this.setupIpcLogging(),this.enabled=!0,this.started=!0,this.logger.log("Debug plugin started")}setupIpcLogging(){this.onIpc(e=>{const o=this.shouldLogIpcMessage("in",e.type,e.raw.Type);o&&this.settings?.store.logIncomingIpc&&(console.group(`%c[IPC IN] ${e.type}`,"color: #4caf50; font-weight: bold"),console.log("Type:",e.type),console.log("Payload:",e.payload),console.log("Raw:",e.raw),console.log("Time:",new Date().toLocaleTimeString()),console.groupEnd()),o&&this.settings?.store.captureIpc&&this.captureIpcMessage("in",e.type,e.payload,e.raw.Type)}),this.registerPreHook("AppApi.SendIpc",e=>{const o=this.extractMessageType(e),t=this.shouldLogIpcMessage("out",o);t&&this.settings?.store.logOutgoingIpc&&(console.group(`%c[IPC OUT] ${o}`,"color: #ff9800; font-weight: bold"),console.log("Args:",e),console.log("Time:",new Date().toLocaleTimeString()),console.groupEnd()),t&&this.settings?.store.captureIpc&&this.captureIpcMessage("out",o,e)}),this.logger.log("IPC logging initialized (incoming + outgoing)")}extractMessageType(e){try{if(e&&e.length>0){const o=e[0];if(typeof o=="string"){const t=JSON.parse(o);return t.MsgType||t.Type||"Unknown"}}}catch{}return"Unknown"}shouldLogIpcMessage(e,o,t){const n=this.settings?.store.ipcTypeFilter||"";return n?n.split(",").map(c=>c.trim()).filter(c=>c).some(c=>o.includes(c)||t?.includes(c)):!0}captureIpcMessage(e,o,t,n){this.maxLogSize=this.settings?.store.maxIpcLogSize||100,this.ipcMessageLog.push({timestamp:Date.now(),direction:e,type:o,msgType:n,data:t}),this.ipcMessageLog.length>this.maxLogSize&&(this.ipcMessageLog=this.ipcMessageLog.slice(-this.maxLogSize))}showIpcLog(){if(this.ipcMessageLog.length===0){this.logger.showInfo("No IPC messages captured");return}console.group(`%c[Debug] IPC Message Log (${this.ipcMessageLog.length} messages)`,"color: #ff9800; font-weight: bold; font-size: 14px");const e=this.ipcMessageLog.filter(t=>t.direction==="in"),o=this.ipcMessageLog.filter(t=>t.direction==="out");if(e.length>0){console.group(`%c\u{1F4E5} Incoming (${e.length})`,"color: #4caf50; font-weight: bold");const t={};e.forEach(n=>{const i=n.type;t[i]||(t[i]=[]),t[i].push(n)}),Object.entries(t).forEach(([n,i])=>{console.group(`${n} (${i.length})`),i.forEach(c=>{const a=new Date(c.timestamp).toLocaleTimeString();console.log(`[${a}]`,c.data)}),console.groupEnd()}),console.groupEnd()}if(o.length>0){console.group(`%c\u{1F4E4} Outgoing (${o.length})`,"color: #ff9800; font-weight: bold");const t={};o.forEach(n=>{const i=n.type;t[i]||(t[i]=[]),t[i].push(n)}),Object.entries(t).forEach(([n,i])=>{console.group(`${n} (${i.length})`),i.forEach(c=>{const a=new Date(c.timestamp).toLocaleTimeString();console.log(`[${a}]`,c.data)}),console.groupEnd()}),console.groupEnd()}console.groupEnd(),this.logger.showInfo(`Displayed ${this.ipcMessageLog.length} IPC messages in console`)}async stop(){window.customjs?.debug&&delete window.customjs.debug,await super.stop()}dumpSystemState(){console.group("%c=== DEBUG INFO ===","color: #2196f3; font-weight: bold; font-size: 14px"),console.log(`Modules loaded: ${window.customjs.modules.length}`),console.log("Event registry stats:",window.customjs.eventRegistry.getStats()),console.log(`Hooks: pre=${Object.keys(window.customjs.hooks.pre).length}, post=${Object.keys(window.customjs.hooks.post).length}`),console.log(`Functions backed up: ${Object.keys(window.customjs.functions).length}`),console.group("Loaded Modules"),window.customjs.modules.forEach(e=>{const o=`${e.enabled?"\u2713":"\u2717"} ${e.loaded?"L":""} ${e.started?"S":""}`;console.log(`[${o}] ${e.metadata.name} (${e.metadata.id})`)}),console.groupEnd(),console.groupEnd()}listPlugins(){return window.customjs.modules.map(e=>({id:e.metadata.id,name:e.metadata.name,enabled:e.enabled,loaded:e.loaded,started:e.started}))}listEvents(){window.AppApi?.ShowDevTools&&window.AppApi.ShowDevTools();const e=window.customjs.eventRegistry.listAll();return console.group("\u{1F4E1} Registered Events"),e.forEach(o=>{console.log(`${o.name}: ${o.listenerCount} listeners (${o.registeredBy.length} plugins)`)}),console.groupEnd(),e}listHooks(){return window.AppApi?.ShowDevTools&&window.AppApi.ShowDevTools(),console.group("\u{1FA9D} Registered Hooks"),console.log("Pre-hooks:",Object.keys(window.customjs.hooks.pre)),console.log("Post-hooks:",Object.keys(window.customjs.hooks.post)),console.log("Void-hooks:",Object.keys(window.customjs.hooks.void)),console.log("Replace-hooks:",Object.keys(window.customjs.hooks.replace)),console.groupEnd(),window.customjs.hooks}testEvent(e,o){this.emit(e,o),this.logger.log(`Emitted event: ${e}`,o)}inspectPlugin(e){window.AppApi?.ShowDevTools&&window.AppApi.ShowDevTools();const o=window.customjs.modules.find(t=>t.metadata.id===e);return o?(console.group(`\u{1F50D} Plugin: ${o.metadata.name}`),console.log("Metadata:",o.metadata),console.table({enabled:o.enabled,loaded:o.loaded,started:o.started}),console.log("Resources:",o.resources),console.log("Settings:",o.settings?.store),console.groupEnd()):console.warn(`Plugin not found: ${e}`),o}searchVariable(e,o={}){const t=o.maxDepth||5,n=o.caseSensitive||!1,i=o.exactMatch||!1,c=o.root||window,a=[],f=new WeakSet,L=n?e:e.toLowerCase(),I=h((s,S,d)=>{if(!(d>t)&&s!=null&&!(typeof s!="object"&&typeof s!="function")&&!f.has(s)){f.add(s);try{const $=Object.getOwnPropertyNames(s);for(const g of $)try{const u=S?`${S}.${g}`:g,b=n?g:g.toLowerCase();if(i?b===L:b.includes(L)){let r,l;try{const p=Object.getOwnPropertyDescriptor(s,g);p&&p.get&&!p.set?(r="[Getter]",l="getter"):(r=s[g],l=typeof r)}catch{r="[Access Error]",l="error"}a.push({path:u,key:g,type:l,value:r})}if(d<t)try{const r=s[g];r&&(typeof r=="object"||typeof r=="function")&&I(r,u,d+1)}catch{}}catch{}}catch{}}},"search");return this.logger.log(`Searching for "${e}" (max depth: ${t})...`),I(c,"",0),window.AppApi?.ShowDevTools&&window.AppApi.ShowDevTools(),console.group(`\u{1F50D} Search results for "${e}" (${a.length} matches)`),a.forEach(s=>{s.type==="getter"||s.type==="error"?console.log(`${s.path} [${s.type}]`):console.log(`${s.path} [${s.type}]`,s.value)}),console.groupEnd(),this.logger.log(`Found ${a.length} matches`),a}};h(w,"DebugPlugin");let m=w;window.customjs.__LAST_PLUGIN_CLASS__=m;})();
