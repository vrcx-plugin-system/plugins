(()=>{var u=Object.defineProperty;var d=(m,t)=>u(m,"name",{value:t,configurable:!0});const h=class h extends CustomModule{constructor(){super({name:"Dialog API \u{1F4AC}",description:"API for creating and showing custom dialogs in VRCX",authors:[{name:"Bluscream",description:"VRCX Plugin System Maintainer",userId:"usr_08082729-592d-4098-9a21-83c8dd37a844"}],tags:["API","Core","Dialog","Library"],required_dependencies:[]}),this.customDialogs=new Map,this.dialogContainers=new Map,this.dialogWrapperElement=null}async load(){this.registerEvent("ShowUserDialog",{description:"Fired when a user dialog is opened",payload:{userId:"string - User ID that was opened",timestamp:"number - Unix timestamp"},broadcastIPC:!1,logToConsole:!0}),this.registerEvent("ShowWorldDialog",{description:"Fired when a world dialog is opened",payload:{worldId:"string - World ID or location tag",shortName:"string - Optional short name",timestamp:"number - Unix timestamp"},broadcastIPC:!0,logToConsole:!0}),this.registerEvent("ShowAvatarDialog",{description:"Fired when an avatar dialog is opened",payload:{avatarId:"string - Avatar ID that was opened",timestamp:"number - Unix timestamp"},broadcastIPC:!0,logToConsole:!0}),this.registerEvent("ShowGroupDialog",{description:"Fired when a group dialog is opened",payload:{groupId:"string - Group ID that was opened",timestamp:"number - Unix timestamp"},broadcastIPC:!0,logToConsole:!0}),this.registerEvent("ShowLaunchDialog",{description:"Fired when a VRChat launch dialog is opened",payload:{location:"string - Location tag",shortName:"string - Optional short name",timestamp:"number - Unix timestamp"},broadcastIPC:!0,logToConsole:!0}),this.logger.log("Dialog API ready"),this.loaded=!0}async start(){await this.setupDialogWrapper(),this.setupDialogHooks(),this.enabled=!0,this.started=!0,this.logger.log("Dialog API started")}setupDialogHooks(){this.registerPreHook("$pinia.user.showUserDialog",t=>{const e=t[0];e&&this.emit("ShowUserDialog",{userId:e,timestamp:Date.now()})}),this.registerPreHook("$pinia.world.showWorldDialog",t=>{const e=t[0],o=t[1];e&&this.emit("ShowWorldDialog",{worldId:e,shortName:o||"",timestamp:Date.now()})}),this.registerPreHook("$pinia.avatar.showAvatarDialog",t=>{const e=t[0];e&&this.emit("ShowAvatarDialog",{avatarId:e,timestamp:Date.now()})}),this.registerPreHook("$pinia.group.showGroupDialog",t=>{const e=t[0];e&&this.emit("ShowGroupDialog",{groupId:e,timestamp:Date.now()})}),this.registerPreHook("$pinia.launch.showLaunchDialog",t=>{const e=t[0],o=t[1];e&&this.emit("ShowLaunchDialog",{location:e,shortName:o||"",timestamp:Date.now()})}),this.logger.log("Dialog hooks registered for user, world, avatar, group, and launch dialogs")}async stop(){this.logger.log("Stopping Dialog API"),this.closeAllDialogs(),this.dialogWrapperElement&&this.dialogWrapperElement.parentNode&&this.dialogWrapperElement.parentNode.removeChild(this.dialogWrapperElement),await super.stop()}async setupDialogWrapper(){return new Promise(t=>{const e=d(()=>{this.dialogWrapperElement=document.createElement("div"),this.dialogWrapperElement.id="customjs-dialog-wrapper",this.dialogWrapperElement.style.cssText="position: relative; z-index: 2000;",(document.querySelector("#app")||document.body).appendChild(this.dialogWrapperElement),this.logger.log("Dialog wrapper created"),t()},"createWrapper");document.readyState==="loading"?document.addEventListener("DOMContentLoaded",e):e()})}registerDialog(t,e){this.customDialogs.has(t)&&this.logger.warn(`Dialog ${t} already exists, overwriting`);const o={id:t,visible:!1,title:e.title||"Custom Dialog",width:e.width||"600px",content:e.content||"",showClose:e.showClose!==!1,closeOnClickModal:e.closeOnClickModal!==!1,closeOnPressEscape:e.closeOnPressEscape!==!1,fullscreen:e.fullscreen||!1,top:e.top||"15vh",modal:e.modal!==!1,draggable:e.draggable||!1,footer:e.footer,beforeClose:e.beforeClose,onOpen:e.onOpen,onClose:e.onClose};return this.customDialogs.set(t,o),this.logger.log(`Registered dialog: ${t}`),this.createDialogController(t)}createDialogController(t){return{show:()=>this.showDialog(t),hide:()=>this.closeDialog(t),toggle:()=>this.toggleDialog(t),setTitle:e=>this.setDialogTitle(t,e),setContent:e=>this.setDialogContent(t,e),isVisible:()=>this.isDialogVisible(t),destroy:()=>this.destroyDialog(t)}}async showConfirmDialogAsync(t,e,o="info",i="Confirm",s="Cancel"){try{const n=window.$app?.config?.globalProperties?.$confirm;if(n)try{return await n(e,t,{confirmButtonText:i,cancelButtonText:s,type:o}),!0}catch{return!1}this.logger.log("Using native confirm dialog (Element Plus not available)");const a=`${t}

${e}`;return confirm(a)}catch(n){this.logger.warn(`Error showing confirm dialog: ${n.message}`);const a=`${t}

${e}`;return confirm(a)}}showDialog(t){const e=this.customDialogs.get(t);if(!e)return this.logger.error(`Dialog ${t} not found`),!1;if(e.visible)return this.logger.warn(`Dialog ${t} is already visible`),!1;if(e.visible=!0,e.onOpen)try{e.onOpen()}catch(o){const i=o instanceof Error?o.message:String(o);this.logger.error(`Error in onOpen callback for ${t}: ${i}`)}return this.renderDialog(t),this.logger.log(`Showing dialog: ${t}`),!0}closeDialog(t){const e=this.customDialogs.get(t);if(!e)return this.logger.error(`Dialog ${t} not found`),!1;if(!e.visible)return!1;if(e.beforeClose)try{if(e.beforeClose()===!1)return!1}catch(i){const s=i instanceof Error?i.message:String(i);this.logger.error(`Error in beforeClose callback for ${t}: ${s}`)}e.visible=!1;const o=this.dialogContainers.get(t);if(o&&(o.style.display="none"),e.onClose)try{e.onClose()}catch(i){const s=i instanceof Error?i.message:String(i);this.logger.error(`Error in onClose callback for ${t}: ${s}`)}return this.logger.log(`Closed dialog: ${t}`),!0}toggleDialog(t){const e=this.customDialogs.get(t);if(!e){this.logger.error(`Dialog ${t} not found`);return}e.visible?this.closeDialog(t):this.showDialog(t)}setDialogTitle(t,e){const o=this.customDialogs.get(t);if(!o){this.logger.error(`Dialog ${t} not found`);return}if(o.title=e,o.visible){const i=this.dialogContainers.get(t);if(i){const s=i.querySelector(".dialog-title");s&&(s.textContent=e)}}}setDialogContent(t,e){const o=this.customDialogs.get(t);if(!o){this.logger.error(`Dialog ${t} not found`);return}if(o.content=e,o.visible){const i=this.dialogContainers.get(t);if(i){const s=i.querySelector(".dialog-body");s&&(typeof e=="string"?s.innerHTML=e:e instanceof HTMLElement&&(s.innerHTML="",s.appendChild(e)))}}}isDialogVisible(t){const e=this.customDialogs.get(t);return e?e.visible:!1}destroyDialog(t){this.closeDialog(t);const e=this.dialogContainers.get(t);e&&e.parentNode&&e.parentNode.removeChild(e),this.dialogContainers.delete(t),this.customDialogs.delete(t),this.logger.log(`Destroyed dialog: ${t}`)}renderDialog(t){const e=this.customDialogs.get(t);if(!e||!this.dialogWrapperElement)return;let o=this.dialogContainers.get(t);if(o||(o=document.createElement("div"),o.className="customjs-dialog-container",o.setAttribute("data-dialog-id",t),this.dialogWrapperElement.appendChild(o),this.dialogContainers.set(t,o)),o.innerHTML="",o.style.display=e.visible?"block":"none",e.modal){const r=document.createElement("div");r.className="el-overlay",r.style.cssText="z-index: 2000;";const c=document.createElement("div");c.className="el-overlay-dialog",e.closeOnClickModal&&this.registerListener(c,"click",()=>{this.closeDialog(t)}),r.appendChild(c),o.appendChild(r)}const i=document.createElement("div");i.className="el-dialog__wrapper",i.style.cssText=`
      position: fixed;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
      overflow: auto;
      margin: 0;
      z-index: 2001;
      display: flex;
      align-items: ${e.fullscreen?"stretch":"center"};
      justify-content: center;
    `;const s=document.createElement("div");s.className="el-dialog x-dialog customjs-dialog",s.style.cssText=`
      position: relative;
      margin: ${e.fullscreen?"0":e.top+" auto 50px"};
      background: #2a2a2a;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
      box-sizing: border-box;
      width: ${e.fullscreen?"100%":e.width};
      height: ${e.fullscreen?"100%":"auto"};
      max-width: ${e.fullscreen?"100%":"calc(100% - 30px)"};
      ${e.draggable?"cursor: move;":""}
    `;const n=document.createElement("div");n.className="el-dialog__header",n.style.cssText=`
      padding: 15px 20px;
      padding-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #404040;
    `;const a=document.createElement("span");if(a.className="el-dialog__title dialog-title",a.style.cssText="color: #e8e8e8; font-size: 18px; font-weight: 600;",a.textContent=e.title,n.appendChild(a),e.showClose){const r=document.createElement("button");r.className="el-dialog__headerbtn",r.style.cssText=`
        position: absolute;
        top: 15px;
        right: 20px;
        padding: 0;
        background: transparent;
        border: none;
        outline: none;
        cursor: pointer;
        font-size: 16px;
        color: #909399;
      `,r.innerHTML='<i class="el-icon el-dialog__close"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" style="width: 1em; height: 1em;"><path fill="currentColor" d="M764.288 214.592 512 466.88 259.712 214.592a31.936 31.936 0 0 0-45.12 45.12L466.752 512 214.528 764.224a31.936 31.936 0 1 0 45.12 45.184L512 557.184l252.288 252.288a31.936 31.936 0 0 0 45.12-45.12L557.12 512.064l252.288-252.352a31.936 31.936 0 1 0-45.12-45.184z"></path></svg></i>',this.registerListener(r,"click",()=>{this.closeDialog(t)}),n.appendChild(r)}s.appendChild(n);const l=document.createElement("div");if(l.className="el-dialog__body dialog-body",l.style.cssText="padding: 20px; color: #e8e8e8; font-size: 14px;",typeof e.content=="string"?l.innerHTML=e.content:e.content instanceof HTMLElement&&l.appendChild(e.content),s.appendChild(l),e.footer){const r=document.createElement("div");r.className="el-dialog__footer",r.style.cssText="padding: 10px 20px 15px; text-align: right; border-top: 1px solid #404040;",typeof e.footer=="string"?r.innerHTML=e.footer:e.footer instanceof HTMLElement&&r.appendChild(e.footer),s.appendChild(r)}if(e.draggable&&this.makeDraggable(s,n),e.closeOnPressEscape){const r=d(c=>{c.key==="Escape"&&e.visible&&this.closeDialog(t)},"escHandler");this.registerListener(document,"keydown",r)}i.appendChild(s),o.appendChild(i)}makeDraggable(t,e){let o=!1,i=0,s=0,n=0,a=0;const l=d(g=>{n=g.clientX-i,a=g.clientY-s,(g.target===e||e.contains(g.target))&&(o=!0)},"dragStart"),r=d(g=>{o&&(g.preventDefault(),i=g.clientX-n,s=g.clientY-a,t.style.transform=`translate(${i}px, ${s}px)`)},"drag"),c=d(()=>{o=!1},"dragEnd");this.registerListener(e,"mousedown",l),this.registerListener(document,"mousemove",r),this.registerListener(document,"mouseup",c)}closeAllDialogs(){for(const[t]of this.customDialogs)this.closeDialog(t)}getAllDialogIds(){return Array.from(this.customDialogs.keys())}getDialog(t){return this.customDialogs.get(t)}};d(h,"DialogApiPlugin");let p=h;window.customjs.__LAST_PLUGIN_CLASS__=p;})();
