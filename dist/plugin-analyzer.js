(()=>{var h=Object.defineProperty;var u=(g,e)=>h(g,"name",{value:e,configurable:!0});const d=class d extends CustomModule{constructor(){super({name:"\u{1F50D} Plugin Analyzer",description:"Analyzes plugin code and shows detailed metadata and statistics",authors:[{name:"Bluscream"}],tags:["Tool","Utility","Analysis"],dependencies:["https://github.com/vrcx-plugin-system/plugins/raw/refs/heads/main/dist/dialog-api.js"]})}async load(){this.logger.log("Plugin Analyzer ready"),this.loaded=!0}async start(){if(this.dialogApi=await window.customjs.waitForModule("dialog-api"),!this.dialogApi){this.logger.error("Dialog API not found! Please enable the Dialog API plugin.");return}this.enabled=!0,this.started=!0,this.logger.log("Plugin Analyzer started")}async stop(){if(this.logger.log("Stopping Plugin Analyzer"),this.dialogApi){const e=this.dialogApi.getAllDialogIds();for(const s of e)s.startsWith("plugin-analysis-")&&this.dialogApi.destroyDialog(s)}await super.stop()}async analyzePlugin(e){if(!e){this.logger.warn("No URL provided for analysis"),this.logger.showWarning("Plugin URL not available");return}try{this.logger.log(`\u{1F50D} Analyzing plugin: ${e}`),this.logger.showInfo("Analyzing plugin code...");let s=null,o=null,n=null;if(window.customjs?.modules&&(n=window.customjs.modules.find(i=>i.metadata?.url===e),n&&this.logger.log(`\u2713 Found loaded module instance: ${n.metadata.name}`)),window.customjs?.repos){for(const i of window.customjs.repos){if(!i.getModules)continue;const r=i.getModules().find(p=>p.url===e);if(r){s=r,o=r.sourceUrl,this.logger.log(`\u2713 Found module in repository: ${i.url}`),this.logger.log(`  \u2192 Source URL: ${o||"Not available"}`);break}}s||this.logger.log("Module not found in any repository, using URL-only analysis")}const t=window.customjs.classes.CustomModule;if(!t?.fetchMetadata){this.logger.error("CustomModule.fetchMetadata not available"),this.logger.showError("Analysis feature not available");return}const l=await t.fetchMetadata(e);if(l){const i={...l,sourceUrl:o||l.sourceUrl,repoData:s,loadedModule:n,isLoaded:!!n,isStarted:n?.started||!1,isEnabled:n?.enabled||!1};this.logger.log("Plugin analysis complete",i),this.showAnalysisDialog(i)}else this.logger.error("Failed to extract metadata"),this.logger.showError("Failed to analyze plugin")}catch(s){this.logger.error("Error analyzing plugin:",s),this.logger.showError(`Analysis error: ${s.message}`)}}showAnalysisDialog(e){const s=`plugin-analysis-${Date.now()}`,o=this.buildAnalysisContent(e);this.dialogApi.registerDialog(s,{title:`\u{1F50D} Plugin Analysis: ${e.name||"Unknown"}`,content:o,width:"900px",modal:!0,closeOnClickModal:!0,closeOnPressEscape:!0,onClose:()=>{this.dialogApi.destroyDialog(s)}}).show(),this.logger.showSuccess("Analysis complete")}buildAnalysisContent(e){const s=document.createElement("div");s.style.cssText="padding: 0;";const o={Name:e.name,Description:e.description,Authors:e.authors?.map(t=>t.name).join(", ")||"Unknown",Build:e.build,"Class Name":e.className,URL:e.url};e.sourceUrl&&(o["Source URL"]=e.sourceUrl),e.repoData&&(e.repoData.id&&(o["Module ID"]=e.repoData.id),e.repoData.enabled!==void 0&&(o["Enabled by Default"]=e.repoData.enabled?"Yes":"No")),e.isLoaded?o.Status=e.isStarted?e.isEnabled?"\u2713 Running":"Stopped":"Loaded (not started)":o.Status="Not loaded";const n=[{title:"Basic Information",data:o},{title:"Code Metrics",data:{Size:e.sizeFormatted,"Line Count":e.lineCount,"Function Count":e.functionCount,"Event Handlers":e.eventHandlerCount}},{title:"Settings",data:{"Settings Count":e.settingsCount,"Categories Count":e.categoriesCount}},{title:"Resource Registrations",data:{Observers:e.observerCount,Listeners:e.listenerCount,Subscriptions:e.subscriptionCount,Hooks:e.hookCount,Timers:e.timerCount}},{title:"Lifecycle Methods",data:{"Has load()":e.lifecycle?.hasLoad?"\u2713":"\u2717","Has start()":e.lifecycle?.hasStart?"\u2713":"\u2717","Has stop()":e.lifecycle?.hasStop?"\u2713":"\u2717","Has onLogin()":e.lifecycle?.hasOnLogin?"\u2713":"\u2717"}},{title:"External APIs",data:{AppApi:e.externalApis?.usesAppApi?"\u2713":"\u2717",Pinia:e.externalApis?.usesPinia?"\u2713":"\u2717","Vue Router":e.externalApis?.usesVueRouter?"\u2713":"\u2717","VRCX API":e.externalApis?.usesVRCXAPI?"\u2713":"\u2717","Web API":e.externalApis?.usesWebAPI?"\u2713":"\u2717"}},{title:"Resource Usage",data:{"Creates DOM":e.resourceUsage?.createsDomElements?"\u2713":"\u2717","Modifies DOM":e.resourceUsage?.modifiesDom?"\u2713":"\u2717",localStorage:e.resourceUsage?.usesLocalStorage?"\u2713":"\u2717",sessionStorage:e.resourceUsage?.usesSessionStorage?"\u2713":"\u2717",WebSocket:e.resourceUsage?.usesWebSocket?"\u2713":"\u2717"}}];if(e.tags&&e.tags.length>0&&n.push({title:"Tags",data:{"Tag List":e.tags.join(", ")}}),e.dependencies&&e.dependencies.length>0&&n.push({title:"Dependencies",data:{"Dependency Count":e.dependencies.length}}),n.forEach(t=>{const l=this.createAnalysisSection(t.title,t.data);s.appendChild(l)}),e.sourceCode){const t=document.createElement("div");t.style.cssText="margin-top: 20px;";const l=document.createElement("h4");l.style.cssText="margin: 0 0 10px 0; color: #409eff; font-size: 14px; text-transform: uppercase;",l.textContent="Source Code";const i=document.createElement("pre");i.style.cssText=`
        background: #1e1e1e;
        padding: 15px;
        border-radius: 4px;
        overflow-x: auto;
        max-height: 400px;
        font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
        font-size: 12px;
        color: #d4d4d4;
        line-height: 1.5;
      `,i.textContent=e.sourceCode,t.appendChild(l),t.appendChild(i),s.appendChild(t)}return s}createAnalysisSection(e,s){const o=document.createElement("div");o.style.cssText="margin-bottom: 15px;";const n=document.createElement("h4");n.style.cssText="margin: 0 0 8px 0; color: #409eff; font-size: 14px; text-transform: uppercase;",n.textContent=e;const t=document.createElement("div");return t.style.cssText=`
      display: grid;
      grid-template-columns: 200px 1fr;
      gap: 8px;
      font-size: 13px;
    `,Object.entries(s).forEach(([l,i])=>{if(i==null)return;const c=document.createElement("div");c.style.cssText="color: #909090; font-weight: 500;",c.textContent=l+":";const r=document.createElement("div");r.style.cssText="color: #e0e0e0;",r.textContent=String(i),t.appendChild(c),t.appendChild(r)}),o.appendChild(n),o.appendChild(t),o}};u(d,"PluginAnalyzerPlugin");let a=d;window.customjs.__LAST_PLUGIN_CLASS__=a;})();
