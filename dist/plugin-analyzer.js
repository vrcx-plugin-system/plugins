(()=>{var f=Object.defineProperty;var p=(h,e)=>f(h,"name",{value:e,configurable:!0});const g=class g extends CustomModule{constructor(){super({name:"Plugin Analyzer \u{1F50D}",description:"Analyzes plugin code and shows detailed metadata and statistics",authors:[{name:"Bluscream",description:"VRCX Plugin System Maintainer",userId:"usr_08082729-592d-4098-9a21-83c8dd37a844"}],tags:["Tool","Utility","Analysis"],required_dependencies:["dialog-api"]})}async load(){this.logger.log("Plugin Analyzer ready"),this.loaded=!0}async start(){if(this.dialogApi=await window.customjs.waitForModule("dialog-api"),!this.dialogApi){this.logger.error("Dialog API not found! Please enable the Dialog API plugin.");return}this.enabled=!0,this.started=!0,this.logger.log("Plugin Analyzer started")}async stop(){if(this.logger.log("Stopping Plugin Analyzer"),this.dialogApi){const e=this.dialogApi.getAllDialogIds();for(const s of e)s.startsWith("plugin-analysis-")&&this.dialogApi.destroyDialog(s)}await super.stop()}async analyzePlugin(e){if(!e){this.logger.warn("No URL provided for analysis"),this.logger.showWarning("Plugin URL not available");return}try{this.logger.log(`\u{1F50D} Analyzing plugin: ${e}`),this.logger.showInfo("Analyzing plugin code...");let s=null,o=null,n=null;if(window.customjs?.modules&&(n=window.customjs.modules.find(l=>l.metadata?.url===e),n&&this.logger.log(`\u2713 Found loaded module instance: ${n.metadata.name}`)),window.customjs?.repos){for(const l of window.customjs.repos){if(!l.getModules)continue;const t=l.getModules().find(a=>a.url===e);if(t){s=t,o=t.sourceUrl,this.logger.log(`\u2713 Found module in repository: ${l.url}`),this.logger.log(`  \u2192 Source URL: ${o||"Not available"}`);break}}s||this.logger.log("Module not found in any repository, using URL-only analysis")}const i=window.customjs.classes.CustomModule;if(!i?.fetchMetadata){this.logger.error("CustomModule.fetchMetadata not available"),this.logger.showError("Analysis feature not available");return}const c=await i.fetchMetadata(e);if(c){let l=c.sourceCode,r=null;if(o)try{const a=await fetch(o+"?v="+Date.now());a.ok&&(r=await a.text(),this.logger.log(`\u2713 Fetched original source (${r.length} bytes)`))}catch(a){this.logger.warn(`Failed to fetch original source: ${a instanceof Error?a.message:String(a)}`)}const t={...c,sourceUrl:o||c.sourceUrl,minifiedCode:l,originalCode:r,repoData:s,loadedModule:n,isLoaded:!!n,isStarted:n?.started||!1,isEnabled:n?.enabled||!1};this.logger.log("Plugin analysis complete",t),this.showAnalysisDialog(t)}else this.logger.error("Failed to extract metadata"),this.logger.showError("Failed to analyze plugin")}catch(s){const o=s instanceof Error?s.message:String(s);this.logger.error(`Error analyzing plugin: ${o}`),this.logger.showError(`Analysis error: ${o}`)}}showAnalysisDialog(e){const s=`plugin-analysis-${Date.now()}`,o=this.buildAnalysisContent(e);this.dialogApi.registerDialog(s,{title:`\u{1F50D} Plugin Analysis: ${e.name||"Unknown"}`,content:o,width:"900px",modal:!0,closeOnClickModal:!0,closeOnPressEscape:!0,onClose:()=>{this.dialogApi.destroyDialog(s)}}).show(),this.logger.showSuccess("Analysis complete")}buildAnalysisContent(e){const s=document.createElement("div");s.style.cssText="padding: 0;";const o={Name:e.name,Description:e.description,Authors:e.authors?.map(i=>i.name).join(", ")||"Unknown",Build:e.build,"Class Name":e.className,URL:e.url};e.sourceUrl&&(o["Source URL"]=e.sourceUrl),e.repoData&&(e.repoData.id&&(o["Module ID"]=e.repoData.id),e.repoData.enabled!==void 0&&(o["Enabled by Default"]=e.repoData.enabled?"Yes":"No")),e.isLoaded?o.Status=e.isStarted?e.isEnabled?"\u2713 Running":"Stopped":"Loaded (not started)":o.Status="Not loaded";const n=[{title:"Basic Information",data:o},{title:"Code Metrics",data:{"Minified Size":this.formatBytes(e.minifiedCode?.length||0),"Original Size":e.originalCode?this.formatBytes(e.originalCode.length):"N/A","Size Reduction":e.originalCode?`${Math.round((1-(e.minifiedCode?.length||0)/e.originalCode.length)*100)}%`:"N/A","Line Count":e.lineCount,"Function Count":e.functionCount,"Event Handlers":e.eventHandlerCount}},{title:"Settings",data:{"Settings Count":e.settingsCount,"Categories Count":e.categoriesCount}},{title:"Resource Registrations",data:{Observers:e.observerCount,Listeners:e.listenerCount,Subscriptions:e.subscriptionCount,Hooks:e.hookCount,Timers:e.timerCount}},{title:"Lifecycle Methods",data:{"Has load()":e.lifecycle?.hasLoad?"\u2713":"\u2717","Has start()":e.lifecycle?.hasStart?"\u2713":"\u2717","Has stop()":e.lifecycle?.hasStop?"\u2713":"\u2717","Has onLogin()":e.lifecycle?.hasOnLogin?"\u2713":"\u2717"}},{title:"External APIs",data:{AppApi:e.externalApis?.usesAppApi?"\u2713":"\u2717",Pinia:e.externalApis?.usesPinia?"\u2713":"\u2717","Vue Router":e.externalApis?.usesVueRouter?"\u2713":"\u2717","VRCX API":e.externalApis?.usesVRCXAPI?"\u2713":"\u2717","Web API":e.externalApis?.usesWebAPI?"\u2713":"\u2717"}},{title:"Resource Usage",data:{"Creates DOM":e.resourceUsage?.createsDomElements?"\u2713":"\u2717","Modifies DOM":e.resourceUsage?.modifiesDom?"\u2713":"\u2717",localStorage:e.resourceUsage?.usesLocalStorage?"\u2713":"\u2717",sessionStorage:e.resourceUsage?.usesSessionStorage?"\u2713":"\u2717",WebSocket:e.resourceUsage?.usesWebSocket?"\u2713":"\u2717"}}];if(e.tags&&e.tags.length>0&&n.push({title:"Tags",data:{"Tag List":e.tags.join(", ")}}),e.dependencies&&e.dependencies.length>0&&n.push({title:"Dependencies",data:{"Dependency Count":e.dependencies.length}}),n.forEach(i=>{const c=this.createAnalysisSection(i.title,i.data);s.appendChild(c)}),e.minifiedCode||e.originalCode){const i=document.createElement("div");i.style.cssText="margin-top: 20px;";const c=document.createElement("h4");c.style.cssText="margin: 0 0 10px 0; color: #409eff; font-size: 14px; text-transform: uppercase;",c.textContent="Source Code";const l=document.createElement("div");l.style.cssText="display: flex; gap: 10px; margin-bottom: 10px;";const r=document.createElement("button");r.className="el-button el-button--small el-button--primary",r.textContent=`Minified (${this.formatBytes(e.minifiedCode?.length||0)})`,r.style.cssText="flex: 1;";let t=null;e.originalCode&&(t=document.createElement("button"),t.className="el-button el-button--small",t.textContent=`Original (${this.formatBytes(e.originalCode.length)})`,t.style.cssText="flex: 1;");const a=document.createElement("pre");a.style.cssText=`
        background: #1e1e1e;
        padding: 15px;
        border-radius: 4px;
        overflow-x: auto;
        max-height: 400px;
        font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
        font-size: 12px;
        color: #d4d4d4;
        line-height: 1.5;
        display: block;
      `,a.textContent=e.minifiedCode||"";let d=null;e.originalCode&&(d=document.createElement("pre"),d.style.cssText=`
          background: #1e1e1e;
          padding: 15px;
          border-radius: 4px;
          overflow-x: auto;
          max-height: 400px;
          font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
          font-size: 12px;
          color: #d4d4d4;
          line-height: 1.5;
          display: none;
        `,d.textContent=e.originalCode),this.registerListener(r,"click",()=>{r.className="el-button el-button--small el-button--primary",t&&(t.className="el-button el-button--small"),a.style.display="block",d&&(d.style.display="none")}),t&&d&&this.registerListener(t,"click",()=>{t.className="el-button el-button--small el-button--primary",r.className="el-button el-button--small",a.style.display="none",d.style.display="block"}),i.appendChild(c),l.appendChild(r),t&&l.appendChild(t),i.appendChild(l),i.appendChild(a),d&&i.appendChild(d),s.appendChild(i)}return s}formatBytes(e){if(e===0)return"0 B";const s=1024,o=["B","KB","MB"],n=Math.floor(Math.log(e)/Math.log(s));return Math.round(e/Math.pow(s,n)*100)/100+" "+o[n]}createAnalysisSection(e,s){const o=document.createElement("div");o.style.cssText="margin-bottom: 15px;";const n=document.createElement("h4");n.style.cssText="margin: 0 0 8px 0; color: #409eff; font-size: 14px; text-transform: uppercase;",n.textContent=e;const i=document.createElement("div");return i.style.cssText=`
      display: grid;
      grid-template-columns: 200px 1fr;
      gap: 8px;
      font-size: 13px;
    `,Object.entries(s).forEach(([c,l])=>{if(l==null)return;const r=document.createElement("div");r.style.cssText="color: #909090; font-weight: 500;",r.textContent=c+":";const t=document.createElement("div");t.style.cssText="color: #e0e0e0;",t.textContent=String(l),i.appendChild(r),i.appendChild(t)}),o.appendChild(n),o.appendChild(i),o}};p(g,"PluginAnalyzerPlugin");let u=g;window.customjs.__LAST_PLUGIN_CLASS__=u;})();
