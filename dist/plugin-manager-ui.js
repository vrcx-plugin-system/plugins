(()=>{var M=Object.defineProperty;var T=(E,e)=>M(E,"name",{value:e,configurable:!0});const C=class C extends CustomModule{constructor(){super({name:"\u{1F9E9} Plugin Manager UI",description:"Visual UI for managing VRCX custom plugins - Equicord inspired",authors:[{name:"Bluscream",description:"VRCX Plugin System Maintainer",userId:"usr_08082729-592d-4098-9a21-83c8dd37a844"}],tags:["UI","Core","Settings"],dependencies:["nav-menu-api","dialog-api","plugin-analyzer"]}),this.settingsModal=null,this.searchValue={value:"",filter:"all"},this.togglingPlugins=new Set}async load(){this.logger.log("Plugin Manager UI ready"),this.loaded=!0}async start(){if(this.utils=window.customjs.utils,this.navMenuApi=await window.customjs.waitForModule("nav-menu-api"),this.dialogApi=await window.customjs.waitForModule("dialog-api"),this.pluginAnalyzer=await window.customjs.waitForModule("plugin-analyzer"),!this.navMenuApi){this.logger.error("Nav Menu API plugin not found");return}if(!this.dialogApi){this.logger.error("Dialog API plugin not found");return}if(!this.pluginAnalyzer){this.logger.error("Plugin Analyzer plugin not found");return}this.setupNavMenuItem(),this.enabled=!0,this.started=!0,this.logger.log("Plugin Manager UI started")}async onLogin(e){}async stop(){this.logger.log("Stopping Plugin Manager UI"),this.navMenuApi&&this.navMenuApi.removeItem("plugins"),this.settingsModal&&(this.settingsModal.remove(),this.settingsModal=null),await super.stop()}setupNavMenuItem(){if(!this.navMenuApi){this.logger.error("NavMenu plugin not found!");return}this.logger.log("Setting up Plugins nav menu item"),this.navMenuApi.addItem("plugins",{label:"Plugins",icon:"ri-plug-line",content:()=>this.createPanelContent(),before:"settings",onShow:()=>this.onPluginsTabShown(),onHide:()=>this.onPluginsTabHidden()}),this.logger.log("\u2713 Plugins nav menu item registered")}onPluginsTabShown(){this.logger.log("\u{1F3AF} Plugins tab shown - user navigated to Plugins view"),setTimeout(()=>this.refreshPluginGrid(),50)}onPluginsTabHidden(){this.logger.log("\u{1F44B} Plugins tab hidden - user navigated away from Plugins view")}createPanelContent(){this.logger.log("\u{1F3A8} Creating plugin manager panel content");const e=document.createElement("div");e.style.cssText=`
      padding: 20px;
      max-width: 1400px;
      margin: 0 auto;
    `;try{this.logger.log("  \u2192 Building stats section"),e.appendChild(this.createStatsSection()),this.logger.log("  \u2192 Building repository management section"),e.appendChild(this.createRepoManagementSection()),this.logger.log("  \u2192 Building config sync section"),e.appendChild(this.createConfigSyncSection()),this.logger.log("  \u2192 Building load plugin section"),e.appendChild(this.createLoadPluginSection()),this.logger.log("  \u2192 Building filter section"),e.appendChild(this.createFilterSection());const t=document.createElement("div");t.id="plugin-grid-container",t.className="vc-plugins-grid",e.appendChild(t),this.pluginGridContainer=t,this.logger.log("\u2713 Plugin manager panel content created successfully")}catch(t){this.logger.error("Error creating plugin manager content:",t);const s=document.createElement("div");s.style.cssText="padding: 20px; text-align: center; color: #dc3545;";const n=document.createElement("h3");n.textContent="\u274C Error Loading Plugin Manager";const o=document.createElement("p");o.textContent=t.message;const i=document.createElement("button");i.className="el-button el-button--primary",i.innerHTML='<i class="ri-restart-line"></i> Reload VRCX',this.registerListener(i,"click",()=>location.reload()),s.appendChild(n),s.appendChild(o),s.appendChild(i),e.appendChild(s)}return e}createStatsSection(){const e=document.createElement("div");e.style.cssText="margin-bottom: 12px;";const t=document.createElement("div");t.style.cssText="display: grid; grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); gap: 6px; margin-bottom: 10px;";const s=window.customjs?.modules||[],n=window.customjs?.coreModules||[],o=new Set,i=(window.customjs.repos||[]).length,r=(window.customjs.repos||[]).filter(g=>g.enabled).length,l=s.filter(g=>g.enabled).length,c=s.filter(g=>g.started).length;return[{label:"Repos",value:`${r}/${i}`,color:"#9c27b0"},{label:"Plugins",value:s.length,color:"#28a745"},{label:"Core Modules",value:n instanceof Map?n.size:n.length,color:"#28a745"}].forEach(g=>{const a=this.createStatCard(g.label,g.value,g.color);t.appendChild(a)}),e.appendChild(t),e}createStatCard(e,t,s){const n=document.createElement("div");n.style.cssText=`
      text-align: center;
      padding: 6px 8px;
      background: ${s};
      border-radius: 3px;
      color: white;
      box-shadow: 0 1px 2px ${window.customjs.utils.hexToRgba(s,.3)};
      transition: transform 0.15s, box-shadow 0.15s;
    `;const o=document.createElement("div");o.style.cssText="font-size: 16px; font-weight: 600;",o.textContent=t;const i=document.createElement("div");return i.style.cssText="font-size: 9px; opacity: 0.85; margin-top: 1px;",i.textContent=e,n.appendChild(o),n.appendChild(i),this.registerListener(n,"mouseenter",()=>{n.style.transform="translateY(-1px)",n.style.boxShadow=`0 2px 6px ${window.customjs.utils.hexToRgba(s,.4)}`}),this.registerListener(n,"mouseleave",()=>{n.style.transform="translateY(0)",n.style.boxShadow=`0 1px 3px ${window.customjs.utils.hexToRgba(s,.3)}`}),n}createRepoManagementSection(){const e=document.createElement("div");e.style.cssText="margin-bottom: 20px;";const t=document.createElement("h5");t.style.cssText="margin: 0 0 12px 0; font-size: 16px; font-weight: 600;",t.textContent="\u{1F4E6} Plugin Repositories",e.appendChild(t);const s=document.createElement("p");s.style.cssText="margin: 0 0 12px 0; font-size: 14px; color: #6c757d;",s.textContent="Manage plugin repositories to install and update plugins",e.appendChild(s);const n=document.createElement("div");n.id="repo-list-container",n.style.cssText="margin-bottom: 12px;",e.appendChild(n);const o=document.createElement("div");o.style.cssText="display: flex; gap: 10px; margin-bottom: 10px;";const i=document.createElement("input");i.type="text",i.placeholder="https://example.com/repo.json",i.className="el-input__inner",i.style.cssText="flex: 1; padding: 8px 12px; border: 1px solid #5a5a5a; border-radius: 4px; font-size: 13px; font-family: 'Consolas', monospace; background: #1e1e1e; color: #e0e0e0;";const r=document.createElement("button");r.className="el-button el-button--primary",r.innerHTML='<i class="ri-add-line"></i> Add Repository',this.registerListener(r,"click",async()=>{await this.handleAddRepository(i)});const l=document.createElement("button");return l.className="el-button el-button--success",l.innerHTML='<i class="ri-refresh-line"></i> Refresh All',l.title="Refresh all repositories",this.registerListener(l,"click",async()=>{await this.handleRefreshRepositories(l)}),o.appendChild(i),o.appendChild(r),o.appendChild(l),e.appendChild(o),this.renderRepositoryList(n),e}renderRepositoryList(e){e.innerHTML="";const t=window.customjs.repos||[];if(t.length===0){const s=document.createElement("div");s.style.cssText="padding: 10px; color: #6c757d;",s.textContent="No repositories configured",e.appendChild(s);return}t.forEach(s=>{const n=this.createRepositoryCard(s);e.appendChild(n)})}createRepositoryCard(e){const t=document.createElement("div");t.style.cssText=`
      background: ${e.enabled?"#2d2d2d":"#1e1e1e"};
      border: 1px solid ${e.enabled?"#4a4a4a":"#333"};
      border-radius: 4px;
      padding: 12px;
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      opacity: ${e.enabled?"1":"0.6"};
      transition: all 0.2s;
    `;const s=document.createElement("div");s.style.cssText="flex: 1; min-width: 0;";const n=document.createElement("div");n.style.cssText="font-size: 14px; font-weight: 600; color: #e8e8e8; margin-bottom: 4px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;",n.textContent=e.data?.name||"Loading...";const o=document.createElement("div");o.style.cssText="font-size: 12px; color: #b0b0b0; margin-bottom: 4px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;",o.textContent=e.data?.description||"";const i=document.createElement("div");i.style.cssText="font-size: 11px; color: #909090; margin-bottom: 2px; display: flex; align-items: center; gap: 4px;";const r=e.data?.authors?.[0];if(r?.name){const x=document.createTextNode("by "),b=document.createElement("span");if(b.style.cssText="color: #6c757d;",b.appendChild(x),i.appendChild(b),r.userId){const y=document.createElement("span");y.textContent=r.name,y.style.cssText="color: #409eff; cursor: pointer; text-decoration: underline;",y.title=`${r.description||"Click to view profile"}`,this.registerListener(y,"click",v=>{v.stopPropagation();try{window.$pinia?.user?.showUserDialog?(window.$pinia.user.showUserDialog(r.userId),this.logger.log(`Opening user dialog for: ${r.name} (${r.userId})`)):this.logger.showWarning("User dialog not available")}catch(L){this.logger.error("Error opening user dialog:",L)}}),i.appendChild(y)}else{const y=document.createTextNode(r.name);i.appendChild(y)}}else{const x=document.createTextNode("by Unknown");i.appendChild(x)}const l=document.createElement("div");l.style.cssText="font-size: 11px; color: #6c757d; margin-top: 4px;";const c=e.data?.modules?.length||e.data?.plugins?.length||0;l.textContent=`${c} modules \u2022 ${e.loaded?"\u2713 Loaded":"\u23F3 Loading..."}`,s.appendChild(n),s.appendChild(o),s.appendChild(i),s.appendChild(l);const d=document.createElement("div");d.style.cssText="display: flex; gap: 8px; align-items: center;";const g=document.createElement("label");g.className="el-switch",g.style.cssText="cursor: pointer; display: flex; align-items: center;",g.title=e.enabled?"Disable repository":"Enable repository";const a=document.createElement("input");a.type="checkbox",a.checked=e.enabled,a.style.display="none";const p=document.createElement("span");p.style.cssText=`
      display: inline-block;
      position: relative;
      width: 40px;
      height: 20px;
      border-radius: 10px;
      background: ${e.enabled?"#409eff":"#dcdfe6"};
      transition: background-color 0.3s;
      cursor: pointer;
    `;const u=document.createElement("span");u.style.cssText=`
      position: absolute;
      top: 1px;
      left: ${e.enabled?"21px":"1px"};
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: white;
      transition: all 0.3s;
    `,p.appendChild(u),g.appendChild(a),g.appendChild(p),this.registerListener(g,"click",async x=>{x.stopPropagation(),await this.handleToggleRepository(e.url,!e.enabled)});const h=document.createElement("button");h.className="el-button el-button--small",h.innerHTML='<i class="ri-file-copy-line"></i>',h.title="Copy repository URL",this.registerListener(h,"click",async x=>{x.stopPropagation();try{await navigator.clipboard.writeText(e.url),this.logger.showSuccess(`Copied URL: ${e.url}`)}catch{this.logger.showError("Failed to copy URL")}});const f=document.createElement("button");f.className="el-button el-button--small el-button--info",f.innerHTML='<i class="ri-refresh-line"></i>',f.title="Refresh repository",this.registerListener(f,"click",async x=>{x.stopPropagation(),await this.handleRefreshRepository(e.url,f)});const m=document.createElement("button");return m.className="el-button el-button--small el-button--danger",m.innerHTML='<i class="ri-delete-bin-line"></i>',m.title="Remove repository",this.registerListener(m,"click",async x=>{x.stopPropagation(),await this.handleRemoveRepository(e.url)}),d.appendChild(g),d.appendChild(h),d.appendChild(f),d.appendChild(m),t.appendChild(s),t.appendChild(d),t}async handleAddRepository(e){const t=e.value.trim();if(this.logger.log(`\u{1F4E6} User requested to add repository: ${t}`),!t){this.logger.showWarning("Please enter a repository URL");return}if(!t.endsWith(".json")){this.logger.showWarning("Repository URL must end with .json");return}try{this.logger.log("  \u2192 Adding repository via RepoManager..."),this.logger.showInfo("Adding repository...");const s=await window.customjs.addRepository(t);if(s.success){this.logger.showSuccess(`Repository added: ${s.repo?.data?.name||t}`),e.value="";const n=document.getElementById("repo-list-container");n&&this.renderRepositoryList(n),this.refreshPluginGrid()}else this.logger.showError(`Failed to add repository: ${s.message}`)}catch(s){this.logger.error("Error adding repository:",s),this.logger.showError(`Error: ${s.message}`)}}async handleToggleRepository(e,t){this.logger.log(`\u{1F518} User toggled repository: ${e} (${t?"enable":"disable"})`);try{const s=window.customjs.getRepo(e);if(s){s.enabled=t;const o=window.customjs.configManager.get("repositories")||{};o[e]=t,window.customjs.configManager.set("repositories",o)}if(!!s){this.logger.showSuccess(`Repository ${t?"enabled":"disabled"}`);const o=document.getElementById("repo-list-container");o&&this.renderRepositoryList(o),this.refreshPluginGrid()}else this.logger.showError("Failed to toggle repository")}catch(s){this.logger.error("Error toggling repository:",s),this.logger.showError(`Error: ${s.message}`)}}async handleRefreshRepository(e,t){this.logger.log(`\u{1F504} User clicked refresh for repository: ${e}`);const s=t.innerHTML;try{t.disabled=!0,t.innerHTML='<i class="ri-loader-4-line ri-spin"></i>',this.logger.log("  \u2192 Refreshing repository...");const n=window.customjs.getRepo(e);if(n?await n.fetch():!1){t.innerHTML='<i class="ri-check-line"></i>',this.logger.showSuccess("Repository refreshed");const i=document.getElementById("repo-list-container");i&&this.renderRepositoryList(i),this.refreshPluginGrid(),setTimeout(()=>{t.innerHTML=s,t.disabled=!1},1e3)}else t.innerHTML='<i class="ri-error-warning-line"></i>',this.logger.showError("Failed to refresh repository"),setTimeout(()=>{t.innerHTML=s,t.disabled=!1},2e3)}catch(n){this.logger.error("Error refreshing repository:",n),this.logger.showError(`Error: ${n.message}`),t.innerHTML=s,t.disabled=!1}}async handleRefreshRepositories(e){this.logger.log("\u{1F504} User clicked refresh all repositories");const t=e.innerHTML;try{e.disabled=!0,e.innerHTML='<i class="ri-loader-4-line ri-spin"></i> Refreshing...',this.logger.log("  \u2192 Refreshing all repositories...");const s=window.customjs.repos||[];await Promise.all(s.map(o=>o.fetch())),e.innerHTML='<i class="ri-check-line"></i> Refreshed!',this.logger.showSuccess("All repositories refreshed");const n=document.getElementById("repo-list-container");n&&this.renderRepositoryList(n),this.refreshPluginGrid(),setTimeout(()=>{e.innerHTML=t,e.disabled=!1},2e3)}catch(s){this.logger.error("Error refreshing repositories:",s),this.logger.showError(`Error: ${s.message}`),e.innerHTML=t,e.disabled=!1}}async handleRemoveRepository(e){if(this.logger.log(`\u{1F5D1}\uFE0F User clicked remove for repository: ${e}`),!confirm(`Are you sure you want to remove this repository?

${e}`)){this.logger.log("  \u2192 User cancelled removal");return}try{if(this.logger.log("  \u2192 Removing repository..."),window.customjs.removeRepository(e)){this.logger.showSuccess("Repository removed");const s=document.getElementById("repo-list-container");s&&this.renderRepositoryList(s),this.refreshPluginGrid()}else this.logger.showError("Failed to remove repository")}catch(t){this.logger.error("Error removing repository:",t),this.logger.showError(`Error: ${t.message}`)}}createConfigSyncSection(){const e=document.createElement("div");e.style.cssText="margin-bottom: 20px;";const t=document.createElement("h5");t.style.cssText="margin: 0 0 12px 0; font-size: 16px; font-weight: 600;",t.textContent="\u2699\uFE0F Config Sync",e.appendChild(t);const s=document.createElement("p");s.style.cssText="margin: 0 0 12px 0; font-size: 14px; color: #6c757d;",s.textContent="Sync settings between browser localStorage and VRChat config.json (vrcx.customjs path)",e.appendChild(s);const n=document.createElement("div");n.style.cssText="display: flex; gap: 12px;";const o=document.createElement("button");o.className="el-button el-button--primary",o.innerHTML='<i class="ri-download-cloud-line"></i> Import from VRChat Config',this.registerListener(o,"click",async()=>{await this.handleImportConfig(o)});const i=document.createElement("button");return i.className="el-button el-button--success",i.innerHTML='<i class="ri-upload-cloud-line"></i> Export to VRChat Config',this.registerListener(i,"click",async()=>{await this.handleExportConfig(i)}),n.appendChild(o),n.appendChild(i),e.appendChild(n),e}async handleImportConfig(e){this.logger.log("\u{1F4E5} User clicked import from VRChat config");const t=e.innerHTML;try{e.disabled=!0,e.innerHTML='<i class="ri-loader-4-line ri-spin"></i> Importing...',this.logger.log("  \u2192 Importing config from VRChat config.json...");const s=await window.customjs.configManager.importFromVRChatConfig();s&&s.importCount>0?(e.innerHTML='<i class="ri-check-line"></i> Imported!',e.className="el-button el-button--success",this.logger.showSuccess(`Successfully imported ${s.importCount} settings from VRChat config.json!`),setTimeout(()=>{this.refreshPluginGrid(),e.innerHTML=t,e.className="el-button el-button--primary",e.disabled=!1},2e3)):s&&s.importCount===0?(e.innerHTML='<i class="ri-information-line"></i> No settings',e.className="el-button el-button--warning",this.logger.showWarning("No settings found to import from VRChat config.json"),setTimeout(()=>{e.innerHTML=t,e.className="el-button el-button--primary",e.disabled=!1},2e3)):(e.innerHTML='<i class="ri-error-warning-line"></i> Failed',e.className="el-button el-button--danger",this.logger.showError("Failed to import settings from VRChat config.json"),setTimeout(()=>{e.innerHTML=t,e.className="el-button el-button--primary",e.disabled=!1},2e3))}catch(s){this.logger.error("Error importing config:",s),e.innerHTML='<i class="ri-error-warning-line"></i> Error',e.className="el-button el-button--danger",setTimeout(()=>{e.innerHTML=t,e.className="el-button el-button--primary",e.disabled=!1},2e3)}}async handleExportConfig(e){this.logger.log("\u{1F4E4} User clicked export to VRChat config");const t=e.innerHTML;try{e.disabled=!0,e.innerHTML='<i class="ri-loader-4-line ri-spin"></i> Exporting...',this.logger.log("  \u2192 Exporting config to VRChat config.json...");const s=await window.customjs.configManager.exportToVRChatConfig();if(s&&s.success){e.innerHTML='<i class="ri-check-line"></i> Exported!',e.className="el-button el-button--success";const n=s.filePath||window.customjs.configManager.vrchatConfigPath;await this.utils.copyToClipboard(n,"VRChat config.json path"),this.logger.log(`Exported to: ${n}`),this.logger.log(`Exported ${s.settingsCount} settings`),this.logger.showSuccess("Settings exported successfully! Path copied to clipboard."),setTimeout(()=>{e.innerHTML=t,e.className="el-button el-button--success",e.disabled=!1},2e3)}else e.innerHTML='<i class="ri-error-warning-line"></i> Failed',e.className="el-button el-button--danger",this.logger.showError("Failed to export settings to VRChat config.json"),setTimeout(()=>{e.innerHTML=t,e.className="el-button el-button--success",e.disabled=!1},2e3)}catch(s){this.logger.error("Error exporting config:",s),e.innerHTML='<i class="ri-error-warning-line"></i> Error',e.className="el-button el-button--danger",setTimeout(()=>{e.innerHTML=t,e.className="el-button el-button--success",e.disabled=!1},2e3)}}createFilterSection(){const e=document.createElement("div");e.style.cssText="margin-bottom: 20px;";const t=document.createElement("h5");t.style.cssText="margin: 0 0 12px 0; font-size: 16px; font-weight: 600;",t.textContent="\u{1F527} Filters",e.appendChild(t);const s=document.createElement("div");s.style.cssText="display: flex; gap: 12px; margin-bottom: 16px;";const n=document.createElement("input");n.type="text",n.placeholder="Search for a plugin...",n.className="el-input__inner",n.style.cssText="flex: 2; padding: 8px 12px; border: 1px solid #dcdfe6; border-radius: 4px; font-size: 14px;",n.value=this.searchValue.value,this.registerListener(n,"input",r=>{this.searchValue.value=r.target.value.toLowerCase(),this.logger.log(`\u{1F50D} User changed search query to: "${this.searchValue.value}"`),this.refreshPluginGrid()});const o=document.createElement("select");return o.className="el-select",o.style.cssText="padding: 8px 24px 8px 12px; border: 1px solid #5a5a5a; border-radius: 4px; font-size: 14px; width: 180px; background: #2d2d2d; color: #e0e0e0; cursor: pointer;",[{value:"all",label:"Show All"},{value:"enabled",label:"Enabled"},{value:"disabled",label:"Disabled"},{value:"available",label:"Available (Not Installed)"},{value:"core",label:"Core"},{value:"failed",label:"Failed"}].forEach(r=>{const l=document.createElement("option");l.value=r.value,l.textContent=r.label,r.value===this.searchValue.filter&&(l.selected=!0),o.appendChild(l)}),this.registerListener(o,"change",r=>{this.searchValue.filter=r.target.value,this.logger.log(`\u{1F53D} User changed filter to: ${this.searchValue.filter}`),this.refreshPluginGrid()}),s.appendChild(n),s.appendChild(o),e.appendChild(s),e}createLoadPluginSection(){const e=document.createElement("div");e.style.cssText=`
      background: #2d2d2d;
      border: 2px dashed #4a4a4a;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 20px;
    `;const t=document.createElement("h3");t.style.cssText="margin: 0 0 12px 0; font-size: 16px; font-weight: 600; display: flex; align-items: center; color: #e0e0e0;";const s=document.createElement("i");s.className="ri-download-cloud-line",s.style.cssText="color: #61afef; margin-right: 8px; font-size: 18px;";const n=document.createTextNode("Load Plugin from URL");t.appendChild(s),t.appendChild(n),e.appendChild(t);const o=document.createElement("div");o.style.cssText="display: flex; gap: 10px; margin-bottom: 10px;";const i=document.createElement("input");i.type="text",i.id="plugin-url-input",i.placeholder="https://github.com/USER/REPO/raw/refs/heads/main/js/plugins/my-plugin.js",i.className="el-input__inner",i.style.cssText="flex: 1; padding: 8px 12px; border: 1px solid #5a5a5a; border-radius: 4px; font-size: 13px; font-family: 'Consolas', monospace; background: #1e1e1e; color: #e0e0e0;";const r=document.createElement("button");r.id="load-plugin-btn",r.className="el-button el-button--primary",r.style.cssText="padding: 8px 16px;",r.innerHTML='<i class="ri-download-line"></i> Load',o.appendChild(i),o.appendChild(r),e.appendChild(o);const l=document.createElement("div");return l.id="load-plugin-status",l.style.cssText="margin-top: 8px; font-size: 12px; color: #a0a0a0;",e.appendChild(l),setTimeout(()=>{const c=e.querySelector("#plugin-url-input"),d=e.querySelector("#load-plugin-btn"),g=e.querySelector("#load-plugin-status");d&&this.registerListener(d,"click",async()=>{await this.handleLoadPlugin(c,g)}),c&&this.registerListener(c,"keypress",async a=>{a.key==="Enter"&&await this.handleLoadPlugin(c,g)})},0),e}async handleLoadPlugin(e,t){const s=e.value.trim();if(this.logger.log(`\u{1F4E5} User requested to load plugin from URL: ${s}`),!s){t.textContent="\u26A0\uFE0F Please enter a URL",t.style.color="#ffc107";return}t.textContent=`\u23F3 Loading plugin from ${s}...`,t.style.color="#007bff";try{this.logger.log("  \u2192 Loading module from URL...");const n=await window.customjs.loadModule(s);n.success?(t.textContent="\u2705 Plugin loaded successfully!",t.style.color="#28a745",e.value="",setTimeout(()=>this.refreshPluginGrid(),500)):(t.textContent=`\u274C Failed to load: ${n.message}`,t.style.color="#dc3545")}catch(n){t.textContent=`\u274C Error: ${n.message}`,t.style.color="#dc3545"}}refreshPluginGrid(){this.logger.log("\u{1F504} Refreshing plugin grid...");try{const e=this.pluginGridContainer;if(!e){this.logger.warn("Plugin grid container not available");return}e.innerHTML="";const t=window.customjs?.modules||[],s=window.customjs?.coreModules||new Map,n=new Set,o=window.customjs.repos||[];this.logger.log(`  \u2192 Loaded plugins: ${t.length}, Core modules: ${s instanceof Map?s.size:s.length}, Failed: ${n.size}`);const i=window.customjs?.configManager?.get("plugins")||{};let r=[];if(o.length>0)r=(window.customjs.repos||[]).flatMap(a=>a.enabled?a.getModules():[]).map(a=>{const p=t.find(u=>u.metadata.url===a.url);if(p)return{...p,metadata:{...a,...p.metadata}};{const u=i[a.url]!==void 0?i[a.url]:!1;return{metadata:a,enabled:u,loaded:!1,started:!1,_isStub:!0}}});else{const g=new Set(t.map(p=>p.metadata.url)),a=Object.entries(i).filter(([p,u])=>!u&&!g.has(p)).map(([p])=>this.createUnloadedPluginStub(p));r=[...t,...a]}const l=this.filterPlugins(r,s,n),c=document.createElement("h5");c.style.cssText="margin: 0 0 16px 0; font-size: 16px; font-weight: 600; color: #e0e0e0;",c.textContent=`\u{1F9E9} Plugins (${l.length})`,e.appendChild(c);const d=document.createElement("div");if(d.style.cssText="display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 16px; margin-bottom: 20px;",l.length===0){const g=document.createElement("div");g.style.cssText="padding: 40px; text-align: center; color: #909090;",g.textContent="No plugins meet the search criteria.",e.appendChild(g);return}l.forEach(g=>{d.appendChild(this.createPluginCard(g))}),e.appendChild(d),this.logger.log(`\u2713 Plugin grid refreshed - showing ${l.length} plugins (filter: ${this.searchValue.filter}, search: "${this.searchValue.value}")`)}catch(e){this.logger.error("Error refreshing plugin grid:",e)}}createUnloadedPluginStub(e){const t=e.split("/"),n=t[t.length-1].replace(/\.js$/,""),o=n.split("-").map(i=>i.charAt(0).toUpperCase()+i.slice(1)).join(" ");return{metadata:{id:n,name:o,description:"(Not loaded - enable to see details)",authors:[{name:"Unknown"}],url:e,tags:[]},enabled:!1,loaded:!1,started:!1,_isStub:!0}}filterPlugins(e,t,s){const{value:n,filter:o}=this.searchValue;let i=[...e];if(o==="enabled")i=i.filter(r=>r.enabled);else if(o==="disabled")i=i.filter(r=>!r.enabled);else if(o==="core")i=[];else if(o==="failed")i=[];else if(o==="available")if(window.customjs.repos&&window.customjs.repos.length>0){const r=new Set(e.map(c=>c.metadata.url));i=(window.customjs.repos||[]).flatMap(c=>c.enabled?c.getModules():[]).filter(c=>!r.has(c.url)).map(c=>({metadata:c,enabled:!1,loaded:!1,started:!1,_isAvailable:!0}))}else i=[];return n&&(i=i.filter(r=>r.metadata.name.toLowerCase().includes(n)||r.metadata.description.toLowerCase().includes(n)||r.metadata.id.toLowerCase().includes(n)||r.metadata.tags?.some(l=>l.toLowerCase().includes(n)))),i.sort((r,l)=>r.metadata.name.localeCompare(l.metadata.name)),i}createPluginCard(e){const t=document.createElement("div");t.className="vc-plugin-card",t.style.cssText=`
      background: #2d2d2d;
      border: 2px solid ${e.enabled?"#28a745":"#5a5a5a"};
      border-radius: 6px;
      padding: 14px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.3);
      transition: all 0.2s;
      display: flex;
      flex-direction: column;
    `;const s=document.createElement("div");s.style.cssText="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;";const n=document.createElement("div");n.style.cssText="flex: 1; min-width: 0;";const o=document.createElement("div");o.style.cssText="font-size: 16px; font-weight: 600; color: #e8e8e8; margin-bottom: 4px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;",o.textContent=e.getDisplayName?e.getDisplayName():e.metadata?.name||"Unknown Plugin";const i=document.createElement("div");i.style.cssText="font-size: 11px; color: #909090; font-family: monospace; display: flex; align-items: center; gap: 4px;";const r=e.metadata?.authors?.[0];if(r?.name){const a=document.createTextNode("by ");if(i.appendChild(a),r.userId){const p=document.createElement("span");p.textContent=r.name,p.style.cssText="color: #409eff; cursor: pointer; text-decoration: underline;",p.title=`${r.description||"Click to view profile"}`,this.registerListener(p,"click",u=>{u.stopPropagation();try{window.$pinia?.user?.showUserDialog?(window.$pinia.user.showUserDialog(r.userId),this.logger.log(`Opening user dialog for: ${r.name} (${r.userId})`)):this.logger.showWarning("User dialog not available")}catch(h){this.logger.error("Error opening user dialog:",h)}}),i.appendChild(p)}else{const p=document.createTextNode(r.name);i.appendChild(p)}}if(e.metadata?.build){const a=document.createTextNode(` \u2022 ${this.formatBuildDate(e.metadata.build)}`);i.appendChild(a)}if(e.metadata?.url){let a=null;for(const p of window.customjs.repos||[])if(p.enabled){const u=p.getModuleByUrl(e.metadata.url);if(u){a={module:u,repo:p};break}}if(a){const p=document.createTextNode(` \u2022 \u{1F4E6} ${a.repo.data?.name||"Repository"}`);i.appendChild(p)}}if(n.appendChild(o),n.appendChild(i),e._isAvailable){const a=document.createElement("button");a.className="el-button el-button--small el-button--success",a.innerHTML='<i class="ri-download-line"></i> Install',a.title="Install this plugin",this.registerListener(a,"click",async p=>{p.stopPropagation(),await this.handleInstallPlugin(e.metadata.url,a)}),s.appendChild(n),s.appendChild(a)}else{const a=document.createElement("label");a.className="el-switch",a.style.cssText="cursor: pointer; display: flex; align-items: center;";const p=document.createElement("input");p.type="checkbox",p.checked=e.enabled,p.style.display="none";const u=document.createElement("span");u.style.cssText=`
        display: inline-block;
        position: relative;
        width: 40px;
        height: 20px;
        border-radius: 10px;
        background: ${e.enabled?"#409eff":"#dcdfe6"};
        transition: background-color 0.3s;
        cursor: pointer;
      `;const h=document.createElement("span");h.style.cssText=`
        position: absolute;
        top: 1px;
        left: ${e.enabled?"21px":"1px"};
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background: white;
        transition: all 0.3s;
      `,u.appendChild(h),a.appendChild(p),a.appendChild(u),this.registerListener(a,"click",async f=>{f.stopPropagation(),await this.handleTogglePlugin(e.metadata.id)}),s.appendChild(n),s.appendChild(a)}const l=document.createElement("div");l.style.cssText="font-size: 13px; color: #b0b0b0; line-height: 1.4; margin-bottom: 12px; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;",l.textContent=e.getDisplayDescription?e.getDisplayDescription():e.metadata?.description||"No description available";const c=document.createElement("div");c.style.cssText="display: flex; gap: 4px; flex-wrap: wrap; margin-bottom: 8px;",e.metadata?.tags&&e.metadata.tags.length>0&&e.metadata.tags.forEach(a=>{const p=this.getTagColor(a),u=this.createBadge(a,p);c.appendChild(u)});let d=null;e.actionButtons&&e.actionButtons.length>0&&(d=this.createCustomActionButtons(e,e.actionButtons));const g=document.createElement("div");if(g.style.cssText="display: flex; gap: 8px; margin-top: auto; padding-top: 12px; border-top: 1px solid #404040;",e._isAvailable){const a=document.createElement("button");a.className="el-button el-button--small el-button--success",a.style.cssText="flex: 1;",a.innerHTML='<i class="ri-search-eye-line"></i> Plugin Details',a.title="Fetch Plugin Details",this.registerListener(a,"click",async p=>{p.stopPropagation(),await this.handleAnalyzePlugin(e.metadata.url)}),g.appendChild(a)}else{const a=document.createElement("button");a.className="el-button el-button--small el-button--info",a.style.cssText="flex: 1;",a.innerHTML='<i class="ri-restart-line"></i> Reload',this.registerListener(a,"click",async m=>{m.stopPropagation(),await this.handleReloadPlugin(e.metadata.url)});const p=e.settings?.def&&Object.keys(e.settings.def).length>0,u=document.createElement("button");u.className="el-button el-button--small el-button--success",u.innerHTML='<i class="ri-search-eye-line"></i>',u.title="Fetch Plugin Details",this.registerListener(u,"click",async m=>{m.stopPropagation(),await this.handleAnalyzePlugin(e.metadata.url)});const h=document.createElement("button");h.className="el-button el-button--small",h.innerHTML='<i class="ri-information-line"></i>',h.title="Plugin Details",this.registerListener(h,"click",m=>{m.stopPropagation(),this.handleShowDetails(e)});const f=document.createElement("button");if(f.className="el-button el-button--small el-button--danger",f.innerHTML='<i class="ri-delete-bin-line"></i>',f.title="Remove Plugin",this.registerListener(f,"click",async m=>{m.stopPropagation(),await this.handleRemovePlugin(e.metadata.url)}),g.appendChild(a),p){const m=document.createElement("button");m.className="el-button el-button--small el-button--primary",m.innerHTML='<i class="ri-settings-3-line"></i>',m.title="Plugin Settings",this.registerListener(m,"click",async x=>{x.stopPropagation(),await this.handleShowPluginSettings(e)}),g.appendChild(m)}g.appendChild(u),g.appendChild(h),g.appendChild(f)}return t.appendChild(s),t.appendChild(l),c.children.length>0&&t.appendChild(c),d&&t.appendChild(d),t.appendChild(g),this.registerListener(t,"mouseenter",()=>{t.style.boxShadow="0 4px 12px rgba(0,0,0,0.5)",t.style.transform="translateY(-2px)"}),this.registerListener(t,"mouseleave",()=>{t.style.boxShadow="0 2px 4px rgba(0,0,0,0.3)",t.style.transform="translateY(0)"}),t}createCustomActionButtons(e,t){const s=document.createElement("div");return s.style.cssText="display: flex; gap: 8px; margin-top: 8px; padding-top: 8px; border-top: 1px dashed #404040; flex-wrap: wrap;",t.forEach(n=>{try{const o=document.createElement("button"),i={primary:"el-button--primary",success:"el-button--success",warning:"el-button--warning",danger:"el-button--danger",info:"el-button--info"},r=i[n.color]||i.primary;o.className=`el-button el-button--small ${r}`,o.style.cssText="flex: 1;";let l="";n.icon&&(l+=`<i class="${n.icon}"></i> `),l+=n.title||"Action",o.innerHTML=l,n.description&&(o.title=n.description),n.callback&&typeof n.callback=="function"&&this.registerListener(o,"click",async c=>{c.stopPropagation();try{await n.callback()}catch(d){this.logger.error(`Error executing custom button callback for ${e.metadata.id}:`,d),this.logger.showError(`Button action failed: ${d.message}`)}}),s.appendChild(o)}catch(o){this.logger.error(`Error creating custom button for ${e.metadata.id}:`,o)}}),s}createBadge(e,t){const s=document.createElement("span");return s.style.cssText=`
      background: ${t};
      color: white;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 500;
    `,s.textContent=e,s}getTagColor(e){let t=0;for(let i=0;i<e.length;i++)t=e.charCodeAt(i)+((t<<5)-t),t=t&t;const s=Math.abs(t%360),n=65+Math.abs(t>>8)%11,o=45+Math.abs(t>>16)%11;return`hsl(${s}, ${n}%, ${o}%)`}createFailedSection(e){const t=document.createElement("div");t.style.cssText="margin-bottom: 30px;";const s=document.createElement("h3");s.style.cssText=`
      margin: 0 0 15px 0;
      font-size: 20px;
      font-weight: 600;
      display: flex;
      align-items: center;
      color: #dc3545;
    `,s.innerHTML=`<i class="ri-error-warning-line" style="margin-right: 8px;"></i>Failed to Load (${e.length})`,t.appendChild(s);const n=document.createElement("div");return n.style.cssText="display: flex; flex-direction: column; gap: 10px;",e.forEach(o=>{const i=document.createElement("div");i.style.cssText=`
        background: #fff5f5;
        border: 1px solid #fecaca;
        border-radius: 8px;
        padding: 12px 15px;
        font-size: 13px;
        font-family: 'Consolas', monospace;
        color: #dc3545;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        justify-content: space-between;
        align-items: center;
      `;const r=document.createElement("span");r.textContent=o,r.style.flex="1";const l=document.createElement("button");l.className="el-button el-button--small el-button--danger",l.innerHTML='<i class="ri-restart-line"></i> Retry',i.appendChild(r),i.appendChild(l),this.registerListener(i,"mouseenter",()=>{i.style.background="#ffe6e6"}),this.registerListener(i,"mouseleave",()=>{i.style.background="#fff5f5"}),this.registerListener(r,"click",()=>{this.utils&&this.utils.copyToClipboard(o,"Failed plugin URL")}),this.registerListener(l,"click",async c=>{c.stopPropagation(),await this.handleRetryFailedPlugin(o)}),n.appendChild(i)}),t.appendChild(n),t}async handleTogglePlugin(e){if(this.logger.log(`\u{1F518} User clicked toggle for plugin: ${e}`),this.togglingPlugins.has(e)){this.logger.warn(`Plugin ${e} is already being toggled, ignoring duplicate request`);return}this.togglingPlugins.add(e);try{const t=window.customjs.getModule(e);if(!t){const o=window.customjs.configManager.getPluginConfig(),i=Object.keys(o).find(l=>{const c=l.split("/");return c[c.length-1].replace(/\.js$/,"")===e});if(!i){this.logger.error(`Plugin URL not found for: ${e}`),this.logger.showError(`Plugin URL not found: ${e}`);return}this.logger.log(`Enabling disabled plugin ${e} from ${i}`),this.logger.showInfo("Enabling plugin..."),o[i]=!0,window.customjs.configManager.setPluginConfig(o);const r=await window.customjs.loadModule(i);r.success?(this.logger.log(`Plugin ${e} enabled and loaded`),this.logger.showSuccess("Plugin enabled successfully")):(this.logger.error(`Failed to load plugin: ${r.message}`),this.logger.showError(`Failed to load plugin: ${r.message}`)),setTimeout(()=>{this.togglingPlugins.delete(e),this.refreshPluginGrid()},500);return}if(await t.toggle(),this.logger.log(`Toggled plugin ${e}: ${t.enabled?"enabled":"disabled"}`),t.metadata.url&&window.customjs.configManager){const o=window.customjs.configManager.getPluginConfig();o[t.metadata.url]=t.enabled,window.customjs.configManager.setPluginConfig(o)}const s=t.enabled?"enabled":"disabled",n=t.getDisplayName?t.getDisplayName():t.metadata.name;this.logger.showSuccess(`${n} ${s}`),setTimeout(()=>this.refreshPluginGrid(),200)}catch(t){this.logger.error(`Error toggling plugin ${e}:`,t),this.logger.showError(`Error: ${t.message}`)}finally{setTimeout(()=>{this.togglingPlugins.delete(e)},500)}}async handleReloadPlugin(e){if(this.logger.log(`\u{1F504} User clicked reload for plugin: ${e}`),!e){this.logger.warn("No URL available for reload"),this.logger.showWarning("Plugin URL not available");return}try{this.logger.log(`  \u2192 Reloading plugin from ${e}`),this.logger.showInfo("Reloading plugin...");const t=window.customjs.configManager.getPluginConfig();t[e]===!1&&(this.logger.log("Plugin is disabled, enabling before reload"),t[e]=!0,window.customjs.configManager.setPluginConfig(t));const s=await window.customjs.reloadModule(e);s.success?(this.logger.log("Plugin reloaded successfully"),this.logger.showSuccess("Plugin reloaded successfully"),setTimeout(()=>this.refreshPluginGrid(),500)):(this.logger.error(`Reload failed: ${s.message}`),this.logger.showError(`Reload failed: ${s.message}`))}catch(t){this.logger.error("Error reloading plugin:",t),this.logger.showError(`Error: ${t.message}`)}}async handleAnalyzePlugin(e){if(this.logger.log(`\u{1F50D} User clicked analyze for plugin: ${e}`),!this.pluginAnalyzer){this.logger.error("Plugin Analyzer not available"),this.logger.showError("Plugin Analyzer is not loaded");return}await this.pluginAnalyzer.analyzePlugin(e)}handleShowDetails(e){this.logger.log(`\u2139\uFE0F User clicked info for plugin: ${e.metadata.id}`),this.logger.log("  \u2192 Plugin details:",e),window.AppApi?.ShowDevTools&&window.AppApi.ShowDevTools()}async handleShowPluginSettings(e){if(this.logger.log(`\u2699\uFE0F User clicked settings for plugin: ${e.metadata.id}`),e.settings?.def&&Object.keys(e.settings.def).length>0)this.logger.log(`  \u2192 Opening settings modal (${Object.keys(e.settings.def).length} settings)`),this.showSettingsModal(e);else{this.logger.log("  \u2192 Plugin has no configurable settings");const s=e.getDisplayName?e.getDisplayName():e.metadata.name;this.logger.showInfo(`${s} has no configurable settings`)}}async handleRemovePlugin(e){if(this.logger.log(`\u{1F5D1}\uFE0F User clicked remove for plugin: ${e}`),!e){this.logger.warn("No URL available for removal"),this.logger.showWarning("Plugin URL not available");return}if(!confirm(`Are you sure you want to remove this plugin?

Note: Code will remain in memory until VRCX restart.`)){this.logger.log("  \u2192 User cancelled removal");return}try{this.logger.log(`  \u2192 Removing plugin from ${e}`);const t=await window.customjs.unloadModule(e);t.success?(this.logger.log("Plugin removed successfully"),this.logger.showSuccess("Plugin removed (restart VRCX to fully unload)"),setTimeout(()=>this.refreshPluginGrid(),500)):(this.logger.error(`Removal failed: ${t.message}`),this.logger.showError(`Removal failed: ${t.message}`))}catch(t){this.logger.error("Error removing plugin:",t),this.logger.showError(`Error: ${t.message}`)}}async handleInstallPlugin(e,t){if(this.logger.log(`\u{1F4E5} User clicked install for plugin: ${e}`),!e){this.logger.showWarning("No URL available for installation");return}const s=t.innerHTML;try{t.disabled=!0,t.innerHTML='<i class="ri-loader-4-line ri-spin"></i> Installing...',this.logger.log(`  \u2192 Installing plugin from ${e}`);const n=await window.customjs.loadModule(e);n.success?(t.innerHTML='<i class="ri-check-line"></i> Installed!',t.className="el-button el-button--small el-button--success",this.logger.showSuccess("Plugin installed successfully"),setTimeout(()=>{this.refreshPluginGrid()},1e3)):(t.innerHTML='<i class="ri-error-warning-line"></i> Failed',t.className="el-button el-button--small el-button--danger",this.logger.showError(`Installation failed: ${n.message}`),setTimeout(()=>{t.innerHTML=s,t.className="el-button el-button--small el-button--success",t.disabled=!1},2e3))}catch(n){this.logger.error("Error installing plugin:",n),this.logger.showError(`Error: ${n.message}`),t.innerHTML=s,t.className="el-button el-button--small el-button--success",t.disabled=!1}}async handleRetryFailedPlugin(e){try{this.logger.log(`Retrying failed plugin: ${e}`),this.logger.showInfo("Retrying plugin load...");const t=await window.customjs.loadModule(e);t.success?(this.logger.showSuccess("Plugin loaded successfully!"),setTimeout(()=>this.refreshPluginGrid(),500)):this.logger.showError(`Failed again: ${t.message}`)}catch(t){this.logger.error("Error retrying plugin:",t),this.logger.showError(`Error: ${t.message}`)}}showSettingsModal(e){this.settingsModal&&(this.settingsModal.remove(),this.settingsModal=null);const t=document.createElement("div");t.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      backdrop-filter: blur(2px);
    `;const s=document.createElement("div");s.style.cssText=`
      background: #2d2d2d;
      border-radius: 12px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
      width: 90%;
      max-width: 700px;
      max-height: 80vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    `;const n=document.createElement("div");n.style.cssText=`
      padding: 20px 25px;
      border-bottom: 1px solid #404040;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    `;const o=e.getDisplayName?e.getDisplayName():e.metadata.name;n.innerHTML=`
      <h3 style="margin: 0; font-size: 20px; font-weight: 600;">
        <i class="ri-settings-3-line"></i> ${o} Settings
      </h3>
      <p style="margin: 5px 0 0 0; font-size: 13px; opacity: 0.9;">
        Configure plugin settings \u2022 Changes are saved automatically
      </p>
    `;const i=document.createElement("div");i.style.cssText=`
      flex: 1;
      overflow-y: auto;
      padding: 20px 25px;
    `,i.appendChild(this.buildSettingsUI(e));const r=document.createElement("div");r.style.cssText=`
      padding: 15px 25px;
      border-top: 1px solid #404040;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #252525;
    `;const l=document.createElement("span");l.style.cssText="font-size: 12px; color: #b0b0b0;",l.textContent="Settings are automatically saved";const c=document.createElement("div");c.style.cssText="display: flex; gap: 10px;";const d=document.createElement("button");d.className="el-button el-button--small el-button--warning",d.innerHTML='<i class="ri-restart-line"></i> Reset to Defaults';const g=document.createElement("button");g.className="el-button el-button--small el-button--primary",g.innerHTML='<i class="ri-close-line"></i> Close',c.appendChild(d),c.appendChild(g),r.appendChild(l),r.appendChild(c),s.appendChild(n),s.appendChild(i),s.appendChild(r),t.appendChild(s),this.registerListener(g,"click",()=>{t.remove(),this.settingsModal=null}),this.registerListener(d,"click",async()=>{const a=e.getDisplayName?e.getDisplayName():e.metadata.name;confirm(`Reset all settings for "${a}" to their default values?`)&&(e.settings?.resetAll?e.settings.resetAll():e.clearAllSettings(),this.logger.showSuccess("Settings reset to defaults"),i.innerHTML="",i.appendChild(this.buildSettingsUI(e)))}),this.registerListener(t,"click",a=>{a.target===t&&(t.remove(),this.settingsModal=null)}),document.body.appendChild(t),this.settingsModal=t}buildSettingsUI(e){const t=document.createElement("div");if(t.style.cssText="padding: 12px 0;",e.settings?.def&&Object.keys(e.settings.def).length>0){const i=e.settings.def,r={};for(const d in i)i[d].hidden||(r[d]=i[d]);if(Object.keys(r).length===0){const d=document.createElement("div");d.style.cssText="text-align: center; padding: 20px; color: #909090;";const g=document.createElement("i");g.className="ri-inbox-line",g.style.cssText="font-size: 32px; opacity: 0.5; display: block; margin-bottom: 8px; color: #909090;";const a=document.createElement("p");return a.style.cssText="margin: 0; font-size: 13px; color: #b0b0b0;",a.textContent="This plugin has no configurable settings",d.appendChild(g),d.appendChild(a),t.appendChild(d),t}const l={};for(const d in r){const g=r[d].category||"general";l[g]||(l[g]={}),l[g][d]=r[d]}const c=e.categories||{};return Object.entries(l).forEach(([d,g])=>{const a=document.createElement("div");a.style.cssText="margin-bottom: 20px;";const p=document.createElement("div");p.style.cssText=`
          margin-bottom: 12px;
          padding-bottom: 8px;
          border-bottom: 2px solid #404040;
        `;const u=document.createElement("h4");if(u.style.cssText=`
          margin: 0;
          font-size: 15px;
          font-weight: 600;
          color: #e0e0e0;
        `,u.textContent=c[d]?.name||this.formatCategoryName(d),p.appendChild(u),c[d]?.description){const h=document.createElement("p");h.style.cssText=`
            margin: 4px 0 0 0;
            font-size: 12px;
            color: #b0b0b0;
          `,h.textContent=c[d].description,p.appendChild(h)}a.appendChild(p),Object.entries(g).forEach(([h,f])=>{const m=this.createSettingRow(e,h,f);a.appendChild(m)}),t.appendChild(a)}),t}const s=document.createElement("div");s.style.cssText="text-align: center; padding: 20px; color: #909090;";const n=document.createElement("i");n.className="ri-inbox-line",n.style.cssText="font-size: 32px; opacity: 0.5; display: block; margin-bottom: 8px; color: #909090;";const o=document.createElement("p");return o.style.cssText="margin: 0; font-size: 13px; color: #b0b0b0;",o.textContent="This plugin has no configurable settings",s.appendChild(n),s.appendChild(o),t.appendChild(s),t}createSettingRow(e,t,s){const n=document.createElement("div");n.style.cssText="margin-bottom: 8px;";const o=document.createElement("div");o.style.cssText=`
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 12px;
      background: #353535;
      border-radius: 6px;
      border: 1px solid #4a4a4a;
    `;const i=document.createElement("div");i.style.cssText="flex: 1; min-width: 0; margin-right: 12px;";const r=document.createElement("div");r.style.cssText="font-size: 13px; font-weight: 500; color: #e8e8e8; margin-bottom: 2px;",r.textContent=s.description||t,i.appendChild(r);const l=document.createElement("div");l.style.cssText="min-width: 140px; display: flex; justify-content: flex-end;";const c=this.createInputForSetting(e,t,s);if(l.appendChild(c),o.appendChild(i),o.appendChild(l),n.appendChild(o),s.variables&&Object.keys(s.variables).length>0){const d=this.createVariablesDisplay(s.variables);n.appendChild(d)}return n}createVariablesDisplay(e){const t=document.createElement("div");t.style.cssText=`
      margin-top: 4px;
      padding: 8px 12px;
      background: #2a2a2a;
      border-radius: 4px;
      border-left: 3px solid #409eff;
    `;const s=document.createElement("div");s.style.cssText=`
      font-size: 11px;
      font-weight: 600;
      color: #409eff;
      margin-bottom: 6px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    `,s.textContent="Available Variables";const n=document.createElement("div");return n.style.cssText=`
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 4px;
      font-size: 11px;
    `,Object.entries(e).forEach(([o,i])=>{const r=document.createElement("div");r.style.cssText=`
        display: flex;
        align-items: baseline;
        gap: 6px;
        padding: 2px 0;
      `;const l=document.createElement("code");l.style.cssText=`
        color: #67c23a;
        background: #1e1e1e;
        padding: 2px 6px;
        border-radius: 3px;
        font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
        font-size: 10px;
        white-space: nowrap;
        cursor: pointer;
        border: 1px solid #3a3a3a;
      `,l.textContent=o,l.title="Click to copy",this.registerListener(l,"click",()=>{if(this.utils){this.utils.copyToClipboard(o);const d=l.style.background;l.style.background="#67c23a",setTimeout(()=>{l.style.background=d},200)}});const c=document.createElement("span");c.style.cssText="color: #909090; flex: 1;",c.textContent=i,r.appendChild(l),r.appendChild(c),n.appendChild(r)}),t.appendChild(s),t.appendChild(n),t}createInputForSetting(e,t,s){const n=e.settings.store[t],o=window.customjs.types.SettingType;switch(s.type){case o.BOOLEAN:return this.createBooleanInput(e,t,n);case o.NUMBER:case o.BIGINT:return this.createNumberInput(e,t,n);case o.STRING:return this.createStringInput(e,t,n,s.placeholder);case o.SELECT:return this.createSelectInput(e,t,n,s.options||[]);case o.SLIDER:return this.createSliderInput(e,t,n,s.markers||[]);case o.TIMESPAN:return this.createTimespanInput(e,t,n);case o.CUSTOM:return this.createCustomInput(e,t,n);default:const i=document.createElement("span");return i.style.cssText="color: #f56c6c; font-size: 12px;",i.textContent=`Unsupported type: ${s.type}`,i}}createBooleanInput(e,t,s){const n=document.createElement("label");n.className="el-switch",n.style.cssText="cursor: pointer; display: flex; align-items: center;";const o=document.createElement("input");o.type="checkbox",o.checked=s,o.style.display="none";const i=document.createElement("span");i.style.cssText=`
      display: inline-block;
      position: relative;
      width: 40px;
      height: 20px;
      border-radius: 10px;
      background: ${s?"#409eff":"#dcdfe6"};
      transition: background-color 0.3s;
      cursor: pointer;
    `;const r=document.createElement("span");return r.style.cssText=`
      position: absolute;
      top: 1px;
      left: ${s?"21px":"1px"};
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: white;
      transition: all 0.3s;
      cursor: pointer;
    `,i.appendChild(r),n.appendChild(o),n.appendChild(i),this.registerListener(n,"click",l=>{l.stopPropagation();try{const c=!o.checked;e.settings.store[t]=c,o.checked=c,i.style.background=c?"#409eff":"#dcdfe6",r.style.left=c?"21px":"1px",this.logger.log(`Setting ${t} changed to ${c} (old: ${!c})`)}catch(c){this.logger.error(`Error toggling ${t}:`,c)}}),n}createNumberInput(e,t,s){const n=document.createElement("input");return n.type="number",n.className="el-input__inner",n.value=s??"",n.style.cssText="width: 100%; padding: 6px 10px; border: 1px solid #5a5a5a; border-radius: 4px; font-size: 13px; background: #1e1e1e; color: #e0e0e0;",this.registerListener(n,"change",o=>{try{const i=parseFloat(n.value);isNaN(i)||(e.settings.store[t]=i,this.logger.log(`Setting ${t} changed to ${i}`))}catch(i){this.logger.error(`Error updating ${t}:`,i)}}),n}createStringInput(e,t,s,n){const o=s||"";if(o.includes(`
`))return this.createMultilineTextarea(e,t,o,{placeholder:n,maxLines:30,minLines:3,validateJson:!1});const r=document.createElement("input");return r.type="text",r.className="el-input__inner",r.value=o,r.placeholder=n||"",r.style.cssText="width: 100%; padding: 6px 10px; border: 1px solid #5a5a5a; border-radius: 4px; font-size: 13px; background: #1e1e1e; color: #e0e0e0;",this.registerListener(r,"change",l=>{try{e.settings.store[t]=r.value,this.logger.log(`Setting ${t} changed to "${r.value}"`)}catch(c){this.logger.error(`Error updating ${t}:`,c)}}),r}createMultilineTextarea(e,t,s,n={}){const o=n.placeholder||"",i=n.maxLines||30,r=n.minLines||3,l=n.validateJson||!1,c=document.createElement("div");c.style.cssText="width: 100%;";const d=l?JSON.stringify(s,null,2):s||"",g=Math.min((d.match(/\n/g)||[]).length+1,i),a=document.createElement("textarea");a.className="el-textarea__inner",a.value=d,a.placeholder=o,a.rows=Math.max(g,r),a.style.cssText=`
      width: 100%;
      padding: 8px 10px;
      border: 1px solid #5a5a5a;
      border-radius: 4px;
      font-size: 13px;
      font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
      background: #1e1e1e;
      color: #e0e0e0;
      resize: vertical;
      min-height: ${r*20}px;
      max-height: ${i*20}px;
      line-height: 1.5;
    `;let p,u;return l&&(p=document.createElement("div"),p.style.cssText=`
        font-size: 11px;
        color: #f56c6c;
        margin-top: 4px;
        display: none;
      `,u=document.createElement("div"),u.style.cssText=`
        font-size: 11px;
        color: #67c23a;
        margin-top: 4px;
        display: none;
      `),this.registerListener(a,"input",()=>{const h=Math.min((a.value.match(/\n/g)||[]).length+1,i);a.rows=Math.max(h,r),l&&p&&u&&(p.style.display="none",u.style.display="none")}),this.registerListener(a,"focus",()=>{a.style.borderColor="#409eff"}),this.registerListener(a,"blur",()=>{if(a.style.borderColor="#5a5a5a",l)try{const h=JSON.parse(a.value);e.settings.store[t]=h,u&&(u.textContent="\u2713 Valid JSON saved",u.style.display="block"),p&&(p.style.display="none");const f=JSON.stringify(h,null,2);a.value=f;const m=Math.min((f.match(/\n/g)||[]).length+1,i);a.rows=Math.max(m,r),setTimeout(()=>{u&&(u.style.display="none")},2e3)}catch(h){p&&(p.textContent=`\u2717 Invalid JSON: ${h.message}`,p.style.display="block"),u&&(u.style.display="none"),a.style.borderColor="#f56c6c"}else try{e.settings.store[t]=a.value,this.logger.log(`Setting ${t} updated (multiline)`)}catch(h){this.logger.error(`Error updating ${t}:`,h)}}),c.appendChild(a),l&&p&&u&&(c.appendChild(p),c.appendChild(u)),c}createSelectInput(e,t,s,n){const o=document.createElement("select");return o.className="el-select",o.style.cssText="padding: 6px 28px 6px 10px; border: 1px solid #5a5a5a; border-radius: 4px; font-size: 13px; background: #1e1e1e; color: #e0e0e0; cursor: pointer;",n.forEach(i=>{const r=document.createElement("option");r.value=i.value,r.textContent=i.label||i.value,(i.value===s||i.default)&&(r.selected=!0),o.appendChild(r)}),this.registerListener(o,"change",i=>{try{e.settings.store[t]=o.value,this.logger.log(`Setting ${t} changed to "${o.value}"`)}catch(r){this.logger.error(`Error updating ${t}:`,r)}}),o}createSliderInput(e,t,s,n){const o=document.createElement("div");o.style.cssText="width: 100%; min-width: 120px;";const i=document.createElement("input");i.type="range",i.min=String(n[0]??0),i.max=String(n[n.length-1]??1),i.step=String(n.length>1?n[1]-n[0]:.1),i.value=String(s??n[0]??0),i.style.cssText="width: 100%; cursor: pointer;";const r=document.createElement("div");return r.style.cssText="text-align: center; font-size: 12px; color: #b0b0b0; margin-top: 4px;",r.textContent=i.value,this.registerListener(i,"input",l=>{try{r.textContent=i.value,e.settings.store[t]=parseFloat(i.value),this.logger.log(`Setting ${t} changed to ${i.value}`)}catch(c){this.logger.error(`Error updating ${t}:`,c)}}),o.appendChild(i),o.appendChild(r),o}createTimespanInput(e,t,s){const n=document.createElement("div");n.style.cssText="display: flex; align-items: center; gap: 8px; width: 100%;";const o=document.createElement("input");o.type="text",o.className="el-input__inner",o.style.cssText="flex: 1; min-width: 120px; padding: 8px 12px; border: 1px solid #dcdfe6; border-radius: 4px; font-size: 14px;";const i=this.utils?.formatTimespan?this.utils.formatTimespan(s):`${s}ms`;o.value=i,o.placeholder="e.g., 1h 20m, 00:50.100, or 5000";const r=document.createElement("span");return r.style.cssText="color: #909090; font-size: 12px; min-width: 80px;",r.textContent=`(${s}ms)`,this.registerListener(o,"blur",l=>{try{const c=l.target.value,d=this.utils?.parseTimespan?this.utils.parseTimespan(c):parseInt(c,10);if(isNaN(d)||d<0){this.logger.showWarning("Invalid timespan format"),o.value=i;return}e.settings.store[t]=d;const g=this.utils?.formatTimespan?this.utils.formatTimespan(d):`${d}ms`;o.value=g,r.textContent=`(${d}ms)`,this.logger.log(`Timespan ${t} changed to ${d}ms (${g})`)}catch(c){this.logger.error(`Error updating timespan ${t}:`,c),o.value=i}}),this.registerListener(o,"keydown",l=>{l.key==="Enter"&&o.blur()}),n.appendChild(o),n.appendChild(r),n}createCustomInput(e,t,s){return this.createMultilineTextarea(e,t,s,{placeholder:"",maxLines:50,minLines:2,validateJson:!0})}formatBuildDate(e){if(!e)return"Unknown";try{let t=typeof e=="string"?parseInt(e,10):e;if(isNaN(t))return e.toString();t.toString().length===10&&(t=t*1e3);const s=new Date(t),n=s.getFullYear();if(isNaN(s.getTime())||n<2020||n>2050||s.getTime()<0)return e.toString();const o={year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"};return s.toLocaleString("en-US",o)}catch{return e.toString()}}formatCategoryName(e){return e.replace(/([A-Z])/g," $1").replace(/_/g," ").replace(/^./,t=>t.toUpperCase()).trim()}formatSettingName(e){return e.replace(/([A-Z])/g," $1").replace(/_/g," ").replace(/^./,t=>t.toUpperCase()).trim()}inferType(e){return e==null?"string":typeof e=="boolean"?"boolean":typeof e=="number"?"number":Array.isArray(e)?"array":typeof e=="object"?"object":"string"}};T(C,"PluginManagerUIPlugin");let w=C;window.customjs.__LAST_PLUGIN_CLASS__=w;})();
