(()=>{var P=Object.defineProperty;var L=(M,e)=>P(M,"name",{value:e,configurable:!0});const v=class v extends CustomModule{constructor(){super({name:"\u{1F9E9} Plugin Manager UI",description:"Visual UI for managing VRCX custom plugins - Equicord inspired",authors:[{name:"Bluscream"}],tags:["UI","Core","Settings"],dependencies:["https://github.com/vrcx-plugin-system/plugins/raw/refs/heads/main/dist/nav-menu-api.js"]}),this.settingsModal=null,this.searchValue={value:"",filter:"all"},this.togglingPlugins=new Set}async load(){this.logger.log("Plugin Manager UI ready"),this.loaded=!0}async start(){if(this.utils=window.customjs.utils,this.navMenuApi=await window.customjs.waitForModule("nav-menu-api"),!this.navMenuApi){this.logger.error("Nav Menu API plugin not found");return}this.setupNavMenuItem(),this.enabled=!0,this.started=!0,this.logger.log("Plugin Manager UI started")}async onLogin(e){}async stop(){this.logger.log("Stopping Plugin Manager UI"),this.navMenuApi&&this.navMenuApi.removeItem("plugins"),this.settingsModal&&(this.settingsModal.remove(),this.settingsModal=null),await super.stop()}setupNavMenuItem(){if(!this.navMenuApi){this.logger.error("NavMenu plugin not found!");return}this.logger.log("Setting up Plugins nav menu item"),this.navMenuApi.addItem("plugins",{label:"Plugins",icon:"ri-plug-line",content:()=>this.createPanelContent(),before:"settings",onShow:()=>this.onPluginsTabShown(),onHide:()=>this.onPluginsTabHidden()}),this.logger.log("\u2713 Plugins nav menu item registered")}onPluginsTabShown(){this.logger.log("\u{1F3AF} Plugins tab shown - user navigated to Plugins view"),setTimeout(()=>this.refreshPluginGrid(),50)}onPluginsTabHidden(){this.logger.log("\u{1F44B} Plugins tab hidden - user navigated away from Plugins view")}createPanelContent(){this.logger.log("\u{1F3A8} Creating plugin manager panel content");const e=document.createElement("div");e.style.cssText=`
      padding: 20px;
      max-width: 1400px;
      margin: 0 auto;
    `;try{this.logger.log("  \u2192 Building stats section"),e.appendChild(this.createStatsSection()),this.logger.log("  \u2192 Building repository management section"),e.appendChild(this.createRepoManagementSection()),this.logger.log("  \u2192 Building config sync section"),e.appendChild(this.createConfigSyncSection()),this.logger.log("  \u2192 Building load plugin section"),e.appendChild(this.createLoadPluginSection()),this.logger.log("  \u2192 Building filter section"),e.appendChild(this.createFilterSection());const t=document.createElement("div");t.id="plugin-grid-container",t.className="vc-plugins-grid",e.appendChild(t),this.pluginGridContainer=t,this.logger.log("\u2713 Plugin manager panel content created successfully")}catch(t){this.logger.error("Error creating plugin manager content:",t);const s=document.createElement("div");s.style.cssText="padding: 20px; text-align: center; color: #dc3545;";const n=document.createElement("h3");n.textContent="\u274C Error Loading Plugin Manager";const i=document.createElement("p");i.textContent=t.message;const o=document.createElement("button");o.className="el-button el-button--primary",o.innerHTML='<i class="ri-restart-line"></i> Reload VRCX',this.registerListener(o,"click",()=>location.reload()),s.appendChild(n),s.appendChild(i),s.appendChild(o),e.appendChild(s)}return e}createStatsSection(){const e=document.createElement("div");e.style.cssText="margin-bottom: 12px;";const t=document.createElement("div");t.style.cssText="display: grid; grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); gap: 6px; margin-bottom: 10px;";const s=window.customjs?.modules||[],n=window.customjs?.coreModules||[],i=new Set,o=(window.customjs.repos||[]).length,r=(window.customjs.repos||[]).filter(d=>d.enabled).length,a=s.filter(d=>d.enabled).length,l=s.filter(d=>d.started).length;return[{label:"Repos",value:`${r}/${o}`,color:"#9c27b0"},{label:"Plugins",value:s.length,color:"#28a745"},{label:"Core Modules",value:n instanceof Map?n.size:n.length,color:"#28a745"}].forEach(d=>{const g=this.createStatCard(d.label,d.value,d.color);t.appendChild(g)}),e.appendChild(t),e}createStatCard(e,t,s){const n=document.createElement("div");n.style.cssText=`
      text-align: center;
      padding: 6px 8px;
      background: ${s};
      border-radius: 3px;
      color: white;
      box-shadow: 0 1px 2px ${window.customjs.utils.hexToRgba(s,.3)};
      transition: transform 0.15s, box-shadow 0.15s;
    `;const i=document.createElement("div");i.style.cssText="font-size: 16px; font-weight: 600;",i.textContent=t;const o=document.createElement("div");return o.style.cssText="font-size: 9px; opacity: 0.85; margin-top: 1px;",o.textContent=e,n.appendChild(i),n.appendChild(o),this.registerListener(n,"mouseenter",()=>{n.style.transform="translateY(-1px)",n.style.boxShadow=`0 2px 6px ${window.customjs.utils.hexToRgba(s,.4)}`}),this.registerListener(n,"mouseleave",()=>{n.style.transform="translateY(0)",n.style.boxShadow=`0 1px 3px ${window.customjs.utils.hexToRgba(s,.3)}`}),n}createRepoManagementSection(){const e=document.createElement("div");e.style.cssText="margin-bottom: 20px;";const t=document.createElement("h5");t.style.cssText="margin: 0 0 12px 0; font-size: 16px; font-weight: 600;",t.textContent="\u{1F4E6} Plugin Repositories",e.appendChild(t);const s=document.createElement("p");s.style.cssText="margin: 0 0 12px 0; font-size: 14px; color: #6c757d;",s.textContent="Manage plugin repositories to install and update plugins",e.appendChild(s);const n=document.createElement("div");n.id="repo-list-container",n.style.cssText="margin-bottom: 12px;",e.appendChild(n);const i=document.createElement("div");i.style.cssText="display: flex; gap: 10px; margin-bottom: 10px;";const o=document.createElement("input");o.type="text",o.placeholder="https://example.com/repo.json",o.className="el-input__inner",o.style.cssText="flex: 1; padding: 8px 12px; border: 1px solid #5a5a5a; border-radius: 4px; font-size: 13px; font-family: 'Consolas', monospace; background: #1e1e1e; color: #e0e0e0;";const r=document.createElement("button");r.className="el-button el-button--primary",r.innerHTML='<i class="ri-add-line"></i> Add Repository',this.registerListener(r,"click",async()=>{await this.handleAddRepository(o)});const a=document.createElement("button");return a.className="el-button el-button--success",a.innerHTML='<i class="ri-refresh-line"></i> Refresh All',a.title="Refresh all repositories",this.registerListener(a,"click",async()=>{await this.handleRefreshRepositories(a)}),i.appendChild(o),i.appendChild(r),i.appendChild(a),e.appendChild(i),this.renderRepositoryList(n),e}renderRepositoryList(e){e.innerHTML="";const t=window.customjs.repos||[];if(t.length===0){const s=document.createElement("div");s.style.cssText="padding: 10px; color: #6c757d;",s.textContent="No repositories configured",e.appendChild(s);return}t.forEach(s=>{const n=this.createRepositoryCard(s);e.appendChild(n)})}createRepositoryCard(e){const t=document.createElement("div");t.style.cssText=`
      background: ${e.enabled?"#2d2d2d":"#1e1e1e"};
      border: 1px solid ${e.enabled?"#4a4a4a":"#333"};
      border-radius: 4px;
      padding: 12px;
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      opacity: ${e.enabled?"1":"0.6"};
      transition: all 0.2s;
    `;const s=document.createElement("div");s.style.cssText="flex: 1; min-width: 0;";const n=document.createElement("div");n.style.cssText="font-size: 14px; font-weight: 600; color: #e8e8e8; margin-bottom: 4px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;",n.textContent=e.data?.name||"Loading...";const i=document.createElement("div");i.style.cssText="font-size: 11px; color: #909090; font-family: monospace; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;",i.textContent=e.url,i.title=e.url;const o=document.createElement("div");o.style.cssText="font-size: 11px; color: #6c757d; margin-top: 4px;";const r=e.data?.plugins?.length||0;o.textContent=`${r} plugins \u2022 ${e.loaded?"\u2713 Loaded":"\u23F3 Loading..."}`,s.appendChild(n),s.appendChild(i),s.appendChild(o);const a=document.createElement("div");a.style.cssText="display: flex; gap: 8px; align-items: center;";const l=document.createElement("label");l.className="el-switch",l.style.cssText="cursor: pointer; display: flex; align-items: center;",l.title=e.enabled?"Disable repository":"Enable repository";const c=document.createElement("input");c.type="checkbox",c.checked=e.enabled,c.style.display="none";const d=document.createElement("span");d.style.cssText=`
      display: inline-block;
      position: relative;
      width: 40px;
      height: 20px;
      border-radius: 10px;
      background: ${e.enabled?"#409eff":"#dcdfe6"};
      transition: background-color 0.3s;
      cursor: pointer;
    `;const g=document.createElement("span");g.style.cssText=`
      position: absolute;
      top: 1px;
      left: ${e.enabled?"21px":"1px"};
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: white;
      transition: all 0.3s;
    `,d.appendChild(g),l.appendChild(c),l.appendChild(d),this.registerListener(l,"click",async m=>{m.stopPropagation(),await this.handleToggleRepository(e.url,!e.enabled)});const u=document.createElement("button");u.className="el-button el-button--small el-button--info",u.innerHTML='<i class="ri-refresh-line"></i>',u.title="Refresh repository",this.registerListener(u,"click",async m=>{m.stopPropagation(),await this.handleRefreshRepository(e.url,u)});const h=document.createElement("button");return h.className="el-button el-button--small el-button--danger",h.innerHTML='<i class="ri-delete-bin-line"></i>',h.title="Remove repository",this.registerListener(h,"click",async m=>{m.stopPropagation(),await this.handleRemoveRepository(e.url)}),a.appendChild(l),a.appendChild(u),a.appendChild(h),t.appendChild(s),t.appendChild(a),t}async handleAddRepository(e){const t=e.value.trim();if(this.logger.log(`\u{1F4E6} User requested to add repository: ${t}`),!t){this.logger.showWarning("Please enter a repository URL");return}if(!t.endsWith(".json")){this.logger.showWarning("Repository URL must end with .json");return}try{this.logger.log("  \u2192 Adding repository via RepoManager..."),this.logger.showInfo("Adding repository...");const s=await window.customjs.addRepository(t);if(s.success){this.logger.showSuccess(`Repository added: ${s.repo?.data?.name||t}`),e.value="";const n=document.getElementById("repo-list-container");n&&this.renderRepositoryList(n),this.refreshPluginGrid()}else this.logger.showError(`Failed to add repository: ${s.message}`)}catch(s){this.logger.error("Error adding repository:",s),this.logger.showError(`Error: ${s.message}`)}}async handleToggleRepository(e,t){this.logger.log(`\u{1F518} User toggled repository: ${e} (${t?"enable":"disable"})`);try{const s=window.customjs.getRepo(e);if(s){s.enabled=t;const i=window.customjs.configManager.get("repositories")||{};i[e]=t,window.customjs.configManager.set("repositories",i)}if(!!s){this.logger.showSuccess(`Repository ${t?"enabled":"disabled"}`);const i=document.getElementById("repo-list-container");i&&this.renderRepositoryList(i),this.refreshPluginGrid()}else this.logger.showError("Failed to toggle repository")}catch(s){this.logger.error("Error toggling repository:",s),this.logger.showError(`Error: ${s.message}`)}}async handleRefreshRepository(e,t){this.logger.log(`\u{1F504} User clicked refresh for repository: ${e}`);const s=t.innerHTML;try{t.disabled=!0,t.innerHTML='<i class="ri-loader-4-line ri-spin"></i>',this.logger.log("  \u2192 Refreshing repository...");const n=window.customjs.getRepo(e);if(n?await n.fetch():!1){t.innerHTML='<i class="ri-check-line"></i>',this.logger.showSuccess("Repository refreshed");const o=document.getElementById("repo-list-container");o&&this.renderRepositoryList(o),this.refreshPluginGrid(),setTimeout(()=>{t.innerHTML=s,t.disabled=!1},1e3)}else t.innerHTML='<i class="ri-error-warning-line"></i>',this.logger.showError("Failed to refresh repository"),setTimeout(()=>{t.innerHTML=s,t.disabled=!1},2e3)}catch(n){this.logger.error("Error refreshing repository:",n),this.logger.showError(`Error: ${n.message}`),t.innerHTML=s,t.disabled=!1}}async handleRefreshRepositories(e){this.logger.log("\u{1F504} User clicked refresh all repositories");const t=e.innerHTML;try{e.disabled=!0,e.innerHTML='<i class="ri-loader-4-line ri-spin"></i> Refreshing...',this.logger.log("  \u2192 Refreshing all repositories...");const s=window.customjs.repos||[];await Promise.all(s.map(i=>i.fetch())),e.innerHTML='<i class="ri-check-line"></i> Refreshed!',this.logger.showSuccess("All repositories refreshed");const n=document.getElementById("repo-list-container");n&&this.renderRepositoryList(n),this.refreshPluginGrid(),setTimeout(()=>{e.innerHTML=t,e.disabled=!1},2e3)}catch(s){this.logger.error("Error refreshing repositories:",s),this.logger.showError(`Error: ${s.message}`),e.innerHTML=t,e.disabled=!1}}async handleRemoveRepository(e){if(this.logger.log(`\u{1F5D1}\uFE0F User clicked remove for repository: ${e}`),!confirm(`Are you sure you want to remove this repository?

${e}`)){this.logger.log("  \u2192 User cancelled removal");return}try{if(this.logger.log("  \u2192 Removing repository..."),window.customjs.removeRepository(e)){this.logger.showSuccess("Repository removed");const s=document.getElementById("repo-list-container");s&&this.renderRepositoryList(s),this.refreshPluginGrid()}else this.logger.showError("Failed to remove repository")}catch(t){this.logger.error("Error removing repository:",t),this.logger.showError(`Error: ${t.message}`)}}createConfigSyncSection(){const e=document.createElement("div");e.style.cssText="margin-bottom: 20px;";const t=document.createElement("h5");t.style.cssText="margin: 0 0 12px 0; font-size: 16px; font-weight: 600;",t.textContent="\u2699\uFE0F Config Sync",e.appendChild(t);const s=document.createElement("p");s.style.cssText="margin: 0 0 12px 0; font-size: 14px; color: #6c757d;",s.textContent="Sync settings between browser localStorage and VRChat config.json (vrcx.customjs path)",e.appendChild(s);const n=document.createElement("div");n.style.cssText="display: flex; gap: 12px;";const i=document.createElement("button");i.className="el-button el-button--primary",i.innerHTML='<i class="ri-download-cloud-line"></i> Import from VRChat Config',this.registerListener(i,"click",async()=>{await this.handleImportConfig(i)});const o=document.createElement("button");return o.className="el-button el-button--success",o.innerHTML='<i class="ri-upload-cloud-line"></i> Export to VRChat Config',this.registerListener(o,"click",async()=>{await this.handleExportConfig(o)}),n.appendChild(i),n.appendChild(o),e.appendChild(n),e}async handleImportConfig(e){this.logger.log("\u{1F4E5} User clicked import from VRChat config");const t=e.innerHTML;try{e.disabled=!0,e.innerHTML='<i class="ri-loader-4-line ri-spin"></i> Importing...',this.logger.log("  \u2192 Importing config from VRChat config.json...");const s=await window.customjs.configManager.importFromVRChatConfig();s&&s.importCount>0?(e.innerHTML='<i class="ri-check-line"></i> Imported!',e.className="el-button el-button--success",this.logger.showSuccess(`Successfully imported ${s.importCount} settings from VRChat config.json!`),setTimeout(()=>{this.refreshPluginGrid(),e.innerHTML=t,e.className="el-button el-button--primary",e.disabled=!1},2e3)):s&&s.importCount===0?(e.innerHTML='<i class="ri-information-line"></i> No settings',e.className="el-button el-button--warning",this.logger.showWarning("No settings found to import from VRChat config.json"),setTimeout(()=>{e.innerHTML=t,e.className="el-button el-button--primary",e.disabled=!1},2e3)):(e.innerHTML='<i class="ri-error-warning-line"></i> Failed',e.className="el-button el-button--danger",this.logger.showError("Failed to import settings from VRChat config.json"),setTimeout(()=>{e.innerHTML=t,e.className="el-button el-button--primary",e.disabled=!1},2e3))}catch(s){this.logger.error("Error importing config:",s),e.innerHTML='<i class="ri-error-warning-line"></i> Error',e.className="el-button el-button--danger",setTimeout(()=>{e.innerHTML=t,e.className="el-button el-button--primary",e.disabled=!1},2e3)}}async handleExportConfig(e){this.logger.log("\u{1F4E4} User clicked export to VRChat config");const t=e.innerHTML;try{e.disabled=!0,e.innerHTML='<i class="ri-loader-4-line ri-spin"></i> Exporting...',this.logger.log("  \u2192 Exporting config to VRChat config.json...");const s=await window.customjs.configManager.exportToVRChatConfig();if(s&&s.success){e.innerHTML='<i class="ri-check-line"></i> Exported!',e.className="el-button el-button--success";const n=s.filePath||window.customjs.configManager.vrchatConfigPath;await this.utils.copyToClipboard(n,"VRChat config.json path"),this.logger.log(`Exported to: ${n}`),this.logger.log(`Exported ${s.settingsCount} settings`),this.logger.showSuccess("Settings exported successfully! Path copied to clipboard."),setTimeout(()=>{e.innerHTML=t,e.className="el-button el-button--success",e.disabled=!1},2e3)}else e.innerHTML='<i class="ri-error-warning-line"></i> Failed',e.className="el-button el-button--danger",this.logger.showError("Failed to export settings to VRChat config.json"),setTimeout(()=>{e.innerHTML=t,e.className="el-button el-button--success",e.disabled=!1},2e3)}catch(s){this.logger.error("Error exporting config:",s),e.innerHTML='<i class="ri-error-warning-line"></i> Error',e.className="el-button el-button--danger",setTimeout(()=>{e.innerHTML=t,e.className="el-button el-button--success",e.disabled=!1},2e3)}}createFilterSection(){const e=document.createElement("div");e.style.cssText="margin-bottom: 20px;";const t=document.createElement("h5");t.style.cssText="margin: 0 0 12px 0; font-size: 16px; font-weight: 600;",t.textContent="\u{1F527} Filters",e.appendChild(t);const s=document.createElement("div");s.style.cssText="display: flex; gap: 12px; margin-bottom: 16px;";const n=document.createElement("input");n.type="text",n.placeholder="Search for a plugin...",n.className="el-input__inner",n.style.cssText="flex: 2; padding: 8px 12px; border: 1px solid #dcdfe6; border-radius: 4px; font-size: 14px;",n.value=this.searchValue.value,this.registerListener(n,"input",r=>{this.searchValue.value=r.target.value.toLowerCase(),this.logger.log(`\u{1F50D} User changed search query to: "${this.searchValue.value}"`),this.refreshPluginGrid()});const i=document.createElement("select");return i.className="el-select",i.style.cssText="padding: 8px 24px 8px 12px; border: 1px solid #5a5a5a; border-radius: 4px; font-size: 14px; width: 180px; background: #2d2d2d; color: #e0e0e0; cursor: pointer;",[{value:"all",label:"Show All"},{value:"enabled",label:"Enabled"},{value:"disabled",label:"Disabled"},{value:"available",label:"Available (Not Installed)"},{value:"core",label:"Core"},{value:"failed",label:"Failed"}].forEach(r=>{const a=document.createElement("option");a.value=r.value,a.textContent=r.label,r.value===this.searchValue.filter&&(a.selected=!0),i.appendChild(a)}),this.registerListener(i,"change",r=>{this.searchValue.filter=r.target.value,this.logger.log(`\u{1F53D} User changed filter to: ${this.searchValue.filter}`),this.refreshPluginGrid()}),s.appendChild(n),s.appendChild(i),e.appendChild(s),e}createLoadPluginSection(){const e=document.createElement("div");e.style.cssText=`
      background: #2d2d2d;
      border: 2px dashed #4a4a4a;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 20px;
    `;const t=document.createElement("h3");t.style.cssText="margin: 0 0 12px 0; font-size: 16px; font-weight: 600; display: flex; align-items: center; color: #e0e0e0;";const s=document.createElement("i");s.className="ri-download-cloud-line",s.style.cssText="color: #61afef; margin-right: 8px; font-size: 18px;";const n=document.createTextNode("Load Plugin from URL");t.appendChild(s),t.appendChild(n),e.appendChild(t);const i=document.createElement("div");i.style.cssText="display: flex; gap: 10px; margin-bottom: 10px;";const o=document.createElement("input");o.type="text",o.id="plugin-url-input",o.placeholder="https://github.com/USER/REPO/raw/refs/heads/main/js/plugins/my-plugin.js",o.className="el-input__inner",o.style.cssText="flex: 1; padding: 8px 12px; border: 1px solid #5a5a5a; border-radius: 4px; font-size: 13px; font-family: 'Consolas', monospace; background: #1e1e1e; color: #e0e0e0;";const r=document.createElement("button");r.id="load-plugin-btn",r.className="el-button el-button--primary",r.style.cssText="padding: 8px 16px;",r.innerHTML='<i class="ri-download-line"></i> Load',i.appendChild(o),i.appendChild(r),e.appendChild(i);const a=document.createElement("div");return a.id="load-plugin-status",a.style.cssText="margin-top: 8px; font-size: 12px; color: #a0a0a0;",e.appendChild(a),setTimeout(()=>{const l=e.querySelector("#plugin-url-input"),c=e.querySelector("#load-plugin-btn"),d=e.querySelector("#load-plugin-status");c&&this.registerListener(c,"click",async()=>{await this.handleLoadPlugin(l,d)}),l&&this.registerListener(l,"keypress",async g=>{g.key==="Enter"&&await this.handleLoadPlugin(l,d)})},0),e}async handleLoadPlugin(e,t){const s=e.value.trim();if(this.logger.log(`\u{1F4E5} User requested to load plugin from URL: ${s}`),!s){t.textContent="\u26A0\uFE0F Please enter a URL",t.style.color="#ffc107";return}t.textContent=`\u23F3 Loading plugin from ${s}...`,t.style.color="#007bff";try{this.logger.log("  \u2192 Loading module from URL...");const n=await window.customjs.loadModule(s);n.success?(t.textContent="\u2705 Plugin loaded successfully!",t.style.color="#28a745",e.value="",setTimeout(()=>this.refreshPluginGrid(),500)):(t.textContent=`\u274C Failed to load: ${n.message}`,t.style.color="#dc3545")}catch(n){t.textContent=`\u274C Error: ${n.message}`,t.style.color="#dc3545"}}refreshPluginGrid(){this.logger.log("\u{1F504} Refreshing plugin grid...");try{const e=this.pluginGridContainer;if(!e){this.logger.warn("Plugin grid container not available");return}e.innerHTML="";const t=window.customjs?.modules||[],s=window.customjs?.coreModules||new Map,n=new Set,i=window.customjs.repos||[];this.logger.log(`  \u2192 Loaded plugins: ${t.length}, Core modules: ${s instanceof Map?s.size:s.length}, Failed: ${n.size}`);const o=window.customjs?.configManager?.get("plugins")||{};let r=[];if(i.length>0)r=(window.customjs.repos||[]).flatMap(g=>g.enabled?g.getModules():[]).map(g=>{const u=t.find(h=>h.metadata.url===g.url);if(u)return{...u,metadata:{...g,...u.metadata}};{const h=o[g.url]!==void 0?o[g.url]:!1;return{metadata:g,enabled:h,loaded:!1,started:!1,_isStub:!0}}});else{const d=new Set(t.map(u=>u.metadata.url)),g=Object.entries(o).filter(([u,h])=>!h&&!d.has(u)).map(([u])=>this.createUnloadedPluginStub(u));r=[...t,...g]}const a=this.filterPlugins(r,s,n),l=document.createElement("h5");l.style.cssText="margin: 0 0 16px 0; font-size: 16px; font-weight: 600; color: #e0e0e0;",l.textContent=`\u{1F9E9} Plugins (${a.length})`,e.appendChild(l);const c=document.createElement("div");if(c.style.cssText="display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 16px; margin-bottom: 20px;",a.length===0){const d=document.createElement("div");d.style.cssText="padding: 40px; text-align: center; color: #909090;",d.textContent="No plugins meet the search criteria.",e.appendChild(d);return}a.forEach(d=>{c.appendChild(this.createPluginCard(d))}),e.appendChild(c),this.logger.log(`\u2713 Plugin grid refreshed - showing ${a.length} plugins (filter: ${this.searchValue.filter}, search: "${this.searchValue.value}")`)}catch(e){this.logger.error("Error refreshing plugin grid:",e)}}createUnloadedPluginStub(e){const t=e.split("/"),n=t[t.length-1].replace(/\.js$/,""),i=n.split("-").map(o=>o.charAt(0).toUpperCase()+o.slice(1)).join(" ");return{metadata:{id:n,name:i,description:"(Not loaded - enable to see details)",authors:[{name:"Unknown"}],url:e,tags:[]},enabled:!1,loaded:!1,started:!1,_isStub:!0}}filterPlugins(e,t,s){const{value:n,filter:i}=this.searchValue;let o=[...e];if(i==="enabled")o=o.filter(r=>r.enabled);else if(i==="disabled")o=o.filter(r=>!r.enabled);else if(i==="core")o=[];else if(i==="failed")o=[];else if(i==="available")if(window.customjs.repos&&window.customjs.repos.length>0){const r=new Set(e.map(l=>l.metadata.url));o=(window.customjs.repos||[]).flatMap(l=>l.enabled?l.getModules():[]).filter(l=>!r.has(l.url)).map(l=>({metadata:l,enabled:!1,loaded:!1,started:!1,_isAvailable:!0}))}else o=[];return n&&(o=o.filter(r=>r.metadata.name.toLowerCase().includes(n)||r.metadata.description.toLowerCase().includes(n)||r.metadata.id.toLowerCase().includes(n)||r.metadata.tags?.some(a=>a.toLowerCase().includes(n)))),o.sort((r,a)=>r.metadata.name.localeCompare(a.metadata.name)),o}createPluginCard(e){const t=document.createElement("div");t.className="vc-plugin-card",t.style.cssText=`
      background: #2d2d2d;
      border: 2px solid ${e.enabled?"#28a745":"#5a5a5a"};
      border-radius: 6px;
      padding: 14px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.3);
      transition: all 0.2s;
      display: flex;
      flex-direction: column;
    `;const s=document.createElement("div");s.style.cssText="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;";const n=document.createElement("div");n.style.cssText="flex: 1; min-width: 0;";const i=document.createElement("div");i.style.cssText="font-size: 16px; font-weight: 600; color: #e8e8e8; margin-bottom: 4px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;";const r=(e.getDisplayName?e.getDisplayName():e.metadata?.name||"Unknown Plugin").replace(/\\u\{([0-9A-Fa-f]+)\}/g,(p,f)=>String.fromCodePoint(parseInt(f,16)));i.textContent=r;const a=document.createElement("div");a.style.cssText="font-size: 11px; color: #909090; font-family: monospace;";const l=e.metadata?.authors?.[0]?.name?`by ${e.metadata.authors[0].name}`:"",c=e.metadata?.build?` \u2022 ${this.formatBuildDate(e.metadata.build)}`:"";let d="";if(e.metadata?.url){let p=null;for(const f of window.customjs.repos||[])if(f.enabled){const x=f.getModuleByUrl(e.metadata.url);if(x){p={module:x,repo:f};break}}p&&(d=` \u2022 \u{1F4E6} ${p.repo.data?.name||"Repository"}`)}if(a.textContent=l+c+d,n.appendChild(i),n.appendChild(a),e._isAvailable){const p=document.createElement("button");p.className="el-button el-button--small el-button--success",p.innerHTML='<i class="ri-download-line"></i> Install',p.title="Install this plugin",this.registerListener(p,"click",async f=>{f.stopPropagation(),await this.handleInstallPlugin(e.metadata.url,p)}),s.appendChild(n),s.appendChild(p)}else{const p=document.createElement("label");p.className="el-switch",p.style.cssText="cursor: pointer; display: flex; align-items: center;";const f=document.createElement("input");f.type="checkbox",f.checked=e.enabled,f.style.display="none";const x=document.createElement("span");x.style.cssText=`
        display: inline-block;
        position: relative;
        width: 40px;
        height: 20px;
        border-radius: 10px;
        background: ${e.enabled?"#409eff":"#dcdfe6"};
        transition: background-color 0.3s;
        cursor: pointer;
      `;const C=document.createElement("span");C.style.cssText=`
        position: absolute;
        top: 1px;
        left: ${e.enabled?"21px":"1px"};
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background: white;
        transition: all 0.3s;
      `,x.appendChild(C),p.appendChild(f),p.appendChild(x),this.registerListener(p,"click",async T=>{T.stopPropagation(),await this.handleTogglePlugin(e.metadata.id)}),s.appendChild(n),s.appendChild(p)}const g=document.createElement("div");g.style.cssText="font-size: 13px; color: #b0b0b0; line-height: 1.4; margin-bottom: 12px; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;";const h=(e.getDisplayDescription?e.getDisplayDescription():e.metadata?.description||"No description available").replace(/\\u\{([0-9A-Fa-f]+)\}/g,(p,f)=>String.fromCodePoint(parseInt(f,16)));g.textContent=h;const m=document.createElement("div");m.style.cssText="display: flex; gap: 4px; flex-wrap: wrap; margin-bottom: 8px;",e.metadata?.tags&&e.metadata.tags.length>0&&e.metadata.tags.forEach(p=>{const f=this.getTagColor(p),x=this.createBadge(p,f);m.appendChild(x)});let w=null;e.actionButtons&&e.actionButtons.length>0&&(w=this.createCustomActionButtons(e,e.actionButtons));const b=document.createElement("div");if(b.style.cssText="display: flex; gap: 8px; margin-top: auto; padding-top: 12px; border-top: 1px solid #404040;",e._isAvailable){const p=document.createElement("button");p.className="el-button el-button--small el-button--success",p.style.cssText="flex: 1;",p.innerHTML='<i class="ri-search-eye-line"></i> Plugin Details',p.title="Fetch Plugin Details",this.registerListener(p,"click",async f=>{f.stopPropagation(),await this.handleAnalyzePlugin(e.metadata.url)}),b.appendChild(p)}else{const p=document.createElement("button");p.className="el-button el-button--small el-button--info",p.style.cssText="flex: 1;",p.innerHTML='<i class="ri-restart-line"></i> Reload',this.registerListener(p,"click",async y=>{y.stopPropagation(),await this.handleReloadPlugin(e.metadata.url)});const f=e.settings?.def&&Object.keys(e.settings.def).length>0,x=document.createElement("button");x.className="el-button el-button--small el-button--success",x.innerHTML='<i class="ri-search-eye-line"></i>',x.title="Fetch Plugin Details",this.registerListener(x,"click",async y=>{y.stopPropagation(),await this.handleAnalyzePlugin(e.metadata.url)});const C=document.createElement("button");C.className="el-button el-button--small",C.innerHTML='<i class="ri-information-line"></i>',C.title="Plugin Details",this.registerListener(C,"click",y=>{y.stopPropagation(),this.handleShowDetails(e)});const T=document.createElement("button");if(T.className="el-button el-button--small el-button--danger",T.innerHTML='<i class="ri-delete-bin-line"></i>',T.title="Remove Plugin",this.registerListener(T,"click",async y=>{y.stopPropagation(),await this.handleRemovePlugin(e.metadata.url)}),b.appendChild(p),f){const y=document.createElement("button");y.className="el-button el-button--small el-button--primary",y.innerHTML='<i class="ri-settings-3-line"></i>',y.title="Plugin Settings",this.registerListener(y,"click",async S=>{S.stopPropagation(),await this.handleShowPluginSettings(e)}),b.appendChild(y)}b.appendChild(x),b.appendChild(C),b.appendChild(T)}return t.appendChild(s),t.appendChild(g),m.children.length>0&&t.appendChild(m),w&&t.appendChild(w),t.appendChild(b),this.registerListener(t,"mouseenter",()=>{t.style.boxShadow="0 4px 12px rgba(0,0,0,0.5)",t.style.transform="translateY(-2px)"}),this.registerListener(t,"mouseleave",()=>{t.style.boxShadow="0 2px 4px rgba(0,0,0,0.3)",t.style.transform="translateY(0)"}),t}createCustomActionButtons(e,t){const s=document.createElement("div");return s.style.cssText="display: flex; gap: 8px; margin-top: 8px; padding-top: 8px; border-top: 1px dashed #404040; flex-wrap: wrap;",t.forEach(n=>{try{const i=document.createElement("button"),o={primary:"el-button--primary",success:"el-button--success",warning:"el-button--warning",danger:"el-button--danger",info:"el-button--info"},r=o[n.color]||o.primary;i.className=`el-button el-button--small ${r}`,i.style.cssText="flex: 1;";let a="";n.icon&&(a+=`<i class="${n.icon}"></i> `),a+=n.title||"Action",i.innerHTML=a,n.description&&(i.title=n.description),n.callback&&typeof n.callback=="function"&&this.registerListener(i,"click",async l=>{l.stopPropagation();try{await n.callback()}catch(c){this.logger.error(`Error executing custom button callback for ${e.metadata.id}:`,c),this.logger.showError(`Button action failed: ${c.message}`)}}),s.appendChild(i)}catch(i){this.logger.error(`Error creating custom button for ${e.metadata.id}:`,i)}}),s}createBadge(e,t){const s=document.createElement("span");return s.style.cssText=`
      background: ${t};
      color: white;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 500;
    `,s.textContent=e,s}getTagColor(e){let t=0;for(let o=0;o<e.length;o++)t=e.charCodeAt(o)+((t<<5)-t),t=t&t;const s=Math.abs(t%360),n=65+Math.abs(t>>8)%11,i=45+Math.abs(t>>16)%11;return`hsl(${s}, ${n}%, ${i}%)`}createFailedSection(e){const t=document.createElement("div");t.style.cssText="margin-bottom: 30px;";const s=document.createElement("h3");s.style.cssText=`
      margin: 0 0 15px 0;
      font-size: 20px;
      font-weight: 600;
      display: flex;
      align-items: center;
      color: #dc3545;
    `,s.innerHTML=`<i class="ri-error-warning-line" style="margin-right: 8px;"></i>Failed to Load (${e.length})`,t.appendChild(s);const n=document.createElement("div");return n.style.cssText="display: flex; flex-direction: column; gap: 10px;",e.forEach(i=>{const o=document.createElement("div");o.style.cssText=`
        background: #fff5f5;
        border: 1px solid #fecaca;
        border-radius: 8px;
        padding: 12px 15px;
        font-size: 13px;
        font-family: 'Consolas', monospace;
        color: #dc3545;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        justify-content: space-between;
        align-items: center;
      `;const r=document.createElement("span");r.textContent=i,r.style.flex="1";const a=document.createElement("button");a.className="el-button el-button--small el-button--danger",a.innerHTML='<i class="ri-restart-line"></i> Retry',o.appendChild(r),o.appendChild(a),this.registerListener(o,"mouseenter",()=>{o.style.background="#ffe6e6"}),this.registerListener(o,"mouseleave",()=>{o.style.background="#fff5f5"}),this.registerListener(r,"click",()=>{this.utils&&this.utils.copyToClipboard(i,"Failed plugin URL")}),this.registerListener(a,"click",async l=>{l.stopPropagation(),await this.handleRetryFailedPlugin(i)}),n.appendChild(o)}),t.appendChild(n),t}async handleTogglePlugin(e){if(this.logger.log(`\u{1F518} User clicked toggle for plugin: ${e}`),this.togglingPlugins.has(e)){this.logger.warn(`Plugin ${e} is already being toggled, ignoring duplicate request`);return}this.togglingPlugins.add(e);try{const t=window.customjs.getModule(e);if(!t){const n=window.customjs.configManager.getPluginConfig(),i=Object.keys(n).find(r=>{const a=r.split("/");return a[a.length-1].replace(/\.js$/,"")===e});if(!i){this.logger.error(`Plugin URL not found for: ${e}`),this.logger.showError(`Plugin URL not found: ${e}`);return}this.logger.log(`Enabling disabled plugin ${e} from ${i}`),this.logger.showInfo("Enabling plugin..."),n[i]=!0,window.customjs.configManager.setPluginConfig(n);const o=await window.customjs.loadModule(i);o.success?(this.logger.log(`Plugin ${e} enabled and loaded`),this.logger.showSuccess("Plugin enabled successfully")):(this.logger.error(`Failed to load plugin: ${o.message}`),this.logger.showError(`Failed to load plugin: ${o.message}`)),setTimeout(()=>this.refreshPluginGrid(),500);return}if(await t.toggle(),this.logger.log(`Toggled plugin ${e}: ${t.enabled?"enabled":"disabled"}`),t.metadata.url&&window.customjs.configManager){const n=window.customjs.configManager.getPluginConfig();n[t.metadata.url]=t.enabled,window.customjs.configManager.setPluginConfig(n)}const s=t.enabled?"enabled":"disabled";this.logger.showSuccess(`${t.metadata.name} ${s}`),setTimeout(()=>this.refreshPluginGrid(),200)}catch(t){this.logger.error(`Error toggling plugin ${e}:`,t),this.logger.showError(`Error: ${t.message}`)}finally{setTimeout(()=>{this.togglingPlugins.delete(e)},500)}}async handleReloadPlugin(e){if(this.logger.log(`\u{1F504} User clicked reload for plugin: ${e}`),!e){this.logger.warn("No URL available for reload"),this.logger.showWarning("Plugin URL not available");return}try{this.logger.log(`  \u2192 Reloading plugin from ${e}`),this.logger.showInfo("Reloading plugin...");const t=window.customjs.configManager.getPluginConfig();t[e]===!1&&(this.logger.log("Plugin is disabled, enabling before reload"),t[e]=!0,window.customjs.configManager.setPluginConfig(t));const s=await window.customjs.reloadModule(e);s.success?(this.logger.log("Plugin reloaded successfully"),this.logger.showSuccess("Plugin reloaded successfully"),setTimeout(()=>this.refreshPluginGrid(),500)):(this.logger.error(`Reload failed: ${s.message}`),this.logger.showError(`Reload failed: ${s.message}`))}catch(t){this.logger.error("Error reloading plugin:",t),this.logger.showError(`Error: ${t.message}`)}}async handleAnalyzePlugin(e){if(this.logger.log(`\u{1F50D} User clicked analyze for plugin: ${e}`),!e){this.logger.warn("No URL available for analysis"),this.logger.showWarning("Plugin URL not available");return}try{this.logger.log(`  \u2192 Analyzing plugin: ${e}`),this.logger.showInfo("Analyzing plugin code...");const t=window.customjs.classes.CustomModule;if(!t?.fetchMetadata){this.logger.error("CustomModule.fetchMetadata not available"),this.logger.showError("Analysis feature not available");return}const s=await t.fetchMetadata(e);s?(this.logger.log("Plugin analysis complete",s),this.showAnalysisDialog(s)):(this.logger.error("Failed to extract metadata"),this.logger.showError("Failed to analyze plugin"))}catch(t){this.logger.error("Error analyzing plugin:",t),this.logger.showError(`Analysis error: ${t.message}`)}}showAnalysisDialog(e){const t=document.createElement("div");t.className="el-overlay",t.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      z-index: 9999;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    `;const s=document.createElement("div");s.style.cssText=`
      background: #2d2d2d;
      border-radius: 8px;
      max-width: 900px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
    `;const n=document.createElement("div");n.style.cssText=`
      padding: 20px;
      border-bottom: 1px solid #404040;
      display: flex;
      justify-content: space-between;
      align-items: center;
    `;const i=document.createElement("h3");i.style.cssText="margin: 0; color: #e0e0e0; font-size: 18px;",i.textContent=`Plugin Analysis: ${e.name||"Unknown"}`;const o=document.createElement("button");o.className="el-button el-button--small",o.innerHTML='<i class="ri-close-line"></i>',o.style.cssText="cursor: pointer;",this.registerListener(o,"click",()=>{t.remove()}),n.appendChild(i),n.appendChild(o);const r=document.createElement("div");r.style.cssText="padding: 20px;";const a=[{title:"Basic Information",data:{Name:e.name,Description:e.description,Authors:e.authors?.map(l=>l.name).join(", ")||"Unknown",Build:e.build,"Class Name":e.className,URL:e.url}},{title:"Code Metrics",data:{Size:e.sizeFormatted,"Line Count":e.lineCount,"Function Count":e.functionCount,"Event Handlers":e.eventHandlerCount}},{title:"Settings",data:{"Settings Count":e.settingsCount,"Categories Count":e.categoriesCount}},{title:"Resource Registrations",data:{Observers:e.observerCount,Listeners:e.listenerCount,Subscriptions:e.subscriptionCount,Hooks:e.hookCount,Timers:e.timerCount}},{title:"Lifecycle Methods",data:{"Has load()":e.lifecycle?.hasLoad?"\u2713":"\u2717","Has start()":e.lifecycle?.hasStart?"\u2713":"\u2717","Has stop()":e.lifecycle?.hasStop?"\u2713":"\u2717","Has onLogin()":e.lifecycle?.hasOnLogin?"\u2713":"\u2717"}},{title:"External APIs",data:{AppApi:e.externalApis?.usesAppApi?"\u2713":"\u2717",Pinia:e.externalApis?.usesPinia?"\u2713":"\u2717","Vue Router":e.externalApis?.usesVueRouter?"\u2713":"\u2717","VRCX API":e.externalApis?.usesVRCXAPI?"\u2713":"\u2717","Web API":e.externalApis?.usesWebAPI?"\u2713":"\u2717"}},{title:"Resource Usage",data:{"Creates DOM":e.resourceUsage?.createsDomElements?"\u2713":"\u2717","Modifies DOM":e.resourceUsage?.modifiesDom?"\u2713":"\u2717",localStorage:e.resourceUsage?.usesLocalStorage?"\u2713":"\u2717",sessionStorage:e.resourceUsage?.usesSessionStorage?"\u2713":"\u2717",WebSocket:e.resourceUsage?.usesWebSocket?"\u2713":"\u2717"}}];if(e.tags&&e.tags.length>0&&a.push({title:"Tags",data:{"Tag List":e.tags.join(", ")}}),e.dependencies&&e.dependencies.length>0&&a.push({title:"Dependencies",data:{"Dependency Count":e.dependencies.length}}),a.forEach(l=>{const c=this.createAnalysisSection(l.title,l.data);r.appendChild(c)}),e.sourceCode){const l=document.createElement("div");l.style.cssText="margin-top: 20px;";const c=document.createElement("h4");c.style.cssText="margin: 0 0 10px 0; color: #409eff; font-size: 14px; text-transform: uppercase;",c.textContent="Source Code";const d=document.createElement("pre");d.style.cssText=`
        background: #1e1e1e;
        padding: 15px;
        border-radius: 4px;
        overflow-x: auto;
        max-height: 400px;
        font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
        font-size: 12px;
        color: #d4d4d4;
        line-height: 1.5;
      `,d.textContent=e.sourceCode,l.appendChild(c),l.appendChild(d),r.appendChild(l)}s.appendChild(n),s.appendChild(r),t.appendChild(s),this.registerListener(t,"click",l=>{l.target===t&&t.remove()}),document.body.appendChild(t),this.logger.showSuccess("Analysis complete")}createAnalysisSection(e,t){const s=document.createElement("div");s.style.cssText="margin-bottom: 15px;";const n=document.createElement("h4");n.style.cssText="margin: 0 0 8px 0; color: #409eff; font-size: 14px; text-transform: uppercase;",n.textContent=e;const i=document.createElement("div");return i.style.cssText=`
      display: grid;
      grid-template-columns: 200px 1fr;
      gap: 8px;
      font-size: 13px;
    `,Object.entries(t).forEach(([o,r])=>{if(r==null)return;const a=document.createElement("div");a.style.cssText="color: #909090; font-weight: 500;",a.textContent=o+":";const l=document.createElement("div");l.style.cssText="color: #e0e0e0;",l.textContent=String(r),i.appendChild(a),i.appendChild(l)}),s.appendChild(n),s.appendChild(i),s}handleShowDetails(e){this.logger.log(`\u2139\uFE0F User clicked info for plugin: ${e.metadata.id}`),this.logger.log("  \u2192 Plugin details:",e),window.AppApi?.ShowDevTools&&window.AppApi.ShowDevTools()}async handleShowPluginSettings(e){this.logger.log(`\u2699\uFE0F User clicked settings for plugin: ${e.metadata.id}`),e.settings?.def&&Object.keys(e.settings.def).length>0?(this.logger.log(`  \u2192 Opening settings modal (${Object.keys(e.settings.def).length} settings)`),this.showSettingsModal(e)):(this.logger.log("  \u2192 Plugin has no configurable settings"),this.logger.showInfo(`${e.metadata.name} has no configurable settings`))}async handleRemovePlugin(e){if(this.logger.log(`\u{1F5D1}\uFE0F User clicked remove for plugin: ${e}`),!e){this.logger.warn("No URL available for removal"),this.logger.showWarning("Plugin URL not available");return}if(!confirm(`Are you sure you want to remove this plugin?

Note: Code will remain in memory until VRCX restart.`)){this.logger.log("  \u2192 User cancelled removal");return}try{this.logger.log(`  \u2192 Removing plugin from ${e}`);const t=await window.customjs.unloadModule(e);t.success?(this.logger.log("Plugin removed successfully"),this.logger.showSuccess("Plugin removed (restart VRCX to fully unload)"),setTimeout(()=>this.refreshPluginGrid(),500)):(this.logger.error(`Removal failed: ${t.message}`),this.logger.showError(`Removal failed: ${t.message}`))}catch(t){this.logger.error("Error removing plugin:",t),this.logger.showError(`Error: ${t.message}`)}}async handleInstallPlugin(e,t){if(this.logger.log(`\u{1F4E5} User clicked install for plugin: ${e}`),!e){this.logger.showWarning("No URL available for installation");return}const s=t.innerHTML;try{t.disabled=!0,t.innerHTML='<i class="ri-loader-4-line ri-spin"></i> Installing...',this.logger.log(`  \u2192 Installing plugin from ${e}`);const n=await window.customjs.loadModule(e);n.success?(t.innerHTML='<i class="ri-check-line"></i> Installed!',t.className="el-button el-button--small el-button--success",this.logger.showSuccess("Plugin installed successfully"),setTimeout(()=>{this.refreshPluginGrid()},1e3)):(t.innerHTML='<i class="ri-error-warning-line"></i> Failed',t.className="el-button el-button--small el-button--danger",this.logger.showError(`Installation failed: ${n.message}`),setTimeout(()=>{t.innerHTML=s,t.className="el-button el-button--small el-button--success",t.disabled=!1},2e3))}catch(n){this.logger.error("Error installing plugin:",n),this.logger.showError(`Error: ${n.message}`),t.innerHTML=s,t.className="el-button el-button--small el-button--success",t.disabled=!1}}async handleRetryFailedPlugin(e){try{this.logger.log(`Retrying failed plugin: ${e}`),this.logger.showInfo("Retrying plugin load...");const t=await window.customjs.loadModule(e);t.success?(this.logger.showSuccess("Plugin loaded successfully!"),setTimeout(()=>this.refreshPluginGrid(),500)):this.logger.showError(`Failed again: ${t.message}`)}catch(t){this.logger.error("Error retrying plugin:",t),this.logger.showError(`Error: ${t.message}`)}}showSettingsModal(e){this.settingsModal&&(this.settingsModal.remove(),this.settingsModal=null);const t=document.createElement("div");t.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      backdrop-filter: blur(2px);
    `;const s=document.createElement("div");s.style.cssText=`
      background: #2d2d2d;
      border-radius: 12px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
      width: 90%;
      max-width: 700px;
      max-height: 80vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    `;const n=document.createElement("div");n.style.cssText=`
      padding: 20px 25px;
      border-bottom: 1px solid #404040;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    `,n.innerHTML=`
      <h3 style="margin: 0; font-size: 20px; font-weight: 600;">
        <i class="ri-settings-3-line"></i> ${e.metadata.name} Settings
      </h3>
      <p style="margin: 5px 0 0 0; font-size: 13px; opacity: 0.9;">
        Configure plugin settings \u2022 Changes are saved automatically
      </p>
    `;const i=document.createElement("div");i.style.cssText=`
      flex: 1;
      overflow-y: auto;
      padding: 20px 25px;
    `,i.appendChild(this.buildSettingsUI(e));const o=document.createElement("div");o.style.cssText=`
      padding: 15px 25px;
      border-top: 1px solid #404040;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #252525;
    `;const r=document.createElement("span");r.style.cssText="font-size: 12px; color: #b0b0b0;",r.textContent="Settings are automatically saved";const a=document.createElement("div");a.style.cssText="display: flex; gap: 10px;";const l=document.createElement("button");l.className="el-button el-button--small el-button--warning",l.innerHTML='<i class="ri-restart-line"></i> Reset to Defaults';const c=document.createElement("button");c.className="el-button el-button--small el-button--primary",c.innerHTML='<i class="ri-close-line"></i> Close',a.appendChild(l),a.appendChild(c),o.appendChild(r),o.appendChild(a),s.appendChild(n),s.appendChild(i),s.appendChild(o),t.appendChild(s),this.registerListener(c,"click",()=>{t.remove(),this.settingsModal=null}),this.registerListener(l,"click",async()=>{confirm(`Reset all settings for "${e.metadata.name}" to their default values?`)&&(e.settings?.resetAll?e.settings.resetAll():e.clearAllSettings(),this.logger.showSuccess("Settings reset to defaults"),i.innerHTML="",i.appendChild(this.buildSettingsUI(e)))}),this.registerListener(t,"click",d=>{d.target===t&&(t.remove(),this.settingsModal=null)}),document.body.appendChild(t),this.settingsModal=t}buildSettingsUI(e){const t=document.createElement("div");if(t.style.cssText="padding: 12px 0;",e.settings?.def&&Object.keys(e.settings.def).length>0){const o=e.settings.def,r={};for(const c in o)o[c].hidden||(r[c]=o[c]);if(Object.keys(r).length===0){const c=document.createElement("div");c.style.cssText="text-align: center; padding: 20px; color: #909090;";const d=document.createElement("i");d.className="ri-inbox-line",d.style.cssText="font-size: 32px; opacity: 0.5; display: block; margin-bottom: 8px; color: #909090;";const g=document.createElement("p");return g.style.cssText="margin: 0; font-size: 13px; color: #b0b0b0;",g.textContent="This plugin has no configurable settings",c.appendChild(d),c.appendChild(g),t.appendChild(c),t}const a={};for(const c in r){const d=r[c].category||"general";a[d]||(a[d]={}),a[d][c]=r[c]}const l=e.categories||{};return Object.entries(a).forEach(([c,d])=>{const g=document.createElement("div");g.style.cssText="margin-bottom: 20px;";const u=document.createElement("div");u.style.cssText=`
          margin-bottom: 12px;
          padding-bottom: 8px;
          border-bottom: 2px solid #404040;
        `;const h=document.createElement("h4");if(h.style.cssText=`
          margin: 0;
          font-size: 15px;
          font-weight: 600;
          color: #e0e0e0;
        `,h.textContent=l[c]?.name||this.formatCategoryName(c),u.appendChild(h),l[c]?.description){const m=document.createElement("p");m.style.cssText=`
            margin: 4px 0 0 0;
            font-size: 12px;
            color: #b0b0b0;
          `,m.textContent=l[c].description,u.appendChild(m)}g.appendChild(u),Object.entries(d).forEach(([m,w])=>{const b=this.createSettingRow(e,m,w);g.appendChild(b)}),t.appendChild(g)}),t}const s=document.createElement("div");s.style.cssText="text-align: center; padding: 20px; color: #909090;";const n=document.createElement("i");n.className="ri-inbox-line",n.style.cssText="font-size: 32px; opacity: 0.5; display: block; margin-bottom: 8px; color: #909090;";const i=document.createElement("p");return i.style.cssText="margin: 0; font-size: 13px; color: #b0b0b0;",i.textContent="This plugin has no configurable settings",s.appendChild(n),s.appendChild(i),t.appendChild(s),t}createSettingRow(e,t,s){const n=document.createElement("div");n.style.cssText="margin-bottom: 8px;";const i=document.createElement("div");i.style.cssText=`
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 12px;
      background: #353535;
      border-radius: 6px;
      border: 1px solid #4a4a4a;
    `;const o=document.createElement("div");o.style.cssText="flex: 1; min-width: 0; margin-right: 12px;";const r=document.createElement("div");r.style.cssText="font-size: 13px; font-weight: 500; color: #e8e8e8; margin-bottom: 2px;",r.textContent=s.description||t,o.appendChild(r);const a=document.createElement("div");a.style.cssText="min-width: 140px; display: flex; justify-content: flex-end;";const l=this.createInputForSetting(e,t,s);if(a.appendChild(l),i.appendChild(o),i.appendChild(a),n.appendChild(i),s.variables&&Object.keys(s.variables).length>0){const c=this.createVariablesDisplay(s.variables);n.appendChild(c)}return n}createVariablesDisplay(e){const t=document.createElement("div");t.style.cssText=`
      margin-top: 4px;
      padding: 8px 12px;
      background: #2a2a2a;
      border-radius: 4px;
      border-left: 3px solid #409eff;
    `;const s=document.createElement("div");s.style.cssText=`
      font-size: 11px;
      font-weight: 600;
      color: #409eff;
      margin-bottom: 6px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    `,s.textContent="Available Variables";const n=document.createElement("div");return n.style.cssText=`
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 4px;
      font-size: 11px;
    `,Object.entries(e).forEach(([i,o])=>{const r=document.createElement("div");r.style.cssText=`
        display: flex;
        align-items: baseline;
        gap: 6px;
        padding: 2px 0;
      `;const a=document.createElement("code");a.style.cssText=`
        color: #67c23a;
        background: #1e1e1e;
        padding: 2px 6px;
        border-radius: 3px;
        font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
        font-size: 10px;
        white-space: nowrap;
        cursor: pointer;
        border: 1px solid #3a3a3a;
      `,a.textContent=i,a.title="Click to copy",this.registerListener(a,"click",()=>{if(this.utils){this.utils.copyToClipboard(i);const c=a.style.background;a.style.background="#67c23a",setTimeout(()=>{a.style.background=c},200)}});const l=document.createElement("span");l.style.cssText="color: #909090; flex: 1;",l.textContent=o,r.appendChild(a),r.appendChild(l),n.appendChild(r)}),t.appendChild(s),t.appendChild(n),t}createInputForSetting(e,t,s){const n=e.settings.store[t],i=window.customjs.types.SettingType;switch(s.type){case i.BOOLEAN:return this.createBooleanInput(e,t,n);case i.NUMBER:case i.BIGINT:return this.createNumberInput(e,t,n);case i.STRING:return this.createStringInput(e,t,n,s.placeholder);case i.SELECT:return this.createSelectInput(e,t,n,s.options||[]);case i.SLIDER:return this.createSliderInput(e,t,n,s.markers||[]);case i.TIMESPAN:return this.createTimespanInput(e,t,n);case i.CUSTOM:return this.createCustomInput(e,t,n);default:const o=document.createElement("span");return o.style.cssText="color: #f56c6c; font-size: 12px;",o.textContent=`Unsupported type: ${s.type}`,o}}createBooleanInput(e,t,s){const n=document.createElement("label");n.className="el-switch",n.style.cssText="cursor: pointer; display: flex; align-items: center;";const i=document.createElement("input");i.type="checkbox",i.checked=s,i.style.display="none";const o=document.createElement("span");o.style.cssText=`
      display: inline-block;
      position: relative;
      width: 40px;
      height: 20px;
      border-radius: 10px;
      background: ${s?"#409eff":"#dcdfe6"};
      transition: background-color 0.3s;
      cursor: pointer;
    `;const r=document.createElement("span");return r.style.cssText=`
      position: absolute;
      top: 1px;
      left: ${s?"21px":"1px"};
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: white;
      transition: all 0.3s;
      cursor: pointer;
    `,o.appendChild(r),n.appendChild(i),n.appendChild(o),this.registerListener(n,"click",a=>{a.stopPropagation();try{const l=!i.checked;e.settings.store[t]=l,i.checked=l,o.style.background=l?"#409eff":"#dcdfe6",r.style.left=l?"21px":"1px",this.logger.log(`Setting ${t} changed to ${l} (old: ${!l})`)}catch(l){this.logger.error(`Error toggling ${t}:`,l)}}),n}createNumberInput(e,t,s){const n=document.createElement("input");return n.type="number",n.className="el-input__inner",n.value=s??"",n.style.cssText="width: 100%; padding: 6px 10px; border: 1px solid #5a5a5a; border-radius: 4px; font-size: 13px; background: #1e1e1e; color: #e0e0e0;",this.registerListener(n,"change",i=>{try{const o=parseFloat(n.value);isNaN(o)||(e.settings.store[t]=o,this.logger.log(`Setting ${t} changed to ${o}`))}catch(o){this.logger.error(`Error updating ${t}:`,o)}}),n}createStringInput(e,t,s,n){const i=s||"";if(i.includes(`
`))return this.createMultilineTextarea(e,t,i,{placeholder:n,maxLines:30,minLines:3,validateJson:!1});const r=document.createElement("input");return r.type="text",r.className="el-input__inner",r.value=i,r.placeholder=n||"",r.style.cssText="width: 100%; padding: 6px 10px; border: 1px solid #5a5a5a; border-radius: 4px; font-size: 13px; background: #1e1e1e; color: #e0e0e0;",this.registerListener(r,"change",a=>{try{e.settings.store[t]=r.value,this.logger.log(`Setting ${t} changed to "${r.value}"`)}catch(l){this.logger.error(`Error updating ${t}:`,l)}}),r}createMultilineTextarea(e,t,s,n={}){const i=n.placeholder||"",o=n.maxLines||30,r=n.minLines||3,a=n.validateJson||!1,l=document.createElement("div");l.style.cssText="width: 100%;";const c=a?JSON.stringify(s,null,2):s||"",d=Math.min((c.match(/\n/g)||[]).length+1,o),g=document.createElement("textarea");g.className="el-textarea__inner",g.value=c,g.placeholder=i,g.rows=Math.max(d,r),g.style.cssText=`
      width: 100%;
      padding: 8px 10px;
      border: 1px solid #5a5a5a;
      border-radius: 4px;
      font-size: 13px;
      font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
      background: #1e1e1e;
      color: #e0e0e0;
      resize: vertical;
      min-height: ${r*20}px;
      max-height: ${o*20}px;
      line-height: 1.5;
    `;let u,h;return a&&(u=document.createElement("div"),u.style.cssText=`
        font-size: 11px;
        color: #f56c6c;
        margin-top: 4px;
        display: none;
      `,h=document.createElement("div"),h.style.cssText=`
        font-size: 11px;
        color: #67c23a;
        margin-top: 4px;
        display: none;
      `),this.registerListener(g,"input",()=>{const m=Math.min((g.value.match(/\n/g)||[]).length+1,o);g.rows=Math.max(m,r),a&&u&&h&&(u.style.display="none",h.style.display="none")}),this.registerListener(g,"focus",()=>{g.style.borderColor="#409eff"}),this.registerListener(g,"blur",()=>{if(g.style.borderColor="#5a5a5a",a)try{const m=JSON.parse(g.value);e.settings.store[t]=m,h&&(h.textContent="\u2713 Valid JSON saved",h.style.display="block"),u&&(u.style.display="none");const w=JSON.stringify(m,null,2);g.value=w;const b=Math.min((w.match(/\n/g)||[]).length+1,o);g.rows=Math.max(b,r),setTimeout(()=>{h&&(h.style.display="none")},2e3)}catch(m){u&&(u.textContent=`\u2717 Invalid JSON: ${m.message}`,u.style.display="block"),h&&(h.style.display="none"),g.style.borderColor="#f56c6c"}else try{e.settings.store[t]=g.value,this.logger.log(`Setting ${t} updated (multiline)`)}catch(m){this.logger.error(`Error updating ${t}:`,m)}}),l.appendChild(g),a&&u&&h&&(l.appendChild(u),l.appendChild(h)),l}createSelectInput(e,t,s,n){const i=document.createElement("select");return i.className="el-select",i.style.cssText="padding: 6px 28px 6px 10px; border: 1px solid #5a5a5a; border-radius: 4px; font-size: 13px; background: #1e1e1e; color: #e0e0e0; cursor: pointer;",n.forEach(o=>{const r=document.createElement("option");r.value=o.value,r.textContent=o.label||o.value,(o.value===s||o.default)&&(r.selected=!0),i.appendChild(r)}),this.registerListener(i,"change",o=>{try{e.settings.store[t]=i.value,this.logger.log(`Setting ${t} changed to "${i.value}"`)}catch(r){this.logger.error(`Error updating ${t}:`,r)}}),i}createSliderInput(e,t,s,n){const i=document.createElement("div");i.style.cssText="width: 100%; min-width: 120px;";const o=document.createElement("input");o.type="range",o.min=String(n[0]??0),o.max=String(n[n.length-1]??1),o.step=String(n.length>1?n[1]-n[0]:.1),o.value=String(s??n[0]??0),o.style.cssText="width: 100%; cursor: pointer;";const r=document.createElement("div");return r.style.cssText="text-align: center; font-size: 12px; color: #b0b0b0; margin-top: 4px;",r.textContent=o.value,this.registerListener(o,"input",a=>{try{r.textContent=o.value,e.settings.store[t]=parseFloat(o.value),this.logger.log(`Setting ${t} changed to ${o.value}`)}catch(l){this.logger.error(`Error updating ${t}:`,l)}}),i.appendChild(o),i.appendChild(r),i}createTimespanInput(e,t,s){const n=document.createElement("div");n.style.cssText="display: flex; align-items: center; gap: 8px; width: 100%;";const i=document.createElement("input");i.type="text",i.className="el-input__inner",i.style.cssText="flex: 1; min-width: 120px; padding: 8px 12px; border: 1px solid #dcdfe6; border-radius: 4px; font-size: 14px;";const o=this.utils?.formatTimespan?this.utils.formatTimespan(s):`${s}ms`;i.value=o,i.placeholder="e.g., 1h 20m, 00:50.100, or 5000";const r=document.createElement("span");return r.style.cssText="color: #909090; font-size: 12px; min-width: 80px;",r.textContent=`(${s}ms)`,this.registerListener(i,"blur",a=>{try{const l=a.target.value,c=this.utils?.parseTimespan?this.utils.parseTimespan(l):parseInt(l,10);if(isNaN(c)||c<0){this.logger.showWarning("Invalid timespan format"),i.value=o;return}e.settings.store[t]=c;const d=this.utils?.formatTimespan?this.utils.formatTimespan(c):`${c}ms`;i.value=d,r.textContent=`(${c}ms)`,this.logger.log(`Timespan ${t} changed to ${c}ms (${d})`)}catch(l){this.logger.error(`Error updating timespan ${t}:`,l),i.value=o}}),this.registerListener(i,"keydown",a=>{a.key==="Enter"&&i.blur()}),n.appendChild(i),n.appendChild(r),n}createCustomInput(e,t,s){return this.createMultilineTextarea(e,t,s,{placeholder:"",maxLines:50,minLines:2,validateJson:!0})}formatBuildDate(e){if(!e)return"Unknown";try{let t=typeof e=="string"?parseInt(e,10):e;if(isNaN(t))return e.toString();t.toString().length===10&&(t=t*1e3);const s=new Date(t),n=s.getFullYear();if(isNaN(s.getTime())||n<2020||n>2050||s.getTime()<0)return e.toString();const i={year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"};return s.toLocaleString("en-US",i)}catch{return e.toString()}}formatCategoryName(e){return e.replace(/([A-Z])/g," $1").replace(/_/g," ").replace(/^./,t=>t.toUpperCase()).trim()}formatSettingName(e){return e.replace(/([A-Z])/g," $1").replace(/_/g," ").replace(/^./,t=>t.toUpperCase()).trim()}inferType(e){return e==null?"string":typeof e=="boolean"?"boolean":typeof e=="number"?"number":Array.isArray(e)?"array":typeof e=="object"?"object":"string"}};L(v,"PluginManagerUIPlugin");let E=v;window.customjs.__LAST_PLUGIN_CLASS__=E;})();
