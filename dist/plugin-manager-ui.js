(()=>{var v=Object.defineProperty;var C=(E,e)=>v(E,"name",{value:e,configurable:!0});const w=class w extends Plugin{constructor(){super({name:"\u{1F9E9} Plugin Manager UI",description:"Visual UI for managing VRCX custom plugins - Equicord inspired",authors:[{name:"Bluscream"}],build:"1760846455",tags:["UI","Core","Settings"],dependencies:["https://github.com/vrcx-plugin-system/plugins/raw/refs/heads/main/dist/nav-menu-api.js"]}),this.settingsModal=null,this.searchValue={value:"",filter:"all"},this.togglingPlugins=new Set}async load(){this.logger.log("Plugin Manager UI ready"),this.loaded=!0}async start(){if(this.utils=window.customjs.utils,this.navMenuApi=await window.customjs.pluginManager.waitForPlugin("nav-menu-api"),!this.navMenuApi){this.logger.error("Nav Menu API plugin not found");return}this.setupNavMenuItem(),this.enabled=!0,this.started=!0,this.logger.log("Plugin Manager UI started")}async onLogin(e){}async stop(){this.logger.log("Stopping Plugin Manager UI"),this.navMenuApi&&this.navMenuApi.removeItem("plugins"),this.settingsModal&&(this.settingsModal.remove(),this.settingsModal=null),await super.stop()}setupNavMenuItem(){if(!this.navMenuApi){this.logger.error("NavMenu plugin not found!");return}this.logger.log("Setting up Plugins nav menu item"),this.navMenuApi.addItem("plugins",{label:"Plugins",icon:"ri-plug-line",content:()=>this.createPanelContent(),before:"settings",onShow:()=>this.onPluginsTabShown(),onHide:()=>this.onPluginsTabHidden()}),this.logger.log("\u2713 Plugins nav menu item registered")}onPluginsTabShown(){this.logger.log("\u{1F3AF} Plugins tab shown - user navigated to Plugins view"),setTimeout(()=>this.refreshPluginGrid(),50)}onPluginsTabHidden(){this.logger.log("\u{1F44B} Plugins tab hidden - user navigated away from Plugins view")}createPanelContent(){this.logger.log("\u{1F3A8} Creating plugin manager panel content");const e=document.createElement("div");e.style.cssText=`
      padding: 20px;
      max-width: 1400px;
      margin: 0 auto;
    `;try{this.logger.log("  \u2192 Building stats section"),e.appendChild(this.createStatsSection()),this.logger.log("  \u2192 Building repository management section"),e.appendChild(this.createRepoManagementSection()),this.logger.log("  \u2192 Building config sync section"),e.appendChild(this.createConfigSyncSection()),this.logger.log("  \u2192 Building load plugin section"),e.appendChild(this.createLoadPluginSection()),this.logger.log("  \u2192 Building filter section"),e.appendChild(this.createFilterSection());const t=document.createElement("div");t.id="plugin-grid-container",t.className="vc-plugins-grid",e.appendChild(t),this.pluginGridContainer=t,this.logger.log("\u2713 Plugin manager panel content created successfully")}catch(t){this.logger.error("Error creating plugin manager content:",t);const n=document.createElement("div");n.style.cssText="padding: 20px; text-align: center; color: #dc3545;";const s=document.createElement("h3");s.textContent="\u274C Error Loading Plugin Manager";const o=document.createElement("p");o.textContent=t.message;const i=document.createElement("button");i.className="el-button el-button--primary",i.innerHTML='<i class="ri-restart-line"></i> Reload VRCX',this.registerListener(i,"click",()=>location.reload()),n.appendChild(s),n.appendChild(o),n.appendChild(i),e.appendChild(n)}return e}createStatsSection(){const e=document.createElement("div");e.style.cssText="margin-bottom: 12px;";const t=document.createElement("div");t.style.cssText="display: grid; grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); gap: 6px; margin-bottom: 10px;";const n=window.customjs?.plugins||[],s=window.customjs?.core_modules||[],o=window.customjs?.pluginManager?.failedUrls||new Set,i=window.customjs?.repoManager,r=i?.getAllRepositories()?.length||0,a=i?.getEnabledRepositories()?.length||0,l=n.filter(g=>g.enabled).length,d=n.filter(g=>g.started).length;return[{label:"Repos",value:`${a}/${r}`,color:"#9c27b0"},{label:"Plugins",value:n.length,color:"#28a745"},{label:"Core Modules",value:s.length,color:"#28a745"}].forEach(g=>{const p=this.createStatCard(g.label,g.value,g.color);t.appendChild(p)}),e.appendChild(t),e}createStatCard(e,t,n){const s=document.createElement("div");s.style.cssText=`
      text-align: center;
      padding: 6px 8px;
      background: ${n};
      border-radius: 3px;
      color: white;
      box-shadow: 0 1px 2px ${window.customjs.utils.hexToRgba(n,.3)};
      transition: transform 0.15s, box-shadow 0.15s;
    `;const o=document.createElement("div");o.style.cssText="font-size: 16px; font-weight: 600;",o.textContent=t;const i=document.createElement("div");return i.style.cssText="font-size: 9px; opacity: 0.85; margin-top: 1px;",i.textContent=e,s.appendChild(o),s.appendChild(i),this.registerListener(s,"mouseenter",()=>{s.style.transform="translateY(-1px)",s.style.boxShadow=`0 2px 6px ${window.customjs.utils.hexToRgba(n,.4)}`}),this.registerListener(s,"mouseleave",()=>{s.style.transform="translateY(0)",s.style.boxShadow=`0 1px 3px ${window.customjs.utils.hexToRgba(n,.3)}`}),s}createRepoManagementSection(){const e=document.createElement("div");e.style.cssText="margin-bottom: 20px;";const t=document.createElement("h5");t.style.cssText="margin: 0 0 12px 0; font-size: 16px; font-weight: 600;",t.textContent="\u{1F4E6} Plugin Repositories",e.appendChild(t);const n=document.createElement("p");n.style.cssText="margin: 0 0 12px 0; font-size: 14px; color: #6c757d;",n.textContent="Manage plugin repositories to install and update plugins",e.appendChild(n);const s=document.createElement("div");s.id="repo-list-container",s.style.cssText="margin-bottom: 12px;",e.appendChild(s);const o=document.createElement("div");o.style.cssText="display: flex; gap: 10px; margin-bottom: 10px;";const i=document.createElement("input");i.type="text",i.placeholder="https://example.com/repo.json",i.className="el-input__inner",i.style.cssText="flex: 1; padding: 8px 12px; border: 1px solid #5a5a5a; border-radius: 4px; font-size: 13px; font-family: 'Consolas', monospace; background: #1e1e1e; color: #e0e0e0;";const r=document.createElement("button");r.className="el-button el-button--primary",r.innerHTML='<i class="ri-add-line"></i> Add Repository',this.registerListener(r,"click",async()=>{await this.handleAddRepository(i)});const a=document.createElement("button");return a.className="el-button el-button--success",a.innerHTML='<i class="ri-refresh-line"></i> Refresh All',a.title="Refresh all repositories",this.registerListener(a,"click",async()=>{await this.handleRefreshRepositories(a)}),o.appendChild(i),o.appendChild(r),o.appendChild(a),e.appendChild(o),this.renderRepositoryList(s),e}renderRepositoryList(e){e.innerHTML="";const t=window.customjs?.repoManager;if(!t){const s=document.createElement("div");s.style.cssText="padding: 10px; color: #dc3545;",s.textContent="\u26A0\uFE0F Repository manager not available",e.appendChild(s);return}const n=t.getAllRepositories();if(n.length===0){const s=document.createElement("div");s.style.cssText="padding: 10px; color: #6c757d;",s.textContent="No repositories configured",e.appendChild(s);return}n.forEach(s=>{const o=this.createRepositoryCard(s);e.appendChild(o)})}createRepositoryCard(e){const t=document.createElement("div");t.style.cssText=`
      background: ${e.enabled?"#2d2d2d":"#1e1e1e"};
      border: 1px solid ${e.enabled?"#4a4a4a":"#333"};
      border-radius: 4px;
      padding: 12px;
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      opacity: ${e.enabled?"1":"0.6"};
      transition: all 0.2s;
    `;const n=document.createElement("div");n.style.cssText="flex: 1; min-width: 0;";const s=document.createElement("div");s.style.cssText="font-size: 14px; font-weight: 600; color: #e8e8e8; margin-bottom: 4px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;",s.textContent=e.data?.name||"Loading...";const o=document.createElement("div");o.style.cssText="font-size: 11px; color: #909090; font-family: monospace; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;",o.textContent=e.url,o.title=e.url;const i=document.createElement("div");i.style.cssText="font-size: 11px; color: #6c757d; margin-top: 4px;";const r=e.data?.plugins?.length||0;i.textContent=`${r} plugins \u2022 ${e.loaded?"\u2713 Loaded":"\u23F3 Loading..."}`,n.appendChild(s),n.appendChild(o),n.appendChild(i);const a=document.createElement("div");a.style.cssText="display: flex; gap: 8px; align-items: center;";const l=document.createElement("label");l.className="el-switch",l.style.cssText="cursor: pointer; display: flex; align-items: center;",l.title=e.enabled?"Disable repository":"Enable repository";const d=document.createElement("input");d.type="checkbox",d.checked=e.enabled,d.style.display="none";const u=document.createElement("span");u.style.cssText=`
      display: inline-block;
      position: relative;
      width: 40px;
      height: 20px;
      border-radius: 10px;
      background: ${e.enabled?"#409eff":"#dcdfe6"};
      transition: background-color 0.3s;
      cursor: pointer;
    `;const g=document.createElement("span");g.style.cssText=`
      position: absolute;
      top: 1px;
      left: ${e.enabled?"21px":"1px"};
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: white;
      transition: all 0.3s;
    `,u.appendChild(g),l.appendChild(d),l.appendChild(u),this.registerListener(l,"click",async h=>{h.stopPropagation(),await this.handleToggleRepository(e.url,!e.enabled)});const p=document.createElement("button");p.className="el-button el-button--small el-button--info",p.innerHTML='<i class="ri-refresh-line"></i>',p.title="Refresh repository",this.registerListener(p,"click",async h=>{h.stopPropagation(),await this.handleRefreshRepository(e.url,p)});const c=document.createElement("button");return c.className="el-button el-button--small el-button--danger",c.innerHTML='<i class="ri-delete-bin-line"></i>',c.title="Remove repository",this.registerListener(c,"click",async h=>{h.stopPropagation(),await this.handleRemoveRepository(e.url)}),a.appendChild(l),a.appendChild(p),a.appendChild(c),t.appendChild(n),t.appendChild(a),t}async handleAddRepository(e){const t=e.value.trim();if(this.logger.log(`\u{1F4E6} User requested to add repository: ${t}`),!t){this.logger.showWarn("Please enter a repository URL");return}if(!t.endsWith(".json")){this.logger.showWarn("Repository URL must end with .json");return}const n=window.customjs?.repoManager;if(!n){this.logger.showError("Repository manager not available");return}try{this.logger.log("  \u2192 Adding repository via RepoManager..."),this.logger.showInfo("Adding repository...");const s=await n.addRepository(t);if(s.success){this.logger.showSuccess(`Repository added: ${s.repo?.data?.name||t}`),e.value="";const o=document.getElementById("repo-list-container");o&&this.renderRepositoryList(o),this.refreshPluginGrid()}else this.logger.showError(`Failed to add repository: ${s.message}`)}catch(s){this.logger.error("Error adding repository:",s),this.logger.showError(`Error: ${s.message}`)}}async handleToggleRepository(e,t){this.logger.log(`\u{1F518} User toggled repository: ${e} (${t?"enable":"disable"})`);const n=window.customjs?.repoManager;if(!n){this.logger.showError("Repository manager not available");return}try{if(n.setRepositoryEnabled(e,t)){this.logger.showSuccess(`Repository ${t?"enabled":"disabled"}`);const o=document.getElementById("repo-list-container");o&&this.renderRepositoryList(o),this.refreshPluginGrid()}else this.logger.showError("Failed to toggle repository")}catch(s){this.logger.error("Error toggling repository:",s),this.logger.showError(`Error: ${s.message}`)}}async handleRefreshRepository(e,t){this.logger.log(`\u{1F504} User clicked refresh for repository: ${e}`);const n=window.customjs?.repoManager;if(!n){this.logger.showError("Repository manager not available");return}const s=t.innerHTML;try{if(t.disabled=!0,t.innerHTML='<i class="ri-loader-4-line ri-spin"></i>',this.logger.log("  \u2192 Refreshing repository..."),await n.refreshRepository(e)){t.innerHTML='<i class="ri-check-line"></i>',this.logger.showSuccess("Repository refreshed");const i=document.getElementById("repo-list-container");i&&this.renderRepositoryList(i),this.refreshPluginGrid(),setTimeout(()=>{t.innerHTML=s,t.disabled=!1},1e3)}else t.innerHTML='<i class="ri-error-warning-line"></i>',this.logger.showError("Failed to refresh repository"),setTimeout(()=>{t.innerHTML=s,t.disabled=!1},2e3)}catch(o){this.logger.error("Error refreshing repository:",o),this.logger.showError(`Error: ${o.message}`),t.innerHTML=s,t.disabled=!1}}async handleRefreshRepositories(e){this.logger.log("\u{1F504} User clicked refresh all repositories");const t=window.customjs?.repoManager;if(!t){this.logger.showError("Repository manager not available");return}const n=e.innerHTML;try{e.disabled=!0,e.innerHTML='<i class="ri-loader-4-line ri-spin"></i> Refreshing...',this.logger.log("  \u2192 Refreshing all repositories..."),await t.refreshAllRepositories(),e.innerHTML='<i class="ri-check-line"></i> Refreshed!',this.logger.showSuccess("All repositories refreshed");const s=document.getElementById("repo-list-container");s&&this.renderRepositoryList(s),this.refreshPluginGrid(),setTimeout(()=>{e.innerHTML=n,e.disabled=!1},2e3)}catch(s){this.logger.error("Error refreshing repositories:",s),this.logger.showError(`Error: ${s.message}`),e.innerHTML=n,e.disabled=!1}}async handleRemoveRepository(e){if(this.logger.log(`\u{1F5D1}\uFE0F User clicked remove for repository: ${e}`),!confirm(`Are you sure you want to remove this repository?

${e}`)){this.logger.log("  \u2192 User cancelled removal");return}const t=window.customjs?.repoManager;if(!t){this.logger.showError("Repository manager not available");return}try{if(this.logger.log("  \u2192 Removing repository..."),t.removeRepository(e)){this.logger.showSuccess("Repository removed");const s=document.getElementById("repo-list-container");s&&this.renderRepositoryList(s),this.refreshPluginGrid()}else this.logger.showError("Failed to remove repository")}catch(n){this.logger.error("Error removing repository:",n),this.logger.showError(`Error: ${n.message}`)}}createConfigSyncSection(){const e=document.createElement("div");e.style.cssText="margin-bottom: 20px;";const t=document.createElement("h5");t.style.cssText="margin: 0 0 12px 0; font-size: 16px; font-weight: 600;",t.textContent="\u2699\uFE0F Config Sync",e.appendChild(t);const n=document.createElement("p");n.style.cssText="margin: 0 0 12px 0; font-size: 14px; color: #6c757d;",n.textContent="Sync settings between browser localStorage and VRChat config.json (vrcx.customjs path)",e.appendChild(n);const s=document.createElement("div");s.style.cssText="display: flex; gap: 12px;";const o=document.createElement("button");o.className="el-button el-button--primary",o.innerHTML='<i class="ri-download-cloud-line"></i> Import from VRChat Config',this.registerListener(o,"click",async()=>{await this.handleImportConfig(o)});const i=document.createElement("button");return i.className="el-button el-button--success",i.innerHTML='<i class="ri-upload-cloud-line"></i> Export to VRChat Config',this.registerListener(i,"click",async()=>{await this.handleExportConfig(i)}),s.appendChild(o),s.appendChild(i),e.appendChild(s),e}async handleImportConfig(e){this.logger.log("\u{1F4E5} User clicked import from VRChat config");const t=e.innerHTML;try{e.disabled=!0,e.innerHTML='<i class="ri-loader-4-line ri-spin"></i> Importing...',this.logger.log("  \u2192 Importing config from VRChat config.json...");const n=await window.customjs.configManager.importFromVRChatConfig();n&&n.importCount>0?(e.innerHTML='<i class="ri-check-line"></i> Imported!',e.className="el-button el-button--success",this.logger.showSuccess(`Successfully imported ${n.importCount} settings from VRChat config.json!`),setTimeout(()=>{this.refreshPluginGrid(),e.innerHTML=t,e.className="el-button el-button--primary",e.disabled=!1},2e3)):n&&n.importCount===0?(e.innerHTML='<i class="ri-information-line"></i> No settings',e.className="el-button el-button--warning",this.logger.showWarn("No settings found to import from VRChat config.json"),setTimeout(()=>{e.innerHTML=t,e.className="el-button el-button--primary",e.disabled=!1},2e3)):(e.innerHTML='<i class="ri-error-warning-line"></i> Failed',e.className="el-button el-button--danger",this.logger.showError("Failed to import settings from VRChat config.json"),setTimeout(()=>{e.innerHTML=t,e.className="el-button el-button--primary",e.disabled=!1},2e3))}catch(n){this.logger.error("Error importing config:",n),e.innerHTML='<i class="ri-error-warning-line"></i> Error',e.className="el-button el-button--danger",setTimeout(()=>{e.innerHTML=t,e.className="el-button el-button--primary",e.disabled=!1},2e3)}}async handleExportConfig(e){this.logger.log("\u{1F4E4} User clicked export to VRChat config");const t=e.innerHTML;try{e.disabled=!0,e.innerHTML='<i class="ri-loader-4-line ri-spin"></i> Exporting...',this.logger.log("  \u2192 Exporting config to VRChat config.json...");const n=await window.customjs.configManager.exportToVRChatConfig();if(n&&n.success){e.innerHTML='<i class="ri-check-line"></i> Exported!',e.className="el-button el-button--success";const s=n.filePath||window.customjs.configManager.vrchatConfigPath;await this.utils.copyToClipboard(s,"VRChat config.json path"),this.logger.log(`Exported to: ${s}`),this.logger.log(`Exported ${n.settingsCount} settings`),this.logger.showSuccess("Settings exported successfully! Path copied to clipboard."),setTimeout(()=>{e.innerHTML=t,e.className="el-button el-button--success",e.disabled=!1},2e3)}else e.innerHTML='<i class="ri-error-warning-line"></i> Failed',e.className="el-button el-button--danger",this.logger.showError("Failed to export settings to VRChat config.json"),setTimeout(()=>{e.innerHTML=t,e.className="el-button el-button--success",e.disabled=!1},2e3)}catch(n){this.logger.error("Error exporting config:",n),e.innerHTML='<i class="ri-error-warning-line"></i> Error',e.className="el-button el-button--danger",setTimeout(()=>{e.innerHTML=t,e.className="el-button el-button--success",e.disabled=!1},2e3)}}createFilterSection(){const e=document.createElement("div");e.style.cssText="margin-bottom: 20px;";const t=document.createElement("h5");t.style.cssText="margin: 0 0 12px 0; font-size: 16px; font-weight: 600;",t.textContent="\u{1F527} Filters",e.appendChild(t);const n=document.createElement("div");n.style.cssText="display: flex; gap: 12px; margin-bottom: 16px;";const s=document.createElement("input");s.type="text",s.placeholder="Search for a plugin...",s.className="el-input__inner",s.style.cssText="flex: 2; padding: 8px 12px; border: 1px solid #dcdfe6; border-radius: 4px; font-size: 14px;",s.value=this.searchValue.value,this.registerListener(s,"input",r=>{this.searchValue.value=r.target.value.toLowerCase(),this.logger.log(`\u{1F50D} User changed search query to: "${this.searchValue.value}"`),this.refreshPluginGrid()});const o=document.createElement("select");return o.className="el-select",o.style.cssText="padding: 8px 24px 8px 12px; border: 1px solid #5a5a5a; border-radius: 4px; font-size: 14px; width: 180px; background: #2d2d2d; color: #e0e0e0; cursor: pointer;",[{value:"all",label:"Show All"},{value:"enabled",label:"Enabled"},{value:"disabled",label:"Disabled"},{value:"available",label:"Available (Not Installed)"},{value:"core",label:"Core"},{value:"failed",label:"Failed"}].forEach(r=>{const a=document.createElement("option");a.value=r.value,a.textContent=r.label,r.value===this.searchValue.filter&&(a.selected=!0),o.appendChild(a)}),this.registerListener(o,"change",r=>{this.searchValue.filter=r.target.value,this.logger.log(`\u{1F53D} User changed filter to: ${this.searchValue.filter}`),this.refreshPluginGrid()}),n.appendChild(s),n.appendChild(o),e.appendChild(n),e}createLoadPluginSection(){const e=document.createElement("div");e.style.cssText=`
      background: #2d2d2d;
      border: 2px dashed #4a4a4a;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 20px;
    `;const t=document.createElement("h3");t.style.cssText="margin: 0 0 12px 0; font-size: 16px; font-weight: 600; display: flex; align-items: center; color: #e0e0e0;";const n=document.createElement("i");n.className="ri-download-cloud-line",n.style.cssText="color: #61afef; margin-right: 8px; font-size: 18px;";const s=document.createTextNode("Load Plugin from URL");t.appendChild(n),t.appendChild(s),e.appendChild(t);const o=document.createElement("div");o.style.cssText="display: flex; gap: 10px; margin-bottom: 10px;";const i=document.createElement("input");i.type="text",i.id="plugin-url-input",i.placeholder="https://github.com/USER/REPO/raw/refs/heads/main/js/plugins/my-plugin.js",i.className="el-input__inner",i.style.cssText="flex: 1; padding: 8px 12px; border: 1px solid #5a5a5a; border-radius: 4px; font-size: 13px; font-family: 'Consolas', monospace; background: #1e1e1e; color: #e0e0e0;";const r=document.createElement("button");r.id="load-plugin-btn",r.className="el-button el-button--primary",r.style.cssText="padding: 8px 16px;",r.innerHTML='<i class="ri-download-line"></i> Load',o.appendChild(i),o.appendChild(r),e.appendChild(o);const a=document.createElement("div");return a.id="load-plugin-status",a.style.cssText="margin-top: 8px; font-size: 12px; color: #a0a0a0;",e.appendChild(a),setTimeout(()=>{const l=e.querySelector("#plugin-url-input"),d=e.querySelector("#load-plugin-btn"),u=e.querySelector("#load-plugin-status");d&&this.registerListener(d,"click",async()=>{await this.handleLoadPlugin(l,u)}),l&&this.registerListener(l,"keypress",async g=>{g.key==="Enter"&&await this.handleLoadPlugin(l,u)})},0),e}async handleLoadPlugin(e,t){const n=e.value.trim();if(this.logger.log(`\u{1F4E5} User requested to load plugin from URL: ${n}`),!n){t.textContent="\u26A0\uFE0F Please enter a URL",t.style.color="#ffc107";return}t.textContent=`\u23F3 Loading plugin from ${n}...`,t.style.color="#007bff";try{this.logger.log("  \u2192 Adding plugin via PluginManager...");const s=await window.customjs.pluginManager.addPlugin(n);s.success?(t.textContent="\u2705 Plugin loaded successfully!",t.style.color="#28a745",e.value="",setTimeout(()=>this.refreshPluginGrid(),500)):(t.textContent=`\u274C Failed to load: ${s.message}`,t.style.color="#dc3545")}catch(s){t.textContent=`\u274C Error: ${s.message}`,t.style.color="#dc3545"}}refreshPluginGrid(){this.logger.log("\u{1F504} Refreshing plugin grid...");try{const e=this.pluginGridContainer;if(!e){this.logger.warn("Plugin grid container not available");return}e.innerHTML="";const t=window.customjs?.plugins||[],n=window.customjs?.core_modules||[],s=window.customjs?.pluginManager?.failedUrls||new Set,o=window.customjs?.repoManager;this.logger.log(`  \u2192 Loaded plugins: ${t.length}, Core modules: ${n.length}, Failed: ${s.size}`);const i=window.customjs?.configManager?.get("plugins")||{};let r=[];if(o)r=o.getAllPlugins().map(g=>{const p=t.find(c=>c.metadata.url===g.url);if(p)return{...p,metadata:{...g,...p.metadata}};{const c=i[g.url]!==void 0?i[g.url]:!1;return{metadata:g,enabled:c,loaded:!1,started:!1,_isStub:!0}}});else{const u=new Set(t.map(p=>p.metadata.url)),g=Object.entries(i).filter(([p,c])=>!c&&!u.has(p)).map(([p])=>this.createUnloadedPluginStub(p));r=[...t,...g]}const a=this.filterPlugins(r,n,s),l=document.createElement("h5");l.style.cssText="margin: 0 0 16px 0; font-size: 16px; font-weight: 600; color: #e0e0e0;",l.textContent=`\u{1F9E9} Plugins (${a.length})`,e.appendChild(l);const d=document.createElement("div");if(d.style.cssText="display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 16px; margin-bottom: 20px;",a.length===0){const u=document.createElement("div");u.style.cssText="padding: 40px; text-align: center; color: #909090;",u.textContent="No plugins meet the search criteria.",e.appendChild(u);return}a.forEach(u=>{d.appendChild(this.createPluginCard(u))}),e.appendChild(d),this.logger.log(`\u2713 Plugin grid refreshed - showing ${a.length} plugins (filter: ${this.searchValue.filter}, search: "${this.searchValue.value}")`)}catch(e){this.logger.error("Error refreshing plugin grid:",e)}}createUnloadedPluginStub(e){const t=e.split("/"),s=t[t.length-1].replace(/\.js$/,""),o=s.split("-").map(i=>i.charAt(0).toUpperCase()+i.slice(1)).join(" ");return{metadata:{id:s,name:o,description:"(Not loaded - enable to see details)",authors:[{name:"Unknown"}],build:"0",url:e,tags:[]},enabled:!1,loaded:!1,started:!1,_isStub:!0}}filterPlugins(e,t,n){const{value:s,filter:o}=this.searchValue;let i=[...e];if(o==="enabled")i=i.filter(r=>r.enabled);else if(o==="disabled")i=i.filter(r=>!r.enabled);else if(o==="core")i=[];else if(o==="failed")i=[];else if(o==="available"){const r=window.customjs?.repoManager;if(r){const a=new Set(e.map(d=>d.metadata.url));i=r.getAllPlugins().filter(d=>!a.has(d.url)).map(d=>({metadata:d,enabled:!1,loaded:!1,started:!1,_isAvailable:!0}))}else i=[]}return s&&(i=i.filter(r=>r.metadata.name.toLowerCase().includes(s)||r.metadata.description.toLowerCase().includes(s)||r.metadata.id.toLowerCase().includes(s)||r.metadata.tags?.some(a=>a.toLowerCase().includes(s)))),i.sort((r,a)=>r.metadata.name.localeCompare(a.metadata.name)),i}createPluginCard(e){const t=document.createElement("div");t.className="vc-plugin-card",t.style.cssText=`
      background: #2d2d2d;
      border: 2px solid ${e.enabled?"#28a745":"#5a5a5a"};
      border-radius: 6px;
      padding: 14px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.3);
      transition: all 0.2s;
      display: flex;
      flex-direction: column;
    `;const n=document.createElement("div");n.style.cssText="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;";const s=document.createElement("div");s.style.cssText="flex: 1; min-width: 0;";const o=document.createElement("div");o.style.cssText="font-size: 16px; font-weight: 600; color: #e8e8e8; margin-bottom: 4px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;",o.textContent=e.metadata?.name||"Unknown Plugin";const i=document.createElement("div");i.style.cssText="font-size: 11px; color: #909090; font-family: monospace;";const r=e.metadata?.authors?.[0]?.name?`by ${e.metadata.authors[0].name}`:"",a=e.metadata?.build?` \u2022 ${this.formatBuildDate(e.metadata.build)}`:"";let l="";if(e.metadata?.url){const c=window.customjs?.repoManager;if(c){const h=c.findPluginByUrl(e.metadata.url);h&&(l=` \u2022 \u{1F4E6} ${h.repo.data?.name||"Repository"}`)}}if(i.textContent=r+a+l,s.appendChild(o),s.appendChild(i),e._isAvailable){const c=document.createElement("button");c.className="el-button el-button--small el-button--success",c.innerHTML='<i class="ri-download-line"></i> Install',c.title="Install this plugin",this.registerListener(c,"click",async h=>{h.stopPropagation(),await this.handleInstallPlugin(e.metadata.url,c)}),n.appendChild(s),n.appendChild(c)}else{const c=document.createElement("label");c.className="el-switch",c.style.cssText="cursor: pointer; display: flex; align-items: center;";const h=document.createElement("input");h.type="checkbox",h.checked=e.enabled,h.style.display="none";const m=document.createElement("span");m.style.cssText=`
        display: inline-block;
        position: relative;
        width: 40px;
        height: 20px;
        border-radius: 10px;
        background: ${e.enabled?"#409eff":"#dcdfe6"};
        transition: background-color 0.3s;
        cursor: pointer;
      `;const x=document.createElement("span");x.style.cssText=`
        position: absolute;
        top: 1px;
        left: ${e.enabled?"21px":"1px"};
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background: white;
        transition: all 0.3s;
      `,m.appendChild(x),c.appendChild(h),c.appendChild(m),this.registerListener(c,"click",async y=>{y.stopPropagation(),await this.handleTogglePlugin(e.metadata.id)}),n.appendChild(s),n.appendChild(c)}const d=document.createElement("div");d.style.cssText="font-size: 13px; color: #b0b0b0; line-height: 1.4; margin-bottom: 12px; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;",d.textContent=e.metadata?.description||"No description available";const u=document.createElement("div");u.style.cssText="display: flex; gap: 4px; flex-wrap: wrap; margin-bottom: 8px;",e.metadata?.tags&&e.metadata.tags.length>0&&e.metadata.tags.forEach(c=>{const h=this.getTagColor(c),m=this.createBadge(c,h);u.appendChild(m)});let g=null;if(e.getActionButtons&&typeof e.getActionButtons=="function")try{const c=e.getActionButtons();c&&c.length>0&&(g=this.createCustomActionButtons(e,c))}catch(c){this.logger.error(`Error getting action buttons for ${e.metadata.id}:`,c)}const p=document.createElement("div");if(p.style.cssText="display: flex; gap: 8px; margin-top: auto; padding-top: 12px; border-top: 1px solid #404040;",e._isAvailable){const c=document.createElement("button");c.className="el-button el-button--small el-button--success",c.style.cssText="flex: 1;",c.innerHTML='<i class="ri-search-eye-line"></i> Plugin Details',c.title="Fetch Plugin Details",this.registerListener(c,"click",async h=>{h.stopPropagation(),await this.handleAnalyzePlugin(e.metadata.url)}),p.appendChild(c)}else{const c=document.createElement("button");c.className="el-button el-button--small el-button--info",c.style.cssText="flex: 1;",c.innerHTML='<i class="ri-restart-line"></i> Reload',this.registerListener(c,"click",async f=>{f.stopPropagation(),await this.handleReloadPlugin(e.metadata.url)});const h=e.settings?.def&&Object.keys(e.settings.def).length>0,m=document.createElement("button");m.className="el-button el-button--small el-button--success",m.innerHTML='<i class="ri-search-eye-line"></i>',m.title="Fetch Plugin Details",this.registerListener(m,"click",async f=>{f.stopPropagation(),await this.handleAnalyzePlugin(e.metadata.url)});const x=document.createElement("button");x.className="el-button el-button--small",x.innerHTML='<i class="ri-information-line"></i>',x.title="Plugin Details",this.registerListener(x,"click",f=>{f.stopPropagation(),this.handleShowDetails(e)});const y=document.createElement("button");if(y.className="el-button el-button--small el-button--danger",y.innerHTML='<i class="ri-delete-bin-line"></i>',y.title="Remove Plugin",this.registerListener(y,"click",async f=>{f.stopPropagation(),await this.handleRemovePlugin(e.metadata.url)}),p.appendChild(c),h){const f=document.createElement("button");f.className="el-button el-button--small el-button--primary",f.innerHTML='<i class="ri-settings-3-line"></i>',f.title="Plugin Settings",this.registerListener(f,"click",async T=>{T.stopPropagation(),await this.handleShowPluginSettings(e)}),p.appendChild(f)}p.appendChild(m),p.appendChild(x),p.appendChild(y)}return t.appendChild(n),t.appendChild(d),u.children.length>0&&t.appendChild(u),g&&t.appendChild(g),t.appendChild(p),this.registerListener(t,"mouseenter",()=>{t.style.boxShadow="0 4px 12px rgba(0,0,0,0.5)",t.style.transform="translateY(-2px)"}),this.registerListener(t,"mouseleave",()=>{t.style.boxShadow="0 2px 4px rgba(0,0,0,0.3)",t.style.transform="translateY(0)"}),t}createCustomActionButtons(e,t){const n=document.createElement("div");return n.style.cssText="display: flex; gap: 8px; margin-top: 8px; padding-top: 8px; border-top: 1px dashed #404040; flex-wrap: wrap;",t.forEach(s=>{try{const o=document.createElement("button"),i={primary:"el-button--primary",success:"el-button--success",warning:"el-button--warning",danger:"el-button--danger",info:"el-button--info"},r=i[s.color]||i.primary;o.className=`el-button el-button--small ${r}`,o.style.cssText="flex: 1;";let a="";s.icon&&(a+=`<i class="${s.icon}"></i> `),a+=s.label||"Action",o.innerHTML=a,s.title&&(o.title=s.title),s.callback&&typeof s.callback=="function"&&this.registerListener(o,"click",async l=>{l.stopPropagation();try{await s.callback()}catch(d){this.logger.error(`Error executing custom button callback for ${e.metadata.id}:`,d),this.logger.showError(`Button action failed: ${d.message}`)}}),n.appendChild(o)}catch(o){this.logger.error(`Error creating custom button for ${e.metadata.id}:`,o)}}),n}createBadge(e,t){const n=document.createElement("span");return n.style.cssText=`
      background: ${t};
      color: white;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 500;
    `,n.textContent=e,n}getTagColor(e){let t=0;for(let i=0;i<e.length;i++)t=e.charCodeAt(i)+((t<<5)-t),t=t&t;const n=Math.abs(t%360),s=65+Math.abs(t>>8)%11,o=45+Math.abs(t>>16)%11;return`hsl(${n}, ${s}%, ${o}%)`}createFailedSection(e){const t=document.createElement("div");t.style.cssText="margin-bottom: 30px;";const n=document.createElement("h3");n.style.cssText=`
      margin: 0 0 15px 0;
      font-size: 20px;
      font-weight: 600;
      display: flex;
      align-items: center;
      color: #dc3545;
    `,n.innerHTML=`<i class="ri-error-warning-line" style="margin-right: 8px;"></i>Failed to Load (${e.length})`,t.appendChild(n);const s=document.createElement("div");return s.style.cssText="display: flex; flex-direction: column; gap: 10px;",e.forEach(o=>{const i=document.createElement("div");i.style.cssText=`
        background: #fff5f5;
        border: 1px solid #fecaca;
        border-radius: 8px;
        padding: 12px 15px;
        font-size: 13px;
        font-family: 'Consolas', monospace;
        color: #dc3545;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        justify-content: space-between;
        align-items: center;
      `;const r=document.createElement("span");r.textContent=o,r.style.flex="1";const a=document.createElement("button");a.className="el-button el-button--small el-button--danger",a.innerHTML='<i class="ri-restart-line"></i> Retry',i.appendChild(r),i.appendChild(a),this.registerListener(i,"mouseenter",()=>{i.style.background="#ffe6e6"}),this.registerListener(i,"mouseleave",()=>{i.style.background="#fff5f5"}),this.registerListener(r,"click",()=>{this.utils&&this.utils.copyToClipboard(o,"Failed plugin URL")}),this.registerListener(a,"click",async l=>{l.stopPropagation(),await this.handleRetryFailedPlugin(o)}),s.appendChild(i)}),t.appendChild(s),t}async handleTogglePlugin(e){if(this.logger.log(`\u{1F518} User clicked toggle for plugin: ${e}`),this.togglingPlugins.has(e)){this.logger.warn(`Plugin ${e} is already being toggled, ignoring duplicate request`);return}this.togglingPlugins.add(e);try{const t=window.customjs.pluginManager.getPlugin(e);if(!t){const s=window.customjs.pluginManager.getPluginConfig(),o=Object.keys(s).find(r=>{const a=r.split("/");return a[a.length-1].replace(/\.js$/,"")===e});if(!o){this.logger.error(`Plugin URL not found for: ${e}`),this.logger.showError(`Plugin URL not found: ${e}`);return}this.logger.log(`Enabling disabled plugin ${e} from ${o}`),this.logger.showInfo("Enabling plugin..."),s[o]=!0,window.customjs.pluginManager.savePluginConfig(s);const i=await window.customjs.pluginManager.reloadPlugin(o);i.success?(this.logger.log(`Plugin ${e} enabled and loaded`),this.logger.showSuccess("Plugin enabled successfully")):(this.logger.error(`Failed to load plugin: ${i.message}`),this.logger.showError(`Failed to load plugin: ${i.message}`)),setTimeout(()=>this.refreshPluginGrid(),500);return}if(await t.toggle(),this.logger.log(`Toggled plugin ${e}: ${t.enabled?"enabled":"disabled"}`),t.metadata.url&&window.customjs.pluginManager){const s=window.customjs.pluginManager.getPluginConfig();s[t.metadata.url]=t.enabled,window.customjs.pluginManager.savePluginConfig(s)}const n=t.enabled?"enabled":"disabled";this.logger.showSuccess(`${t.metadata.name} ${n}`),setTimeout(()=>this.refreshPluginGrid(),200)}catch(t){this.logger.error(`Error toggling plugin ${e}:`,t),this.logger.showError(`Error: ${t.message}`)}finally{setTimeout(()=>{this.togglingPlugins.delete(e)},500)}}async handleReloadPlugin(e){if(this.logger.log(`\u{1F504} User clicked reload for plugin: ${e}`),!e){this.logger.warn("No URL available for reload"),this.logger.showWarn("Plugin URL not available");return}try{this.logger.log(`  \u2192 Reloading plugin from ${e}`),this.logger.showInfo("Reloading plugin...");const t=window.customjs.pluginManager.getPluginConfig();t[e]===!1&&(this.logger.log("Plugin is disabled, enabling before reload"),t[e]=!0,window.customjs.pluginManager.savePluginConfig(t));const n=await window.customjs.pluginManager.reloadPlugin(e);n.success?(this.logger.log("Plugin reloaded successfully"),this.logger.showSuccess("Plugin reloaded successfully"),setTimeout(()=>this.refreshPluginGrid(),500)):(this.logger.error(`Reload failed: ${n.message}`),this.logger.showError(`Reload failed: ${n.message}`))}catch(t){this.logger.error("Error reloading plugin:",t),this.logger.showError(`Error: ${t.message}`)}}async handleAnalyzePlugin(e){if(this.logger.log(`\u{1F50D} User clicked analyze for plugin: ${e}`),!e){this.logger.warn("No URL available for analysis"),this.logger.showWarn("Plugin URL not available");return}try{this.logger.log(`  \u2192 Analyzing plugin: ${e}`),this.logger.showInfo("Analyzing plugin code...");const t=window.customjs?.pluginManager?.loader;if(!t||!t.extractPluginMetadata){this.logger.error("PluginLoader.extractPluginMetadata not available"),this.logger.showError("Analysis feature not available");return}const n=await t.extractPluginMetadata(e,!0);n?(this.logger.log("Plugin analysis complete",n),this.showAnalysisDialog(n)):(this.logger.error("Failed to extract metadata"),this.logger.showError("Failed to analyze plugin"))}catch(t){this.logger.error("Error analyzing plugin:",t),this.logger.showError(`Analysis error: ${t.message}`)}}showAnalysisDialog(e){const t=document.createElement("div");t.className="el-overlay",t.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      z-index: 9999;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    `;const n=document.createElement("div");n.style.cssText=`
      background: #2d2d2d;
      border-radius: 8px;
      max-width: 900px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
    `;const s=document.createElement("div");s.style.cssText=`
      padding: 20px;
      border-bottom: 1px solid #404040;
      display: flex;
      justify-content: space-between;
      align-items: center;
    `;const o=document.createElement("h3");o.style.cssText="margin: 0; color: #e0e0e0; font-size: 18px;",o.textContent=`Plugin Analysis: ${e.name||"Unknown"}`;const i=document.createElement("button");i.className="el-button el-button--small",i.innerHTML='<i class="ri-close-line"></i>',i.style.cssText="cursor: pointer;",this.registerListener(i,"click",()=>{t.remove()}),s.appendChild(o),s.appendChild(i);const r=document.createElement("div");r.style.cssText="padding: 20px;";const a=[{title:"Basic Information",data:{Name:e.name,Description:e.description,Authors:e.authors?.map(l=>l.name).join(", ")||"Unknown",Build:e.build,"Class Name":e.className,URL:e.url}},{title:"Code Metrics",data:{Size:e.sizeFormatted,"Line Count":e.lineCount,"Function Count":e.functionCount,"Event Handlers":e.eventHandlerCount}},{title:"Settings",data:{"Settings Count":e.settingsCount,"Categories Count":e.categoriesCount}},{title:"Resource Registrations",data:{Observers:e.observerCount,Listeners:e.listenerCount,Subscriptions:e.subscriptionCount,Hooks:e.hookCount,Timers:e.timerCount}},{title:"Lifecycle Methods",data:{"Has load()":e.lifecycle?.hasLoad?"\u2713":"\u2717","Has start()":e.lifecycle?.hasStart?"\u2713":"\u2717","Has stop()":e.lifecycle?.hasStop?"\u2713":"\u2717","Has onLogin()":e.lifecycle?.hasOnLogin?"\u2713":"\u2717"}},{title:"External APIs",data:{AppApi:e.externalApis?.usesAppApi?"\u2713":"\u2717",Pinia:e.externalApis?.usesPinia?"\u2713":"\u2717","Vue Router":e.externalApis?.usesVueRouter?"\u2713":"\u2717","VRCX API":e.externalApis?.usesVRCXAPI?"\u2713":"\u2717","Web API":e.externalApis?.usesWebAPI?"\u2713":"\u2717"}},{title:"Resource Usage",data:{"Creates DOM":e.resourceUsage?.createsDomElements?"\u2713":"\u2717","Modifies DOM":e.resourceUsage?.modifiesDom?"\u2713":"\u2717",localStorage:e.resourceUsage?.usesLocalStorage?"\u2713":"\u2717",sessionStorage:e.resourceUsage?.usesSessionStorage?"\u2713":"\u2717",WebSocket:e.resourceUsage?.usesWebSocket?"\u2713":"\u2717"}}];if(e.tags&&e.tags.length>0&&a.push({title:"Tags",data:{Tags:e.tags.join(", ")}}),e.dependencies&&e.dependencies.length>0&&a.push({title:"Dependencies",data:{Count:e.dependencies.length}}),a.forEach(l=>{const d=this.createAnalysisSection(l.title,l.data);r.appendChild(d)}),e.sourceCode){const l=document.createElement("div");l.style.cssText="margin-top: 20px;";const d=document.createElement("h4");d.style.cssText="margin: 0 0 10px 0; color: #409eff; font-size: 14px; text-transform: uppercase;",d.textContent="Source Code";const u=document.createElement("pre");u.style.cssText=`
        background: #1e1e1e;
        padding: 15px;
        border-radius: 4px;
        overflow-x: auto;
        max-height: 400px;
        font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
        font-size: 12px;
        color: #d4d4d4;
        line-height: 1.5;
      `,u.textContent=e.sourceCode,l.appendChild(d),l.appendChild(u),r.appendChild(l)}n.appendChild(s),n.appendChild(r),t.appendChild(n),this.registerListener(t,"click",l=>{l.target===t&&t.remove()}),document.body.appendChild(t),this.logger.showSuccess("Analysis complete")}createAnalysisSection(e,t){const n=document.createElement("div");n.style.cssText="margin-bottom: 15px;";const s=document.createElement("h4");s.style.cssText="margin: 0 0 8px 0; color: #409eff; font-size: 14px; text-transform: uppercase;",s.textContent=e;const o=document.createElement("div");return o.style.cssText=`
      display: grid;
      grid-template-columns: 200px 1fr;
      gap: 8px;
      font-size: 13px;
    `,Object.entries(t).forEach(([i,r])=>{if(r==null)return;const a=document.createElement("div");a.style.cssText="color: #909090; font-weight: 500;",a.textContent=i+":";const l=document.createElement("div");l.style.cssText="color: #e0e0e0;",l.textContent=String(r),o.appendChild(a),o.appendChild(l)}),n.appendChild(s),n.appendChild(o),n}handleShowDetails(e){this.logger.log(`\u2139\uFE0F User clicked info for plugin: ${e.metadata.id}`),this.logger.log("  \u2192 Plugin details:",e),window.AppApi?.ShowDevTools&&window.AppApi.ShowDevTools()}async handleShowPluginSettings(e){this.logger.log(`\u2699\uFE0F User clicked settings for plugin: ${e.metadata.id}`),e.settings?.def&&Object.keys(e.settings.def).length>0?(this.logger.log(`  \u2192 Opening settings modal (${Object.keys(e.settings.def).length} settings)`),this.showSettingsModal(e)):(this.logger.log("  \u2192 Plugin has no configurable settings"),this.logger.showInfo(`${e.metadata.name} has no configurable settings`))}async handleRemovePlugin(e){if(this.logger.log(`\u{1F5D1}\uFE0F User clicked remove for plugin: ${e}`),!e){this.logger.warn("No URL available for removal"),this.logger.showWarn("Plugin URL not available");return}if(!confirm(`Are you sure you want to remove this plugin?

Note: Code will remain in memory until VRCX restart.`)){this.logger.log("  \u2192 User cancelled removal");return}try{this.logger.log(`  \u2192 Removing plugin from ${e}`);const t=await window.customjs.pluginManager.removePlugin(e);t.success?(this.logger.log("Plugin removed successfully"),this.logger.showSuccess("Plugin removed (restart VRCX to fully unload)"),setTimeout(()=>this.refreshPluginGrid(),500)):(this.logger.error(`Removal failed: ${t.message}`),this.logger.showError(`Removal failed: ${t.message}`))}catch(t){this.logger.error("Error removing plugin:",t),this.logger.showError(`Error: ${t.message}`)}}async handleInstallPlugin(e,t){if(this.logger.log(`\u{1F4E5} User clicked install for plugin: ${e}`),!e){this.logger.showWarn("No URL available for installation");return}const n=t.innerHTML;try{t.disabled=!0,t.innerHTML='<i class="ri-loader-4-line ri-spin"></i> Installing...',this.logger.log(`  \u2192 Installing plugin from ${e}`);const s=await window.customjs.pluginManager.addPlugin(e);s.success?(t.innerHTML='<i class="ri-check-line"></i> Installed!',t.className="el-button el-button--small el-button--success",this.logger.showSuccess("Plugin installed successfully"),setTimeout(()=>{this.refreshPluginGrid()},1e3)):(t.innerHTML='<i class="ri-error-warning-line"></i> Failed',t.className="el-button el-button--small el-button--danger",this.logger.showError(`Installation failed: ${s.message}`),setTimeout(()=>{t.innerHTML=n,t.className="el-button el-button--small el-button--success",t.disabled=!1},2e3))}catch(s){this.logger.error("Error installing plugin:",s),this.logger.showError(`Error: ${s.message}`),t.innerHTML=n,t.className="el-button el-button--small el-button--success",t.disabled=!1}}async handleRetryFailedPlugin(e){try{this.logger.log(`Retrying failed plugin: ${e}`),this.logger.showInfo("Retrying plugin load..."),window.customjs.pluginManager.failedUrls.delete(e);const t=await window.customjs.pluginManager.addPlugin(e);t.success?(this.logger.showSuccess("Plugin loaded successfully!"),setTimeout(()=>this.refreshPluginGrid(),500)):this.logger.showError(`Failed again: ${t.message}`)}catch(t){this.logger.error("Error retrying plugin:",t),this.logger.showError(`Error: ${t.message}`)}}showSettingsModal(e){this.settingsModal&&(this.settingsModal.remove(),this.settingsModal=null);const t=document.createElement("div");t.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      backdrop-filter: blur(2px);
    `;const n=document.createElement("div");n.style.cssText=`
      background: #2d2d2d;
      border-radius: 12px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
      width: 90%;
      max-width: 700px;
      max-height: 80vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    `;const s=document.createElement("div");s.style.cssText=`
      padding: 20px 25px;
      border-bottom: 1px solid #404040;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    `,s.innerHTML=`
      <h3 style="margin: 0; font-size: 20px; font-weight: 600;">
        <i class="ri-settings-3-line"></i> ${e.metadata.name} Settings
      </h3>
      <p style="margin: 5px 0 0 0; font-size: 13px; opacity: 0.9;">
        Configure plugin settings \u2022 Changes are saved automatically
      </p>
    `;const o=document.createElement("div");o.style.cssText=`
      flex: 1;
      overflow-y: auto;
      padding: 20px 25px;
    `,o.appendChild(this.buildSettingsUI(e));const i=document.createElement("div");i.style.cssText=`
      padding: 15px 25px;
      border-top: 1px solid #404040;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #252525;
    `;const r=document.createElement("span");r.style.cssText="font-size: 12px; color: #b0b0b0;",r.textContent="Settings are automatically saved";const a=document.createElement("div");a.style.cssText="display: flex; gap: 10px;";const l=document.createElement("button");l.className="el-button el-button--small el-button--warning",l.innerHTML='<i class="ri-restart-line"></i> Reset to Defaults';const d=document.createElement("button");d.className="el-button el-button--small el-button--primary",d.innerHTML='<i class="ri-close-line"></i> Close',a.appendChild(l),a.appendChild(d),i.appendChild(r),i.appendChild(a),n.appendChild(s),n.appendChild(o),n.appendChild(i),t.appendChild(n),this.registerListener(d,"click",()=>{t.remove(),this.settingsModal=null}),this.registerListener(l,"click",async()=>{confirm(`Reset all settings for "${e.metadata.name}" to their default values?`)&&(e.settings?.resetAll?e.settings.resetAll():e.clearAllSettings(),this.logger.showSuccess("Settings reset to defaults"),o.innerHTML="",o.appendChild(this.buildSettingsUI(e)))}),this.registerListener(t,"click",u=>{u.target===t&&(t.remove(),this.settingsModal=null)}),document.body.appendChild(t),this.settingsModal=t}buildSettingsUI(e){const t=document.createElement("div");if(t.style.cssText="padding: 12px 0;",e.settings?.def&&Object.keys(e.settings.def).length>0){const i=e.settings.def,r={};for(const d in i)i[d].hidden||(r[d]=i[d]);if(Object.keys(r).length===0){const d=document.createElement("div");d.style.cssText="text-align: center; padding: 20px; color: #909090;";const u=document.createElement("i");u.className="ri-inbox-line",u.style.cssText="font-size: 32px; opacity: 0.5; display: block; margin-bottom: 8px; color: #909090;";const g=document.createElement("p");return g.style.cssText="margin: 0; font-size: 13px; color: #b0b0b0;",g.textContent="This plugin has no configurable settings",d.appendChild(u),d.appendChild(g),t.appendChild(d),t}const a={};for(const d in r){const u=r[d].category||"general";a[u]||(a[u]={}),a[u][d]=r[d]}const l=e.categories||{};return Object.entries(a).forEach(([d,u])=>{const g=document.createElement("div");g.style.cssText="margin-bottom: 20px;";const p=document.createElement("div");p.style.cssText=`
          margin-bottom: 12px;
          padding-bottom: 8px;
          border-bottom: 2px solid #404040;
        `;const c=document.createElement("h4");if(c.style.cssText=`
          margin: 0;
          font-size: 15px;
          font-weight: 600;
          color: #e0e0e0;
        `,c.textContent=l[d]?.name||this.formatCategoryName(d),p.appendChild(c),l[d]?.description){const h=document.createElement("p");h.style.cssText=`
            margin: 4px 0 0 0;
            font-size: 12px;
            color: #b0b0b0;
          `,h.textContent=l[d].description,p.appendChild(h)}g.appendChild(p),Object.entries(u).forEach(([h,m])=>{const x=this.createSettingRow(e,h,m);g.appendChild(x)}),t.appendChild(g)}),t}const n=document.createElement("div");n.style.cssText="text-align: center; padding: 20px; color: #909090;";const s=document.createElement("i");s.className="ri-inbox-line",s.style.cssText="font-size: 32px; opacity: 0.5; display: block; margin-bottom: 8px; color: #909090;";const o=document.createElement("p");return o.style.cssText="margin: 0; font-size: 13px; color: #b0b0b0;",o.textContent="This plugin has no configurable settings",n.appendChild(s),n.appendChild(o),t.appendChild(n),t}createSettingRow(e,t,n){const s=document.createElement("div");s.style.cssText="margin-bottom: 8px;";const o=document.createElement("div");o.style.cssText=`
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 12px;
      background: #353535;
      border-radius: 6px;
      border: 1px solid #4a4a4a;
    `;const i=document.createElement("div");i.style.cssText="flex: 1; min-width: 0; margin-right: 12px;";const r=document.createElement("div");r.style.cssText="font-size: 13px; font-weight: 500; color: #e8e8e8; margin-bottom: 2px;",r.textContent=n.description||t,i.appendChild(r);const a=document.createElement("div");a.style.cssText="min-width: 140px; display: flex; justify-content: flex-end;";const l=this.createInputForSetting(e,t,n);if(a.appendChild(l),o.appendChild(i),o.appendChild(a),s.appendChild(o),n.variables&&Object.keys(n.variables).length>0){const d=this.createVariablesDisplay(n.variables);s.appendChild(d)}return s}createVariablesDisplay(e){const t=document.createElement("div");t.style.cssText=`
      margin-top: 4px;
      padding: 8px 12px;
      background: #2a2a2a;
      border-radius: 4px;
      border-left: 3px solid #409eff;
    `;const n=document.createElement("div");n.style.cssText=`
      font-size: 11px;
      font-weight: 600;
      color: #409eff;
      margin-bottom: 6px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    `,n.textContent="Available Variables";const s=document.createElement("div");return s.style.cssText=`
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 4px;
      font-size: 11px;
    `,Object.entries(e).forEach(([o,i])=>{const r=document.createElement("div");r.style.cssText=`
        display: flex;
        align-items: baseline;
        gap: 6px;
        padding: 2px 0;
      `;const a=document.createElement("code");a.style.cssText=`
        color: #67c23a;
        background: #1e1e1e;
        padding: 2px 6px;
        border-radius: 3px;
        font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
        font-size: 10px;
        white-space: nowrap;
        cursor: pointer;
        border: 1px solid #3a3a3a;
      `,a.textContent=o,a.title="Click to copy",this.registerListener(a,"click",()=>{if(this.utils){this.utils.copyToClipboard(o);const d=a.style.background;a.style.background="#67c23a",setTimeout(()=>{a.style.background=d},200)}});const l=document.createElement("span");l.style.cssText="color: #909090; flex: 1;",l.textContent=i,r.appendChild(a),r.appendChild(l),s.appendChild(r)}),t.appendChild(n),t.appendChild(s),t}createInputForSetting(e,t,n){const s=e.settings.store[t],o=window.customjs.SettingType;switch(n.type){case o.BOOLEAN:return this.createBooleanInput(e,t,s);case o.NUMBER:case o.BIGINT:return this.createNumberInput(e,t,s);case o.STRING:return this.createStringInput(e,t,s,n.placeholder);case o.SELECT:return this.createSelectInput(e,t,s,n.options||[]);case o.SLIDER:return this.createSliderInput(e,t,s,n.markers||[]);case o.CUSTOM:return this.createCustomInput(e,t,s);default:const i=document.createElement("span");return i.style.cssText="color: #f56c6c; font-size: 12px;",i.textContent=`Unsupported type: ${n.type}`,i}}createBooleanInput(e,t,n){const s=document.createElement("label");s.className="el-switch",s.style.cssText="cursor: pointer; display: flex; align-items: center;";const o=document.createElement("input");o.type="checkbox",o.checked=n,o.style.display="none";const i=document.createElement("span");i.style.cssText=`
      display: inline-block;
      position: relative;
      width: 40px;
      height: 20px;
      border-radius: 10px;
      background: ${n?"#409eff":"#dcdfe6"};
      transition: background-color 0.3s;
      cursor: pointer;
    `;const r=document.createElement("span");return r.style.cssText=`
      position: absolute;
      top: 1px;
      left: ${n?"21px":"1px"};
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: white;
      transition: all 0.3s;
      cursor: pointer;
    `,i.appendChild(r),s.appendChild(o),s.appendChild(i),this.registerListener(s,"click",a=>{a.stopPropagation();try{const l=!o.checked;e.settings.store[t]=l,o.checked=l,i.style.background=l?"#409eff":"#dcdfe6",r.style.left=l?"21px":"1px",this.logger.log(`Setting ${t} changed to ${l} (old: ${!l})`)}catch(l){this.logger.error(`Error toggling ${t}:`,l)}}),s}createNumberInput(e,t,n){const s=document.createElement("input");return s.type="number",s.className="el-input__inner",s.value=n??"",s.style.cssText="width: 100%; padding: 6px 10px; border: 1px solid #5a5a5a; border-radius: 4px; font-size: 13px; background: #1e1e1e; color: #e0e0e0;",this.registerListener(s,"change",o=>{try{const i=parseFloat(s.value);isNaN(i)||(e.settings.store[t]=i,this.logger.log(`Setting ${t} changed to ${i}`))}catch(i){this.logger.error(`Error updating ${t}:`,i)}}),s}createStringInput(e,t,n,s){const o=n||"";if(o.includes(`
`))return this.createMultilineTextarea(e,t,o,{placeholder:s,maxLines:30,minLines:3,validateJson:!1});const r=document.createElement("input");return r.type="text",r.className="el-input__inner",r.value=o,r.placeholder=s||"",r.style.cssText="width: 100%; padding: 6px 10px; border: 1px solid #5a5a5a; border-radius: 4px; font-size: 13px; background: #1e1e1e; color: #e0e0e0;",this.registerListener(r,"change",a=>{try{e.settings.store[t]=r.value,this.logger.log(`Setting ${t} changed to "${r.value}"`)}catch(l){this.logger.error(`Error updating ${t}:`,l)}}),r}createMultilineTextarea(e,t,n,s={}){const{placeholder:o="",maxLines:i=30,minLines:r=3,validateJson:a=!1}=s,l=document.createElement("div");l.style.cssText="width: 100%;";const d=a?JSON.stringify(n,null,2):n||"",u=Math.min((d.match(/\n/g)||[]).length+1,i),g=document.createElement("textarea");g.className="el-textarea__inner",g.value=d,g.placeholder=o,g.rows=Math.max(u,r),g.style.cssText=`
      width: 100%;
      padding: 8px 10px;
      border: 1px solid #5a5a5a;
      border-radius: 4px;
      font-size: 13px;
      font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
      background: #1e1e1e;
      color: #e0e0e0;
      resize: vertical;
      min-height: ${r*20}px;
      max-height: ${i*20}px;
      line-height: 1.5;
    `;let p,c;return a&&(p=document.createElement("div"),p.style.cssText=`
        font-size: 11px;
        color: #f56c6c;
        margin-top: 4px;
        display: none;
      `,c=document.createElement("div"),c.style.cssText=`
        font-size: 11px;
        color: #67c23a;
        margin-top: 4px;
        display: none;
      `),this.registerListener(g,"input",()=>{const h=Math.min((g.value.match(/\n/g)||[]).length+1,i);g.rows=Math.max(h,r),a&&p&&c&&(p.style.display="none",c.style.display="none")}),this.registerListener(g,"focus",()=>{g.style.borderColor="#409eff"}),this.registerListener(g,"blur",()=>{if(g.style.borderColor="#5a5a5a",a)try{const h=JSON.parse(g.value);e.settings.store[t]=h,c&&(c.textContent="\u2713 Valid JSON saved",c.style.display="block"),p&&(p.style.display="none");const m=JSON.stringify(h,null,2);g.value=m;const x=Math.min((m.match(/\n/g)||[]).length+1,i);g.rows=Math.max(x,r),setTimeout(()=>{c&&(c.style.display="none")},2e3)}catch(h){p&&(p.textContent=`\u2717 Invalid JSON: ${h.message}`,p.style.display="block"),c&&(c.style.display="none"),g.style.borderColor="#f56c6c"}else try{e.settings.store[t]=g.value,this.logger.log(`Setting ${t} updated (multiline)`)}catch(h){this.logger.error(`Error updating ${t}:`,h)}}),l.appendChild(g),a&&p&&c&&(l.appendChild(p),l.appendChild(c)),l}createSelectInput(e,t,n,s){const o=document.createElement("select");return o.className="el-select",o.style.cssText="padding: 6px 28px 6px 10px; border: 1px solid #5a5a5a; border-radius: 4px; font-size: 13px; background: #1e1e1e; color: #e0e0e0; cursor: pointer;",s.forEach(i=>{const r=document.createElement("option");r.value=i.value,r.textContent=i.label||i.value,(i.value===n||i.default)&&(r.selected=!0),o.appendChild(r)}),this.registerListener(o,"change",i=>{try{e.settings.store[t]=o.value,this.logger.log(`Setting ${t} changed to "${o.value}"`)}catch(r){this.logger.error(`Error updating ${t}:`,r)}}),o}createSliderInput(e,t,n,s){const o=document.createElement("div");o.style.cssText="width: 100%; min-width: 120px;";const i=document.createElement("input");i.type="range",i.min=s[0]??0,i.max=s[s.length-1]??1,i.step=s.length>1?s[1]-s[0]:.1,i.value=n??s[0]??0,i.style.cssText="width: 100%; cursor: pointer;";const r=document.createElement("div");return r.style.cssText="text-align: center; font-size: 12px; color: #b0b0b0; margin-top: 4px;",r.textContent=i.value,this.registerListener(i,"input",a=>{try{r.textContent=i.value,e.settings.store[t]=parseFloat(i.value),this.logger.log(`Setting ${t} changed to ${i.value}`)}catch(l){this.logger.error(`Error updating ${t}:`,l)}}),o.appendChild(i),o.appendChild(r),o}createCustomInput(e,t,n){return this.createMultilineTextarea(e,t,n,{placeholder:"",maxLines:50,minLines:2,validateJson:!0})}formatBuildDate(e){if(!e)return"Unknown";try{let t=typeof e=="string"?parseInt(e,10):e;if(isNaN(t))return e.toString();t.toString().length===10&&(t=t*1e3);const n=new Date(t),s=n.getFullYear();if(isNaN(n.getTime())||s<2020||s>2050||n.getTime()<0)return e.toString();const o={year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"};return n.toLocaleString("en-US",o)}catch{return e.toString()}}formatCategoryName(e){return e.replace(/([A-Z])/g," $1").replace(/_/g," ").replace(/^./,t=>t.toUpperCase()).trim()}formatSettingName(e){return e.replace(/([A-Z])/g," $1").replace(/_/g," ").replace(/^./,t=>t.toUpperCase()).trim()}inferType(e){return e==null?"string":typeof e=="boolean"?"boolean":typeof e=="number"?"number":Array.isArray(e)?"array":typeof e=="object"?"object":"string"}};C(w,"PluginManagerUIPlugin");let b=w;window.customjs.__LAST_PLUGIN_CLASS__=b;})();
