(()=>{var n=Object.defineProperty;var d=(i,t)=>n(i,"name",{value:t,configurable:!0});const l=class l extends CustomModule{constructor(){super({name:"Tag API \u{1F3F7}\uFE0F",description:"Provides custom tag API for users and worlds",authors:[{name:"Bluscream",description:"VRCX Plugin System Maintainer",userId:"usr_08082729-592d-4098-9a21-83c8dd37a844"}],tags:["API","Enhancement"],required_dependencies:["dialog-events-api"]}),this.customWorldTags=new Map}async load(){this.registerEvent("world-tag-added",{description:"Fired when a custom world tag is added",payload:{worldId:"string - World ID",tag:"string - Tag text",color:"string - Tag color",timestamp:"number - Unix timestamp"},broadcastIPC:!1,logToConsole:!1}),this.loaded=!0,this.logger.log("Tag API plugin loaded")}async start(){this.patchWorldStore(),this.setupWorldDialogWatcher(),this.enabled=!0,this.started=!0,this.logger.log("Tag API started")}patchWorldStore(){const t=window.$pinia?.world;if(!t){this.logger.warn("World store not available");return}const o=this;t.addCustomWorldTag=function(r){!r||!r.WorldId||(o.customWorldTags.set(r.WorldId,{tag:r.Tag||"",colour:r.TagColour||"#FF0000",timestamp:Date.now()}),o.emit("world-tag-added",{worldId:r.WorldId,tag:r.Tag,color:r.TagColour,timestamp:Date.now()}))},t.getCustomWorldTag=function(r){return o.customWorldTags.get(r)},t.removeCustomWorldTag=function(r){return o.customWorldTags.delete(r)},t.getAllCustomWorldTags=function(){return Array.from(o.customWorldTags.entries()).map(([r,s])=>({worldId:r,...s}))},this.logger.log("World store patched with custom tag support")}setupWorldDialogWatcher(){this.on("ShowWorldDialog",t=>{t?.worldId&&setTimeout(()=>this.injectCustomWorldTag(t.worldId),100)}),this.logger.log("World dialog watcher setup")}injectCustomWorldTag(t){const o=this.customWorldTags.get(t);if(!o)return;const r=document.querySelectorAll(".el-dialog__body > div > div > div");if(r.length<2)return;const s=r[1];if(s.querySelector(".vrcx-custom-world-tag"))return;const e=document.createElement("span");e.className="el-tag el-tag--danger el-tag--plain el-tag--small vrcx-custom-world-tag",e.style.marginRight="5px",e.style.marginTop="5px",e.style.color=o.colour,e.style.borderColor=o.colour,e.textContent=o.tag,s.firstChild?s.insertBefore(e,s.firstChild):s.appendChild(e)}addWorldTag(t,o,r="#FF0000"){const s=window.$pinia?.world;if(!s||!s.addCustomWorldTag)return this.logger.error("World store not available or not patched"),!1;try{return s.addCustomWorldTag({WorldId:t,Tag:o,TagColour:r}),!0}catch(e){const g=e instanceof Error?e.message:String(e);return this.logger.error(`Failed to add world tag: ${g}`),!1}}getWorldTag(t){return this.customWorldTags.get(t)}removeWorldTag(t){return this.customWorldTags.delete(t)}getAllWorldTags(){return Array.from(this.customWorldTags.entries()).map(([t,o])=>({worldId:t,tag:o.tag,colour:o.colour,timestamp:o.timestamp}))}clearAllWorldTags(){this.customWorldTags.clear(),this.logger.log("All custom world tags cleared")}async stop(){await super.stop(),this.logger.log("Tag API stopped")}};d(l,"TagAPIPlugin");let a=l;window.customjs.__LAST_PLUGIN_CLASS__=a;})();
