(()=>{var c=Object.defineProperty;var n=(d,e)=>c(d,"name",{value:e,configurable:!0});const i=class i extends CustomModule{constructor(){super({name:"Tag API \u{1F3F7}\uFE0F",description:"Provides custom tag API for users and worlds",authors:[{name:"Bluscream",description:"VRCX Plugin System Maintainer",userId:"usr_08082729-592d-4098-9a21-83c8dd37a844"}],tags:["API","Enhancement"],required_dependencies:["dialog-events-api"]}),this.customWorldTags=new Map,this.customUserTags=new Map}async load(){this.registerEvent("world-tag-added",{description:"Fired when a custom world tag is added",payload:{worldId:"string - World ID",tag:"string - Tag text",color:"string - Tag color",timestamp:"number - Unix timestamp"},broadcastIPC:!1,logToConsole:!1}),this.registerEvent("user-tag-added",{description:"Fired when a custom user tag is added",payload:{userId:"string - User ID",tag:"string - Tag text",color:"string - Tag color",timestamp:"number - Unix timestamp"},broadcastIPC:!1,logToConsole:!1}),this.loaded=!0,this.logger.log("Tag API plugin loaded")}async start(){this.patchWorldStore(),this.patchUserStore(),this.setupWorldDialogWatcher(),this.setupUserDialogWatcher(),this.enabled=!0,this.started=!0,this.logger.log("Tag API started")}patchWorldStore(){const e=window.$pinia?.world;if(!e){this.logger.warn("World store not available");return}const r=this;e.addCustomWorldTag=function(t){!t||!t.WorldId||(r.customWorldTags.set(t.WorldId,{tag:t.Tag||"",colour:t.TagColour||"#FF0000",timestamp:Date.now()}),r.emit("world-tag-added",{worldId:t.WorldId,tag:t.Tag,color:t.TagColour,timestamp:Date.now()}))},e.getCustomWorldTag=function(t){return r.customWorldTags.get(t)},e.removeCustomWorldTag=function(t){return r.customWorldTags.delete(t)},e.getAllCustomWorldTags=function(){return Array.from(r.customWorldTags.entries()).map(([t,s])=>({worldId:t,...s}))},this.logger.log("World store patched with custom tag support")}patchUserStore(){const e=window.$pinia?.user;if(!e){this.logger.warn("User store not available");return}const r=this;e.addCustomUserTag=function(t){if(!t||!t.UserId)return;const s=t.UserId,o={tag:t.Tag||"",colour:t.TagColour||"#FF00C6",timestamp:Date.now()},a=r.customUserTags.get(s)||[];a.some(u=>u.tag===o.tag)||(a.push(o),r.customUserTags.set(s,a),r.emit("user-tag-added",{userId:s,tag:o.tag,color:o.colour,timestamp:Date.now()}))},e.getCustomUserTags=function(t){return r.customUserTags.get(t)||[]},e.removeCustomUserTag=function(t,s){const o=r.customUserTags.get(t);if(!o)return!1;const a=o.filter(g=>g.tag!==s);return a.length===0?r.customUserTags.delete(t):r.customUserTags.set(t,a),!0},e.getAllCustomUserTags=function(){return Array.from(r.customUserTags.entries()).map(([t,s])=>({userId:t,tags:s}))},this.logger.log("User store patched with custom tag support")}setupWorldDialogWatcher(){this.on("ShowWorldDialog",e=>{e?.worldId&&setTimeout(()=>this.injectCustomWorldTag(e.worldId),100)}),this.logger.log("World dialog watcher setup")}setupUserDialogWatcher(){this.on("ShowUserDialog",e=>{e?.userId&&setTimeout(()=>this.injectCustomUserTags(e.userId),100)}),this.logger.log("User dialog watcher setup")}injectCustomWorldTag(e){const r=this.customWorldTags.get(e);if(!r)return;const t=document.querySelectorAll(".el-dialog__body > div > div > div");if(t.length<2)return;const s=t[1];if(s.querySelector(".vrcx-custom-world-tag"))return;const o=document.createElement("span");o.className="el-tag el-tag--danger el-tag--plain el-tag--small vrcx-custom-world-tag",o.style.marginRight="5px",o.style.marginTop="5px",o.style.color=r.colour,o.style.borderColor=r.colour,o.textContent=r.tag,s.firstChild?s.insertBefore(o,s.firstChild):s.appendChild(o)}injectCustomUserTags(e){const r=this.customUserTags.get(e);if(!r||r.length===0)return;const t=document.querySelectorAll(".el-dialog__body > div > div");if(t.length<2)return;const s=t[1];s.querySelectorAll(".vrcx-custom-user-tag").forEach(a=>a.remove());for(const a of r){const g=document.createElement("span");g.className="el-tag el-tag--info el-tag--plain el-tag--small vrcx-custom-user-tag",g.style.marginRight="5px",g.style.marginTop="5px",g.style.color=a.colour,g.style.borderColor=a.colour,g.textContent=a.tag,s.appendChild(g)}}addWorldTag(e,r,t="#FF0000"){const s=window.$pinia?.world;if(!s||!s.addCustomWorldTag)return this.logger.error("World store not available or not patched"),!1;try{return s.addCustomWorldTag({WorldId:e,Tag:r,TagColour:t}),!0}catch(o){const a=o instanceof Error?o.message:String(o);return this.logger.error(`Failed to add world tag: ${a}`),!1}}getWorldTag(e){return this.customWorldTags.get(e)}removeWorldTag(e){return this.customWorldTags.delete(e)}getAllWorldTags(){return Array.from(this.customWorldTags.entries()).map(([e,r])=>({worldId:e,tag:r.tag,colour:r.colour,timestamp:r.timestamp}))}clearAllWorldTags(){this.customWorldTags.clear(),this.logger.log("All custom world tags cleared")}addUserTag(e,r,t="#FF00C6"){const s=window.$pinia?.user;if(!s||!s.addCustomUserTag)return this.logger.error("User store not available or not patched"),!1;try{return s.addCustomUserTag({UserId:e,Tag:r,TagColour:t}),!0}catch(o){const a=o instanceof Error?o.message:String(o);return this.logger.error(`Failed to add user tag: ${a}`),!1}}getUserTags(e){return this.customUserTags.get(e)||[]}removeUserTag(e,r){const t=this.customUserTags.get(e);if(!t)return!1;const s=t.filter(o=>o.tag!==r);return s.length===0?this.customUserTags.delete(e):this.customUserTags.set(e,s),!0}removeAllUserTags(e){return this.customUserTags.delete(e)}getAllUserTags(){return Array.from(this.customUserTags.entries()).map(([e,r])=>({userId:e,tags:r.map(t=>({tag:t.tag,colour:t.colour,timestamp:t.timestamp}))}))}clearAllUserTags(){this.customUserTags.clear(),this.logger.log("All custom user tags cleared")}async stop(){await super.stop(),this.logger.log("Tag API stopped")}};n(i,"TagAPIPlugin");let l=i;window.customjs.__LAST_PLUGIN_CLASS__=l;})();
