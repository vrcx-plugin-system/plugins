(()=>{var m=Object.defineProperty;var u=(d,r)=>m(d,"name",{value:r,configurable:!0});const c=class c extends CustomModule{constructor(){super({name:"Tag API \u{1F3F7}\uFE0F",description:"Provides custom tag API for users, worlds, and avatars",authors:[{name:"Bluscream",description:"VRCX Plugin System Maintainer",userId:"usr_08082729-592d-4098-9a21-83c8dd37a844"}],tags:["API","Enhancement"],required_dependencies:["dialog-events-api"]}),this.customWorldTags=new Map,this.customUserTags=new Map,this.customAvatarTags=new Map}async load(){this.registerEvent("world-tag-added",{description:"Fired when a custom world tag is added",payload:{worldId:"string - World ID",tag:"string - Tag text",color:"string - Tag color",timestamp:"number - Unix timestamp"},broadcastIPC:!1,logToConsole:!1}),this.registerEvent("user-tag-added",{description:"Fired when a custom user tag is added",payload:{userId:"string - User ID",tag:"string - Tag text",color:"string - Tag color",timestamp:"number - Unix timestamp"},broadcastIPC:!1,logToConsole:!1}),this.registerEvent("avatar-tag-added",{description:"Fired when a custom avatar tag is added",payload:{avatarId:"string - Avatar ID",tag:"string - Tag text",color:"string - Tag color",timestamp:"number - Unix timestamp"},broadcastIPC:!1,logToConsole:!1}),this.loaded=!0,this.logger.log("Tag API plugin loaded")}async start(){this.patchWorldStore(),this.patchUserStore(),this.patchAvatarStore(),this.setupWorldDialogWatcher(),this.setupUserDialogWatcher(),this.setupAvatarDialogWatcher(),this.enabled=!0,this.started=!0,this.logger.log("Tag API started")}patchWorldStore(){const r=window.$pinia?.world;if(!r){this.logger.warn("World store not available");return}const e=this;r.addCustomWorldTag=function(t){if(!t||!t.WorldId)return;const a=t.WorldId,g={tag:t.Tag||"",colour:t.TagColour||"#FF0000",url:t.Url||"",tooltip:t.Tooltip||"",timestamp:Date.now()},o=e.customWorldTags.get(a)||[];o.some(i=>i.tag===g.tag)||(o.push(g),e.customWorldTags.set(a,o),e.emit("world-tag-added",{worldId:a,tag:g.tag,color:g.colour,timestamp:Date.now()}))},r.getCustomWorldTags=function(t){return e.customWorldTags.get(t)||[]},r.removeCustomWorldTag=function(t,a){const g=e.customWorldTags.get(t);if(!g)return!1;const o=g.filter(s=>s.tag!==a);return o.length===0?e.customWorldTags.delete(t):e.customWorldTags.set(t,o),!0},r.getAllCustomWorldTags=function(){return Array.from(e.customWorldTags.entries()).map(([t,a])=>({worldId:t,tags:a}))},this.logger.log("World store patched with custom tag support")}patchUserStore(){const r=window.$pinia?.user;if(!r){this.logger.warn("User store not available");return}const e=this;r.addCustomUserTag=function(t){if(!t||!t.UserId)return;const a=t.UserId,g={tag:t.Tag||"",colour:t.TagColour||"#FF00C6",url:t.Url||"",tooltip:t.Tooltip||"",timestamp:Date.now()},o=e.customUserTags.get(a)||[];o.some(i=>i.tag===g.tag)||(o.push(g),e.customUserTags.set(a,o),e.emit("user-tag-added",{userId:a,tag:g.tag,color:g.colour,timestamp:Date.now()}))},r.getCustomUserTags=function(t){return e.customUserTags.get(t)||[]},r.removeCustomUserTag=function(t,a){const g=e.customUserTags.get(t);if(!g)return!1;const o=g.filter(s=>s.tag!==a);return o.length===0?e.customUserTags.delete(t):e.customUserTags.set(t,o),!0},r.getAllCustomUserTags=function(){return Array.from(e.customUserTags.entries()).map(([t,a])=>({userId:t,tags:a}))},this.logger.log("User store patched with custom tag support")}setupWorldDialogWatcher(){this.on("ShowWorldDialog",r=>{if(this.logger.log(`[DEBUG] ShowWorldDialog event received for worldId: ${r?.worldId}`),r?.worldId){const e=this.customWorldTags.get(r.worldId);this.logger.log(`[DEBUG] World has ${e?.length||0} custom tags`),setTimeout(()=>this.injectCustomWorldTag(r.worldId),100)}}),this.logger.log("World dialog watcher setup")}patchAvatarStore(){const r=window.$pinia?.avatar;if(!r){this.logger.warn("Avatar store not available");return}const e=this;r.addCustomAvatarTag=function(t){if(!t||!t.AvatarId)return;const a=t.AvatarId,g={tag:t.Tag||"",colour:t.TagColour||"#00C6FF",url:t.Url||"",tooltip:t.Tooltip||"",timestamp:Date.now()},o=e.customAvatarTags.get(a)||[];o.some(i=>i.tag===g.tag)||(o.push(g),e.customAvatarTags.set(a,o),e.emit("avatar-tag-added",{avatarId:a,tag:g.tag,color:g.colour,timestamp:Date.now()}))},r.getCustomAvatarTags=function(t){return e.customAvatarTags.get(t)||[]},r.removeCustomAvatarTag=function(t,a){const g=e.customAvatarTags.get(t);if(!g)return!1;const o=g.filter(s=>s.tag!==a);return o.length===0?e.customAvatarTags.delete(t):e.customAvatarTags.set(t,o),!0},r.getAllCustomAvatarTags=function(){return Array.from(e.customAvatarTags.entries()).map(([t,a])=>({avatarId:t,tags:a}))},this.logger.log("Avatar store patched with custom tag support")}setupUserDialogWatcher(){this.on("ShowUserDialog",r=>{if(this.logger.log(`[DEBUG] ShowUserDialog event received for userId: ${r?.userId}`),r?.userId){const e=this.customUserTags.get(r.userId);this.logger.log(`[DEBUG] User has ${e?.length||0} custom tags`),setTimeout(()=>this.injectCustomUserTags(r.userId),100)}}),this.logger.log("User dialog watcher setup")}setupAvatarDialogWatcher(){this.on("ShowAvatarDialog",r=>{if(this.logger.log(`[DEBUG] ShowAvatarDialog event received for avatarId: ${r?.avatarId}`),r?.avatarId){const e=this.customAvatarTags.get(r.avatarId);this.logger.log(`[DEBUG] Avatar has ${e?.length||0} custom tags`),setTimeout(()=>this.injectCustomAvatarTags(r.avatarId),100)}}),this.logger.log("Avatar dialog watcher setup")}injectCustomWorldTag(r){const e=document.querySelector(".x-world-dialog");if(!e){this.logger.log("[DEBUG] World dialog not found in DOM, skipping injection");return}const t=e.querySelectorAll('div[style*="margin-top: 5px"]');let a=null;for(const s of t)if(s.querySelector(".el-tag")){a=s;break}if(!a){this.logger.log("[DEBUG] Native tag container not found in world dialog");return}a.querySelectorAll(".vrcx-custom-world-tag").forEach(s=>s.remove());const o=this.customWorldTags.get(r);if(!(!o||o.length===0)){this.logger.log(`[DEBUG] Injecting ${o.length} world tags into dialog`);for(const s of o){const i=document.createElement("span");i.className="el-tag el-tag--danger el-tag--plain el-tag--small vrcx-custom-world-tag",i.style.marginRight="5px",i.style.marginTop="5px",i.style.color=s.colour,i.style.borderColor=s.colour,i.textContent=s.tag,s.tooltip&&(i.title=s.tooltip),s.url&&(i.style.cursor="pointer",i.addEventListener("click",l=>{l.stopPropagation(),window.open(s.url,"_blank")})),a.appendChild(i)}}}injectCustomUserTags(r){this.logger.log(`[DEBUG] injectCustomUserTags called for userId: ${r}`);const e=document.querySelector(".x-user-dialog");if(!e){this.logger.log("[DEBUG] User dialog not found in DOM, skipping injection");return}const t=e.querySelectorAll('div[style*="margin-top: 5px"]');let a=null;for(const s of t)if(s.querySelector(".el-tag")){a=s;break}if(!a){this.logger.log("[DEBUG] Native tag container not found in user dialog");return}a.querySelectorAll(".vrcx-custom-user-tag").forEach(s=>s.remove());const o=this.customUserTags.get(r);if(this.logger.log(`[DEBUG] Found ${o?.length||0} tags to inject`),!(!o||o.length===0)){this.logger.log(`[DEBUG] Injecting ${o.length} user tags into dialog`);for(const s of o){const i=document.createElement("span");i.className="el-tag el-tag--info el-tag--plain el-tag--small vrcx-custom-user-tag",i.style.marginRight="5px",i.style.marginTop="5px",i.style.color=s.colour,i.style.borderColor=s.colour,i.textContent=s.tag,s.tooltip&&(i.title=s.tooltip),s.url&&(i.style.cursor="pointer",i.addEventListener("click",l=>{l.stopPropagation(),window.open(s.url,"_blank")})),a.appendChild(i)}}}injectCustomAvatarTags(r){const e=document.querySelector(".x-avatar-dialog");if(!e){this.logger.log("[DEBUG] Avatar dialog not found in DOM, skipping injection");return}const t=e.querySelector(".el-dialog__body > div > div:nth-child(2)");if(!t){this.logger.log("[DEBUG] Tag container not found in avatar dialog");return}t.querySelectorAll(".vrcx-custom-avatar-tag").forEach(o=>o.remove());const g=this.customAvatarTags.get(r);if(!(!g||g.length===0)){this.logger.log(`[DEBUG] Injecting ${g.length} avatar tags into dialog`);for(const o of g){const s=document.createElement("span");s.className="el-tag el-tag--success el-tag--plain el-tag--small vrcx-custom-avatar-tag",s.style.marginRight="5px",s.style.marginTop="5px",s.style.color=o.colour,s.style.borderColor=o.colour,s.textContent=o.tag,o.tooltip&&(s.title=o.tooltip),o.url&&(s.style.cursor="pointer",s.addEventListener("click",i=>{i.stopPropagation(),window.open(o.url,"_blank")})),t.appendChild(s)}}}addWorldTag(r,e,t="#FF0000",a="",g=""){const o=window.$pinia?.world;if(!o||!o.addCustomWorldTag)return this.logger.error("World store not available or not patched"),!1;try{return o.addCustomWorldTag({WorldId:r,Tag:e,TagColour:t,Url:a,Tooltip:g}),!0}catch(s){const i=s instanceof Error?s.message:String(s);return this.logger.error(`Failed to add world tag: ${i}`),!1}}getWorldTags(r){return this.customWorldTags.get(r)||[]}removeWorldTag(r,e){const t=this.customWorldTags.get(r);if(!t)return!1;const a=t.filter(g=>g.tag!==e);return a.length===0?this.customWorldTags.delete(r):this.customWorldTags.set(r,a),!0}removeAllWorldTags(r){return this.customWorldTags.delete(r)}getAllWorldTags(){return Array.from(this.customWorldTags.entries()).map(([r,e])=>({worldId:r,tags:e.map(t=>({tag:t.tag,colour:t.colour,timestamp:t.timestamp}))}))}clearAllWorldTags(){this.customWorldTags.clear(),this.logger.log("All custom world tags cleared")}addUserTag(r,e,t="#FF00C6",a="",g=""){const o=window.$pinia?.user;if(!o||!o.addCustomUserTag)return this.logger.error("User store not available or not patched"),!1;try{return o.addCustomUserTag({UserId:r,Tag:e,TagColour:t,Url:a,Tooltip:g}),!0}catch(s){const i=s instanceof Error?s.message:String(s);return this.logger.error(`Failed to add user tag: ${i}`),!1}}getUserTags(r){return this.customUserTags.get(r)||[]}removeUserTag(r,e){const t=this.customUserTags.get(r);if(!t)return!1;const a=t.filter(g=>g.tag!==e);return a.length===0?this.customUserTags.delete(r):this.customUserTags.set(r,a),!0}removeAllUserTags(r){return this.customUserTags.delete(r)}getAllUserTags(){return Array.from(this.customUserTags.entries()).map(([r,e])=>({userId:r,tags:e.map(t=>({tag:t.tag,colour:t.colour,timestamp:t.timestamp}))}))}clearAllUserTags(){this.customUserTags.clear(),this.logger.log("All custom user tags cleared")}addAvatarTag(r,e,t="#00C6FF",a="",g=""){const o=window.$pinia?.avatar;if(!o||!o.addCustomAvatarTag)return this.logger.error("Avatar store not available or not patched"),!1;try{return o.addCustomAvatarTag({AvatarId:r,Tag:e,TagColour:t,Url:a,Tooltip:g}),!0}catch(s){const i=s instanceof Error?s.message:String(s);return this.logger.error(`Failed to add avatar tag: ${i}`),!1}}getAvatarTags(r){return this.customAvatarTags.get(r)||[]}removeAvatarTag(r,e){const t=this.customAvatarTags.get(r);if(!t)return!1;const a=t.filter(g=>g.tag!==e);return a.length===0?this.customAvatarTags.delete(r):this.customAvatarTags.set(r,a),!0}removeAllAvatarTags(r){return this.customAvatarTags.delete(r)}getAllAvatarTags(){return Array.from(this.customAvatarTags.entries()).map(([r,e])=>({avatarId:r,tags:e.map(t=>({tag:t.tag,colour:t.colour,timestamp:t.timestamp}))}))}clearAllAvatarTags(){this.customAvatarTags.clear(),this.logger.log("All custom avatar tags cleared")}async stop(){await super.stop(),this.logger.log("Tag API stopped")}};u(c,"TagAPIPlugin");let n=c;window.customjs.__LAST_PLUGIN_CLASS__=n;})();
