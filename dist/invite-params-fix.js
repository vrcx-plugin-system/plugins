(()=>{var a=Object.defineProperty;var d=(r,t)=>a(r,"name",{value:t,configurable:!0});const o=class o extends CustomModule{constructor(){super({name:"Invite Params Fix \u{1F527}",description:"Fixes duplicate worldId bug in VRCX invite API calls that causes '400 Invalid location' errors",authors:[{name:"Bluscream",description:"VRCX Plugin System Maintainer",userId:"usr_08082729-592d-4098-9a21-83c8dd37a844"}],tags:["Patch","Bug Fix","Core"],required_dependencies:[]})}async load(){this.logger.log("Invite Params Fix plugin ready"),this.loaded=!0}async start(){if(!window.request?.notificationRequest){this.logger.error("Notification request API not available");return}this.patchSendInvite(),this.patchSendRequestInvite(),this.patchSendInviteResponse(),this.enabled=!0,this.started=!0,this.logger.log("Invite parameters patched - duplicate worldId bug fixed")}patchSendInvite(){const t=window.request.notificationRequest.sendInvite;if(!t){this.logger.warn("sendInvite not found");return}window.request.notificationRequest.sendInvite=(i,e)=>{const n=this.fixInviteParams(i,"sendInvite");return t.call(window.request.notificationRequest,n,e)},this.logger.log("\u2713 Patched sendInvite")}patchSendRequestInvite(){const t=window.request.notificationRequest.sendRequestInvite;if(!t){this.logger.warn("sendRequestInvite not found");return}window.request.notificationRequest.sendRequestInvite=(i,e)=>{const n=this.fixInviteParams(i,"sendRequestInvite");return t.call(window.request.notificationRequest,n,e)},this.logger.log("\u2713 Patched sendRequestInvite")}patchSendInviteResponse(){const t=window.request.notificationRequest.sendInviteResponse;if(!t){this.logger.warn("sendInviteResponse not found");return}window.request.notificationRequest.sendInviteResponse=(i,e)=>{const n=this.fixInviteParams(i,"sendInviteResponse");return t.call(window.request.notificationRequest,n,e)},this.logger.log("\u2713 Patched sendInviteResponse")}fixInviteParams(t,i){if(!t)return t;const e={...t};if(e.worldId&&e.worldId.includes(":")){const n=window.utils?.parseLocation(e.worldId);n&&n.worldId&&(this.logger.log(`[${i}] Fixed duplicate worldId bug: "${e.worldId}" -> worldId:"${n.worldId}", instanceId:"${e.instanceId||e.worldId}"`),(!e.instanceId||e.instanceId===e.worldId)&&(e.instanceId=e.worldId),e.worldId=n.worldId)}return e.instanceId&&!e.instanceId.includes(":")&&e.instanceId.startsWith("wrld_")&&this.logger.warn(`[${i}] instanceId appears to be just a worldId (missing instance number): "${e.instanceId}"`),e}async stop(){this.logger.log("Stopping Invite Params Fix plugin - note: patches remain active until VRCX restart"),await super.stop()}};d(o,"InviteParamsFixPlugin");let s=o;window.customjs.__LAST_PLUGIN_CLASS__=s;})();
