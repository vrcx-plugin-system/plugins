# VRCX Plugins

This directory contains the VRCX plugin system plugins, now written in TypeScript.

## Structure

- **`src/`** - TypeScript source code
  - **`plugins/`** - All plugin TypeScript files
  - **`types/`** - Type definitions
    - **`index.ts`** - VRCX Plugin System type definitions
- **`dist/`** - Compiled output (generated by build)
  - **`*.js`** - Compiled and minified JavaScript plugins
  - **`repo.json`** - Plugin repository metadata
- **`build.js`** - Build script that compiles TypeScript to JavaScript
- **`build-repo.js`** - Script to generate repo.json from compiled plugins
- **`package.json`** - NPM package configuration
- **`tsconfig.json`** - TypeScript configuration

## Development

### Prerequisites

Install dependencies:

```bash
npm install
```

### Building Plugins

Build all plugins (production mode with minification):

```bash
npm run build
```

Build in development mode (no minification):

```bash
npm run build:dev
```

Generate only the repo.json file:

```bash
npm run build:repo
```

### Creating a New Plugin

1. Create a new `.ts` file in the `src/plugins/` directory
2. Extend the `Plugin` base class
3. Implement required lifecycle methods (`load()`, `start()`, `stop()`)
4. Export your plugin class using `window.customjs.__LAST_PLUGIN_CLASS__`

Example:

```typescript
class MyPlugin extends Plugin {
  constructor() {
    super({
      name: "My Plugin",
      description: "Description of my plugin",
      author: "Your Name",
      build: "1234567890",
      tags: ["Utility"],
      dependencies: [],
    });
  }

  async load() {
    this.logger.log("Plugin loaded");
    this.loaded = true;
  }

  async start() {
    this.enabled = true;
    this.started = true;
    this.logger.log("Plugin started");
  }

  async stop() {
    await super.stop();
  }
}

window.customjs.__LAST_PLUGIN_CLASS__ = MyPlugin;
```

5. Run `npm run build` to compile

### Type Definitions

The `src/types/index.ts` file contains TypeScript type definitions for:

- `Plugin` base class
- Plugin metadata
- Settings system
- Logger interface
- Event system
- Hook system
- Pinia store subscriptions

These types provide autocomplete and type checking in your IDE.

## Plugin System Features

### Settings

Use the Equicord-style settings system:

```typescript
this.settings = this.defineSettings({
  mySetting: {
    type: SettingType.BOOLEAN,
    description: "Enable/disable feature",
    default: true,
  },
});

// Access: this.settings.store.mySetting
```

### Hooks

Register hooks to intercept function calls:

```typescript
this.registerPreHook("functionPath", (args) => {
  /* runs before */
});
this.registerPostHook("functionPath", (result, args) => {
  /* runs after */
});
```

### Events

Emit and listen to events:

```typescript
this.on("event-name", (data) => {
  /* handle event */
});
this.emit("event-name", {
  /* data */
});
```

### Resource Management

Automatically cleaned up when plugin stops:

```typescript
this.registerTimer(setInterval(() => {}, 1000));
this.registerObserver(new MutationObserver(() => {}));
this.registerListener(element, "click", () => {});
this.subscribe("STORE_NAME", (state) => {});
```

## Build Output

The build process:

1. Compiles each TypeScript file in `src/plugins/` to JavaScript
2. Minifies the output (in production mode)
3. Outputs to `dist/`
4. Generates `dist/repo.json` with plugin metadata

## Clean Build

To clean the dist directory:

```bash
npm run clean
```

Then rebuild:

```bash
npm run build
```
